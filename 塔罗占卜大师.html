<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç¥ç§˜å¡”ç½—å åœ</title>
    <style>
        :root {
            --primary-color: #8b4513;
            --secondary-color: #d4a76a;
            --background-color: #f5e9dc;
            --card-back-color: #333;
            --text-color: #333;
            --light-text: #fff;
            --shadow-color: rgba(0, 0, 0, 0.2);
            --love-color: #e91e63;
            --career-color: #3f51b5;
            --health-color: #4caf50;
            --spiritual-color: #9c27b0;
            --finance-color: #ff9800;
            --family-color: #2196f3;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 10px;
            max-width: 100%;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 15px;
        }
        
        header {
            text-align: center;
            margin-bottom: 20px;
            position: relative;
        }
        
        h1 {
            color: var(--primary-color);
            font-size: 2rem;
            margin-bottom: 10px;
            text-shadow: 1px 1px 2px var(--shadow-color);
        }
        
        .description {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 20px;
        }
        
        .theme-toggle {
            position: absolute;
            top: 0;
            right: 0;
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            color: var(--primary-color);
        }
        
        .question-input {
            width: 100%;
            padding: 12px;
            margin-bottom: 20px;
            border: 1px solid var(--secondary-color);
            border-radius: 8px;
            font-size: 1rem;
            resize: none;
            min-height: 80px;
        }
        
        .category-selector {
            margin-bottom: 15px;
        }
        
        .category-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 10px;
        }
        
        .category-btn {
            padding: 8px 12px;
            border-radius: 20px;
            border: none;
            background-color: #eee;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .category-btn.active {
            color: white;
        }
        
        .category-btn.love {
            background-color: var(--love-color);
        }
        
        .category-btn.career {
            background-color: var(--career-color);
        }
        
        .category-btn.health {
            background-color: var(--health-color);
        }
        
        .category-btn.spiritual {
            background-color: var(--spiritual-color);
        }
        
        .category-btn.finance {
            background-color: var(--finance-color);
        }
        
        .category-btn.family {
            background-color: var(--family-color);
        }
        
        .spread-selector {
            display: flex;
            justify-content: space-around;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .spread-option {
            background-color: #fff;
            border: 2px solid var(--secondary-color);
            border-radius: 10px;
            padding: 12px;
            text-align: center;
            width: 30%;
            min-width: 100px;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 10px;
            box-shadow: 0 2px 5px var(--shadow-color);
        }
        
        .spread-option:hover, .spread-option.selected {
            background-color: var(--secondary-color);
            color: var(--light-text);
            transform: translateY(-3px);
        }
        
        .spread-option h3 {
            font-size: 1rem;
            margin-bottom: 5px;
        }
        
        .spread-option p {
            font-size: 0.8rem;
        }
        
        .divination-area {
            min-height: 300px;
            position: relative;
            margin-bottom: 20px;
        }
        
        .card-container {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .card {
            width: 100px;
            height: 160px;
            background-color: var(--card-back-color);
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: var(--light-text);
            font-size: 1.5rem;
            cursor: pointer;
            transition: transform 0.5s, box-shadow 0.3s;
            position: relative;
            box-shadow: 0 4px 8px var(--shadow-color);
            margin: 5px;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px var(--shadow-color);
        }
        
        .card.reversed {
            transform: rotate(180deg);
        }
        
        .card.face-down {
            background-color: var(--card-back-color);
            color: var(--card-back-color);
        }
        
        .card.face-up {
            background-color: #fff;
            color: var(--text-color);
            border: 1px solid var(--secondary-color);
        }
        
        .card-image {
            width: 90%;
            height: 90%;
            object-fit: contain;
            display: none;
            border-radius: 5px;
        }
        
        .card.face-up .card-image {
            display: block;
        }
        
        .card.face-up .card-text {
            display: none;
        }
        
        .card-position {
            position: absolute;
            top: -20px;
            font-size: 0.8rem;
            color: var(--primary-color);
            background-color: var(--background-color);
            padding: 2px 5px;
            border-radius: 5px;
            white-space: nowrap;
            z-index: 10;
            max-width: 120px;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .btn {
            background-color: var(--primary-color);
            color: var(--light-text);
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            font-size: 1rem;
            cursor: pointer;
            display: block;
            width: 100%;
            margin: 10px 0;
            transition: background-color 0.3s, transform 0.2s;
            box-shadow: 0 2px 5px var(--shadow-color);
        }
        
        .btn:hover {
            background-color: #a05c2c;
            transform: translateY(-2px);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-group {
            display: flex;
            gap: 10px;
        }
        
        .btn-group .btn {
            flex: 1;
        }
        
        .btn-daily {
            background-color: var(--spiritual-color);
        }
        
        .btn-custom {
            background-color: var(--finance-color);
        }
        
        .result {
            background-color: white;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            display: none;
            box-shadow: 0 2px 10px var(--shadow-color);
        }
        
        .result h3 {
            color: var(--primary-color);
            margin-bottom: 10px;
            text-align: center;
            font-size: 1.3rem;
        }
        
        .result p {
            margin-bottom: 10px;
        }
        
        .interpretation {
            font-style: italic;
            color: #666;
            background-color: #f9f9f9;
            padding: 8px;
            border-radius: 5px;
            margin-top: 5px;
        }
        
        .card-result {
            margin-bottom: 15px;
            border-bottom: 1px dashed #ddd;
            padding-bottom: 10px;
        }
        
        .card-result:last-child {
            border-bottom: none;
        }
        
        .combination-analysis {
            margin-top: 20px;
            padding: 15px;
            background-color: #f0f8ff;
            border-radius: 8px;
            border-left: 4px solid var(--primary-color);
        }
        
        .card-details {
            margin-top: 10px;
            padding: 10px;
            background-color: #fffaf0;
            border-radius: 5px;
            font-size: 0.9rem;
        }
        
        .card-details h4 {
            color: var(--primary-color);
            margin-bottom: 5px;
        }
        
        .card-symbolism {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 5px;
        }
        
        .symbol-item {
            background-color: #f0f0f0;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 0.8rem;
        }
        
        .history {
            margin-top: 20px;
            display: none;
        }
        
        .history-item {
            background-color: white;
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 10px;
            box-shadow: 0 2px 5px var(--shadow-color);
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .history-item:hover {
            transform: translateY(-3px);
        }
        
        .history-item h4 {
            color: var(--primary-color);
            margin-bottom: 5px;
        }
        
        .history-item p {
            font-size: 0.9rem;
            color: #666;
        }
        
        .history-date {
            font-size: 0.8rem;
            color: #999;
            text-align: right;
        }
        
        .tab-container {
            display: flex;
            margin-bottom: 15px;
            overflow-x: auto;
            scrollbar-width: none; /* Firefox */
        }
        
        .tab-container::-webkit-scrollbar {
            display: none; /* Chrome, Safari, Opera */
        }
        
        .tab {
            flex: 1;
            min-width: 80px;
            text-align: center;
            padding: 10px;
            background-color: #eee;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
        }
        
        .tab:first-child {
            border-top-left-radius: 8px;
            border-bottom-left-radius: 8px;
        }
        
        .tab:last-child {
            border-top-right-radius: 8px;
            border-bottom-right-radius: 8px;
        }
        
        .tab.active {
            background-color: var(--primary-color);
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .save-form {
            margin-top: 20px;
        }
        
        .save-input {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        
        .notes-input {
            width: 100%;
            padding: 10px;
            margin-top: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            min-height: 60px;
        }
        
        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
        }
        
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .daily-horoscope {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .daily-card {
            display: inline-block;
            margin: 10px;
            vertical-align: top;
        }
        
        .advice {
            margin-top: 20px;
            padding: 15px;
            background-color: #fffaf0;
            border-radius: 8px;
            border-left: 4px solid var(--secondary-color);
        }
        
        .custom-spread {
            margin-top: 20px;
            display: none;
        }
        
        .custom-positions {
            margin-top: 10px;
        }
        
        .custom-position {
            display: flex;
            margin-bottom: 10px;
        }
        
        .custom-position input {
            flex: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        
        .custom-add-btn {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin-left: 10px;
        }
        
        .card-library {
            display: none;
            margin-top: 20px;
        }
        
        .card-library-item {
            display: inline-block;
            width: 80px;
            margin: 5px;
            text-align: center;
            cursor: pointer;
        }
        
        .card-library-item img {
            width: 60px;
            height: 100px;
            object-fit: cover;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        
        .card-library-item p {
            font-size: 0.7rem;
            margin-top: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .timeline {
            margin-top: 20px;
        }
        
        .timeline-item {
            display: flex;
            margin-bottom: 15px;
        }
        
        .timeline-date {
            width: 80px;
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .timeline-content {
            flex: 1;
            padding-left: 15px;
            border-left: 2px solid var(--secondary-color);
        }
        
        /* æš—é»‘æ¨¡å¼ */
        body.dark-mode {
            --primary-color: #d4a76a;
            --secondary-color: #8b4513;
            --background-color: #2a2a2a;
            --card-back-color: #1a1a1a;
            --text-color: #f0f0f0;
            --light-text: #f0f0f0;
            --shadow-color: rgba(0, 0, 0, 0.5);
            background-color: var(--background-color);
            color: var(--text-color);
        }
        
        body.dark-mode .spread-option {
            background-color: #333;
        }
        
        body.dark-mode .result,
        body.dark-mode .history-item {
            background-color: #333;
            color: var(--text-color);
        }
        
        body.dark-mode .interpretation {
            color: #ccc;
            background-color: #3a3a3a;
        }
        
        body.dark-mode .question-input {
            background-color: #333;
            color: var(--text-color);
            border-color: var(--secondary-color);
        }
        
        body.dark-mode .tab {
            background-color: #444;
            color: var(--text-color);
        }
        
        body.dark-mode .tab.active {
            background-color: var(--primary-color);
        }
        
        body.dark-mode .combination-analysis {
            background-color: #1a2a3a;
            border-left-color: var(--secondary-color);
        }
        
        body.dark-mode .advice {
            background-color: #3a2a1a;
            border-left-color: var(--secondary-color);
        }
        
        body.dark-mode .card-details {
            background-color: #3a3a3a;
        }
        
        body.dark-mode .symbol-item {
            background-color: #2a2a2a;
        }
        
        @media (max-width: 480px) {
            .card {
                width: 80px;
                height: 130px;
                font-size: 1.2rem;
            }
            
            h1 {
                font-size: 1.5rem;
            }
            
            .spread-option {
                width: 100%;
                margin-bottom: 10px;
            }
            
            .spread-selector {
                flex-direction: column;
                align-items: center;
            }
            
            .btn-group {
                flex-direction: column;
            }
            
            .category-buttons {
                justify-content: center;
            }
            
            .category-btn {
                padding: 6px 10px;
                font-size: 0.8rem;
            }
            
            .tab {
                min-width: 70px;
                padding: 8px 5px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <button class="theme-toggle" id="theme-toggle">ğŸŒ“</button>
            <h1>ç¥ç§˜å¡”ç½—å åœ</h1>
            <p class="description">é™å¿ƒæé—®ï¼Œå¡”ç½—å°†ä¸ºä½ æ­ç¤ºç­”æ¡ˆ</p>
        </header>
        
        <div class="tab-container">
            <div class="tab active" data-tab="divination">å åœ</div>
            <div class="tab" data-tab="daily">æ¯æ—¥è¿åŠ¿</div>
            <div class="tab" data-tab="custom">è‡ªå®šä¹‰ç‰Œé˜µ</div>
            <div class="tab" data-tab="library">ç‰Œåº“</div>
            <div class="tab" data-tab="history">å†å²è®°å½•</div>
            <div class="tab" data-tab="timeline">æ—¶é—´çº¿</div>
            <div class="tab" data-tab="about">å…³äº</div>
        </div>
        
        <div class="tab-content active" id="divination-tab">
            <textarea class="question-input" id="question-input" placeholder="åœ¨æ­¤è¾“å…¥ä½ çš„é—®é¢˜æˆ–å…³æ³¨ç‚¹...ï¼ˆå¯é€‰ï¼‰"></textarea>
            
            <div class="category-selector">
                <h3>é€‰æ‹©å åœç±»åˆ«</h3>
                <div class="category-buttons">
                    <button class="category-btn" data-category="general">é€šç”¨</button>
                    <button class="category-btn love" data-category="love">çˆ±æƒ…</button>
                    <button class="category-btn career" data-category="career">äº‹ä¸š</button>
                    <button class="category-btn health" data-category="health">å¥åº·</button>
                    <button class="category-btn spiritual" data-category="spiritual">å¿ƒçµ</button>
                    <button class="category-btn finance" data-category="finance">è´¢åŠ¡</button>
                    <button class="category-btn family" data-category="family">å®¶åº­</button>
                </div>
            </div>
            
            <h3>é€‰æ‹©ç‰Œé˜µ</h3>
            <div class="spread-selector">
                <div class="spread-option" data-spread="single">
                    <h3>å•ç‰Œé˜µ</h3>
                    <p>ç®€å•é—®é¢˜å¿«é€ŸæŒ‡å¼•</p>
                </div>
                <div class="spread-option" data-spread="three">
                    <h3>ä¸‰ç‰Œé˜µ</h3>
                    <p>è¿‡å»-ç°åœ¨-æœªæ¥</p>
                </div>
                <div class="spread-option" data-spread="five">
                    <h3>äº”ç‰Œé˜µ</h3>
                    <p>å…¨é¢åˆ†æé—®é¢˜</p>
                </div>
                <div class="spread-option" data-spread="celtic">
                    <h3>å‡¯å°”ç‰¹åå­—</h3>
                    <p>æ·±å…¥å¤æ‚é—®é¢˜</p>
                </div>
                <div class="spread-option" data-spread="love">
                    <h3>çˆ±æƒ…ç‰Œé˜µ</h3>
                    <p>æ„Ÿæƒ…å…³ç³»åˆ†æ</p>
                </div>
                <div class="spread-option" data-spread="career">
                    <h3>äº‹ä¸šç‰Œé˜µ</h3>
                    <p>èŒä¸šå‘å±•æŒ‡å¼•</p>
                </div>
                <div class="spread-option" data-spread="finance">
                    <h3>è´¢åŠ¡ç‰Œé˜µ</h3>
                    <p>é‡‘é’±è´¢åŠ¡åˆ†æ</p>
                </div>
                <div class="spread-option" data-spread="family">
                    <h3>å®¶åº­ç‰Œé˜µ</h3>
                    <p>å®¶åº­å…³ç³»åˆ†æ</p>
                </div>
            </div>
            
            <div class="divination-area">
                <div class="card-container" id="card-container">
                    <!-- ç‰Œå°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                </div>
                <div class="loading" id="loading">
                    <div class="loading-spinner"></div>
                    <p>å¡”ç½—æ­£åœ¨è¿æ¥å®‡å®™èƒ½é‡...</p>
                </div>
            </div>
            
            <div class="btn-group">
                <button class="btn" id="draw-btn">å¼€å§‹å åœ</button>
                <button class="btn" id="reset-btn" disabled>é‡æ–°å¼€å§‹</button>
            </div>
            
            <div class="result" id="result">
                <!-- ç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
            </div>
        </div>
        
        <div class="tab-content" id="daily-tab">
            <div class="daily-horoscope">
                <h2>ä»Šæ—¥å¡”ç½—è¿åŠ¿</h2>
                <p>ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®è·å–ä»Šå¤©çš„å¡”ç½—æŒ‡å¼•</p>
                <button class="btn btn-daily" id="daily-btn">è·å–ä»Šæ—¥è¿åŠ¿</button>
                
                <div id="daily-result" style="display: none;">
                    <div class="daily-card">
                        <div class="card" id="daily-card">
                            <!-- æ¯æ—¥ç‰Œå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                        </div>
                    </div>
                    
                    <div class="result" id="daily-interpretation">
                        <!-- æ¯æ—¥ç‰Œè§£é‡Šå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                    </div>
                    
                    <div class="notes-input-container">
                        <textarea class="notes-input" id="daily-notes" placeholder="è®°å½•ä»Šæ—¥è§‚å¯Ÿæˆ–æ„Ÿæ‚Ÿ..."></textarea>
                        <button class="btn" id="save-daily-notes">ä¿å­˜ç¬”è®°</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="custom-tab">
            <h2>è‡ªå®šä¹‰ç‰Œé˜µ</h2>
            <p>åˆ›å»ºä½ è‡ªå·±çš„å¡”ç½—ç‰Œé˜µï¼Œå®šä¹‰æ¯å¼ ç‰Œçš„ä½ç½®å«ä¹‰</p>
            
            <div class="btn-group">
                <button class="btn btn-custom" id="create-spread-btn">åˆ›å»ºæ–°ç‰Œé˜µ</button>
            </div>
            
            <div class="custom-spread" id="custom-spread">
                <input type="text" id="spread-name" class="save-input" placeholder="è¾“å…¥ç‰Œé˜µåç§°">
                <p>å®šä¹‰ç‰Œçš„ä½ç½®å«ä¹‰ï¼š</p>
                <div class="custom-positions" id="custom-positions">
                    <!-- è‡ªå®šä¹‰ä½ç½®å°†åœ¨è¿™é‡Œæ·»åŠ  -->
                </div>
                <button class="custom-add-btn" id="add-position-btn">æ·»åŠ ä½ç½®</button>
                
                <div class="btn-group" style="margin-top: 20px;">
                    <button class="btn" id="save-custom-btn">ä¿å­˜ç‰Œé˜µ</button>
                    <button class="btn" id="use-custom-btn">ä½¿ç”¨æ­¤ç‰Œé˜µ</button>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="library-tab">
            <h2>å¡”ç½—ç‰Œåº“</h2>
            <p>æ¢ç´¢78å¼ å¡”ç½—ç‰Œçš„å«ä¹‰å’Œè±¡å¾</p>
            
            <div class="category-buttons">
                <button class="category-btn" data-arcana="all">å…¨éƒ¨</button>
                <button class="category-btn" data-arcana="major">å¤§é˜¿å¡çº³</button>
                <button class="category-btn" data-arcana="minor">å°é˜¿å¡çº³</button>
                <button class="category-btn" data-suit="wands">æƒæ–</button>
                <button class="category-btn" data-suit="cups">åœ£æ¯</button>
                <button class="category-btn" data-suit="swords">å®å‰‘</button>
                <button class="category-btn" data-suit="pentacles">æ˜Ÿå¸</button>
            </div>
            
            <div class="card-library" id="card-library">
                <!-- ç‰Œåº“å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
            </div>
            
            <div class="result" id="card-detail" style="display: none;">
                <!-- å•å¼ ç‰Œè¯¦æƒ…å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
            </div>
        </div>
        
        <div class="tab-content" id="history-tab">
            <h2>å†å²è®°å½•</h2>
            <div class="category-buttons">
                <button class="category-btn" data-history="all">å…¨éƒ¨</button>
                <button class="category-btn love" data-history="love">çˆ±æƒ…</button>
                <button class="category-btn career" data-history="career">äº‹ä¸š</button>
                <button class="category-btn health" data-history="health">å¥åº·</button>
                <button class="category-btn spiritual" data-history="spiritual">å¿ƒçµ</button>
                <button class="category-btn finance" data-history="finance">è´¢åŠ¡</button>
                <button class="category-btn family" data-history="family">å®¶åº­</button>
            </div>
            
            <div class="history" id="history">
                <!-- å†å²è®°å½•å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
            </div>
        </div>
        
        <div class="tab-content" id="timeline-tab">
            <h2>å åœæ—¶é—´çº¿</h2>
            <p>æŸ¥çœ‹ä½ çš„å åœå†ç¨‹å’Œå˜åŒ–</p>
            
            <div class="timeline" id="timeline">
                <!-- æ—¶é—´çº¿å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
            </div>
        </div>
        
        <div class="tab-content" id="about-tab">
            <div class="result">
                <h3>å…³äºç¥ç§˜å¡”ç½—</h3>
                <p>å¡”ç½—ç‰Œæ˜¯ä¸€ç§å¤è€çš„å åœå·¥å…·ï¼Œç”±78å¼ ç‰Œç»„æˆï¼Œåˆ†ä¸º22å¼ å¤§é˜¿å¡çº³å’Œ56å¼ å°é˜¿å¡çº³ã€‚</p>
                
                <h4>ç‰Œé˜µè¯´æ˜ï¼š</h4>
                <ul>
                    <li><strong>å•ç‰Œé˜µ</strong>ï¼šç®€å•é—®é¢˜çš„å¿«é€ŸæŒ‡å¼•</li>
                    <li><strong>ä¸‰ç‰Œé˜µ</strong>ï¼šè¿‡å»ã€ç°åœ¨ã€æœªæ¥çš„æ—¶é—´çº¿è§£è¯»</li>
                    <li><strong>äº”ç‰Œé˜µ</strong>ï¼šç°çŠ¶ã€æŒ‘æˆ˜ã€æ½œæ„è¯†ã€å¤–åœ¨å½±å“å’Œå¯èƒ½ç»“æœ</li>
                    <li><strong>å‡¯å°”ç‰¹åå­—</strong>ï¼š10å¼ ç‰Œçš„æ·±å…¥åˆ†æï¼Œé€‚åˆå¤æ‚é—®é¢˜</li>
                    <li><strong>çˆ±æƒ…ç‰Œé˜µ</strong>ï¼šä¸“é—¨åˆ†ææ„Ÿæƒ…å…³ç³»çš„7å¼ ç‰Œé˜µ</li>
                    <li><strong>äº‹ä¸šç‰Œé˜µ</strong>ï¼šèŒä¸šå‘å±•å’Œå·¥ä½œé—®é¢˜çš„6å¼ ç‰Œé˜µ</li>
                    <li><strong>è´¢åŠ¡ç‰Œé˜µ</strong>ï¼šé‡‘é’±å’Œè´¢åŠ¡é—®é¢˜çš„5å¼ ç‰Œé˜µ</li>
                    <li><strong>å®¶åº­ç‰Œé˜µ</strong>ï¼šå®¶åº­å…³ç³»å’Œå®¶åº­äº‹åŠ¡çš„6å¼ ç‰Œé˜µ</li>
                </ul>
                
                <div class="advice">
                    <h4>ä½¿ç”¨å»ºè®®ï¼š</h4>
                    <ol>
                        <li>å åœå‰é™å¿ƒæ€è€ƒä½ çš„é—®é¢˜</li>
                        <li>é€‰æ‹©ä¸é—®é¢˜ç›¸å…³çš„ç‰Œé˜µ</li>
                        <li>ä¿æŒå¼€æ”¾çš„å¿ƒæ€æ¥å—æŒ‡å¼•</li>
                        <li>è®°å½•é‡è¦çš„å åœç»“æœ</li>
                        <li>åŒä¸€é—®é¢˜å»ºè®®é—´éš”ä¸€æ®µæ—¶é—´å†å åœ</li>
                        <li>ä½¿ç”¨æ—¶é—´çº¿åŠŸèƒ½è¿½è¸ªå˜åŒ–</li>
                        <li>æ¢ç´¢ç‰Œåº“æ·±å…¥äº†è§£æ¯å¼ ç‰Œçš„å«ä¹‰</li>
                    </ol>
                </div>
                
                <p>ç‰ˆæœ¬: 4.0.0</p>
            </div>
        </div>
    </div>
    
    <script>
        // å¡”ç½—ç‰Œæ•°æ® - åŒ…å«å¤§é˜¿å¡çº³å’Œå°é˜¿å¡çº³
        const tarotCards = [
            // å¤§é˜¿å¡çº³
            { name: "0. æ„šè€…", meaning: "æ–°çš„å¼€å§‹,å†’é™©,å¤©çœŸ", reversed: "é²è½,é£é™©,çŠ¹è±«ä¸å†³", image: "https://i.imgur.com/JjZkQ9a.jpg", arcana: "major", element: "é£", astrology: "å¤©ç‹æ˜Ÿ", numerology: 0, keywords: ["è‡ªç”±", "å†’é™©", "å¤©çœŸ"] },
            { name: "I. é­”æœ¯å¸ˆ", meaning: "æŠ€èƒ½,åˆ›é€ åŠ›,æ„å¿—åŠ›", reversed: "æ“çºµ,æ¬ºéª—,æœªå®ç°çš„æ‰èƒ½", image: "https://i.imgur.com/XsZlW9F.jpg", arcana: "major", element: "æ°´æ˜Ÿ", astrology: "æ°´æ˜Ÿ", numerology: 1, keywords: ["èƒ½åŠ›", "ä¸“æ³¨", "æŠ€å·§"] },
            // ...å…¶ä»–å¤§é˜¿å¡çº³ç‰Œ...
            
            // å°é˜¿å¡çº³ - æƒæ–
            { name: "æƒæ–ä¸€", meaning: "æ–°çš„åˆ›æ„,èƒ½é‡å¼€å§‹", reversed: "å»¶è¿Ÿ,ç¼ºä¹åŠ¨åŠ›", image: "https://i.imgur.com/abc123.jpg", arcana: "minor", suit: "wands", element: "ç«", keywords: ["çµæ„Ÿ", "å¼€å§‹", "èƒ½é‡"] },
            { name: "æƒæ–äºŒ", meaning: "è§„åˆ’æœªæ¥,åšå‡ºå†³å®š", reversed: "ææƒ§æ”¹å˜,çŠ¹è±«ä¸å†³", image: "https://i.imgur.com/def456.jpg", arcana: "minor", suit: "wands", element: "ç«", keywords: ["è®¡åˆ’", "å†³å®š", "å±•æœ›"] },
            // ...å…¶ä»–æƒæ–ç‰Œ...
            
            // å°é˜¿å¡çº³ - åœ£æ¯
            { name: "åœ£æ¯ä¸€", meaning: "æ–°çš„æƒ…æ„Ÿ,çˆ±,ç›´è§‰", reversed: "æƒ…æ„Ÿç©ºè™š,ä¸å®‰å…¨æ„Ÿ", image: "https://i.imgur.com/ghi789.jpg", arcana: "minor", suit: "cups", element: "æ°´", keywords: ["çˆ±", "ç›´è§‰", "æƒ…æ„Ÿ"] },
            // ...å…¶ä»–åœ£æ¯ç‰Œ...
            
            // å°é˜¿å¡çº³ - å®å‰‘
            { name: "å®å‰‘ä¸€", meaning: "å¿ƒæ™ºçªç ´,æ–°æƒ³æ³•", reversed: "æ··ä¹±,æ€ç»´ä¸æ¸…", image: "https://i.imgur.com/jkl012.jpg", arcana: "minor", suit: "swords", element: "é£", keywords: ["æ€æƒ³", "çªç ´", "æ¸…æ™°"] },
            // ...å…¶ä»–å®å‰‘ç‰Œ...
            
            // å°é˜¿å¡çº³ - æ˜Ÿå¸
            { name: "æ˜Ÿå¸ä¸€", meaning: "æ–°çš„è´¢åŠ¡æœºä¼š,ç‰©è´¨å¼€å§‹", reversed: "è´¢åŠ¡æŸå¤±,é”™å¤±æœºä¼š", image: "https://i.imgur.com/mno345.jpg", arcana: "minor", suit: "pentacles", element: "åœŸ", keywords: ["è´¢å¯Œ", "æœºä¼š", "ç‰©è´¨"] }
            // ...å…¶ä»–æ˜Ÿå¸ç‰Œ...
        ];
        
        // ç‰Œé˜µè§£é‡Š
        const spreadMeanings = {
            single: ["å½“å‰æƒ…å†µæˆ–é—®é¢˜çš„æ ¸å¿ƒ"],
            three: ["è¿‡å»çš„å½±å“", "å½“å‰çŠ¶å†µ", "å¯èƒ½çš„æœªæ¥"],
            five: ["ç°çŠ¶", "æŒ‘æˆ˜", "æ½œæ„è¯†å½±å“", "å¤–åœ¨å½±å“", "å¯èƒ½çš„ç»“æœ"],
            celtic: ["ç°çŠ¶", "æŒ‘æˆ˜", "æ½œæ„è¯†", "è¿‡å»", "ç›®æ ‡", "æœªæ¥", "è‡ªæˆ‘", "ç¯å¢ƒ", "å¸Œæœ›ä¸ææƒ§", "æœ€ç»ˆç»“æœ"],
            love: ["ä½ çš„æ„Ÿå—", "å¯¹æ–¹çš„æ„Ÿå—", "ä½ ä»¬çš„å…³ç³»ç°çŠ¶", "é˜»ç¢", "æ½œåœ¨å‘å±•", "å»ºè®®", "æœªæ¥å¯èƒ½"],
            career: ["å½“å‰å·¥ä½œçŠ¶æ€", "ä½ çš„ä¼˜åŠ¿", "ä½ çš„ä¸è¶³", "æœºä¼š", "å»ºè®®", "æœªæ¥å‘å±•"],
            finance: ["å½“å‰è´¢åŠ¡çŠ¶å†µ", "æ”¶å…¥æ¥æº", "æ”¯å‡ºé—®é¢˜", "æŠ•èµ„æœºä¼š", "é•¿æœŸè´¢åŠ¡å‰æ™¯"],
            family: ["å®¶åº­ç°çŠ¶", "å®¶åº­æˆå‘˜å…³ç³»", "å®¶åº­æŒ‘æˆ˜", "å®¶åº­ä¼˜åŠ¿", "æœªæ¥å®¶åº­å‘å±•", "å»ºè®®"]
        };
        
        // è‡ªå®šä¹‰ç‰Œé˜µå­˜å‚¨
        let customSpreads = JSON.parse(localStorage.getItem('customSpreads')) || {};
        
        // ä¸»é¢˜ç‰¹å®šçš„è§£é‡Š
        const themeInterpretations = {
            love: {
                "æ„šè€…": "æ–°çš„æµªæ¼«å¼€å§‹ï¼Œéšæ€§è€Œä¸º",
                "é­”æœ¯å¸ˆ": "è¿ç”¨é­…åŠ›å¸å¼•ä¼´ä¾£",
                "å¥³ç¥­å¸": "å€¾å¬ç›´è§‰å…³äºæ„Ÿæƒ…",
                // å…¶ä»–ç‰Œçš„è§£é‡Š...
            },
            // å…¶ä»–ä¸»é¢˜...
        };
        
        // DOMå…ƒç´ 
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        const spreadOptions = document.querySelectorAll('.spread-option');
        const categoryBtns = document.querySelectorAll('.category-btn');
        const cardContainer = document.getElementById('card-container');
        const drawBtn = document.getElementById('draw-btn');
        const resetBtn = document.getElementById('reset-btn');
        const resultDiv = document.getElementById('result');
        const historyDiv = document.getElementById('history');
        const questionInput = document.getElementById('question-input');
        const loadingDiv = document.getElementById('loading');
        const themeToggle = document.getElementById('theme-toggle');
        const dailyBtn = document.getElementById('daily-btn');
        const dailyResult = document.getElementById('daily-result');
        const dailyCard = document.getElementById('daily-card');
        const dailyInterpretation = document.getElementById('daily-interpretation');
        const createSpreadBtn = document.getElementById('create-spread-btn');
        const customSpreadDiv = document.getElementById('custom-spread');
        const customPositions = document.getElementById('custom-positions');
        const addPositionBtn = document.getElementById('add-position-btn');
        const saveCustomBtn = document.getElementById('save-custom-btn');
        const useCustomBtn = document.getElementById('use-custom-btn');
        const spreadNameInput = document.getElementById('spread-name');
        const cardLibrary = document.getElementById('card-library');
        const cardDetail = document.getElementById('card-detail');
        const timeline = document.getElementById('timeline');
        const dailyNotes = document.getElementById('daily-notes');
        const saveDailyNotesBtn = document.getElementById('save-daily-notes');
        
        // å½“å‰çŠ¶æ€
        let selectedSpread = null;
        let selectedCategory = 'general';
        let drawnCards = [];
        let readingHistory = JSON.parse(localStorage.getItem('tarotHistory')) || [];
        let todayCard = localStorage.getItem('todayCard');
        let todayDate = new Date().toDateString();
        let currentCustomSpread = null;
        
        // åˆå§‹åŒ–
        function init() {
            updateHistoryDisplay();
            checkDarkModePreference();
            loadCardLibrary();
            
            // æ£€æŸ¥æ˜¯å¦å·²ç»è·å–ä»Šæ—¥è¿åŠ¿
            if (todayCard && localStorage.getItem('todayDate') === todayDate) {
                showDailyCard(JSON.parse(todayCard));
                const savedNotes = localStorage.getItem('dailyNotes_' + new Date().toDateString());
                if (savedNotes) {
                    dailyNotes.value = savedNotes;
                }
            }
            
            // åŠ è½½æ—¶é—´çº¿
            updateTimeline();
        }
        
        // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦åå¥½æš—é»‘æ¨¡å¼
        function checkDarkModePreference() {
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            if (prefersDark) {
                document.body.classList.add('dark-mode');
            }
        }
        
        // åˆ‡æ¢æ ‡ç­¾é¡µ
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const tabId = tab.dataset.tab + '-tab';
                
                tabs.forEach(t => t.classList.remove('active'));
                tabContents.forEach(c => c.classList.remove('active'));
                
                tab.classList.add('active');
                document.getElementById(tabId).classList.add('active');
                
                // ç‰¹æ®Šæ ‡ç­¾é¡µå¤„ç†
                if (tab.dataset.tab === 'library') {
                    loadCardLibrary();
                }
            });
        });
        
        // é€‰æ‹©ç±»åˆ«
        categoryBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                const category = btn.dataset.category;
                const arcana = btn.dataset.arcana;
                const suit = btn.dataset.suit;
                const history = btn.dataset.history;
                
                if (category) {
                    categoryBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    selectedCategory = category;
                } else if (arcana || suit) {
                    // ç‰Œåº“åˆ†ç±»
                    categoryBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    filterCardLibrary(arcana, suit);
                } else if (history) {
                    // å†å²è®°å½•åˆ†ç±»
                    categoryBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    filterHistory(history);
                }
            });
        });
        
        // é€‰æ‹©ç‰Œé˜µ
        spreadOptions.forEach(option => {
            option.addEventListener('click', () => {
                spreadOptions.forEach(opt => opt.classList.remove('selected'));
                option.classList.add('selected');
                selectedSpread = option.dataset.spread;
                resetBtn.disabled = true;
                drawBtn.disabled = false;
            });
        });
        
        // å¼€å§‹å åœ
        drawBtn.addEventListener('click', () => {
            if (!selectedSpread) {
                alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªç‰Œé˜µ');
                return;
            }
            
            drawBtn.disabled = true;
            resetBtn.disabled = false;
            resultDiv.style.display = 'none';
            cardContainer.innerHTML = '';
            drawnCards = [];
            
            // æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
            loadingDiv.style.display = 'block';
            
            // æ¨¡æ‹ŸåŠ è½½æ—¶é—´
            setTimeout(() => {
                loadingDiv.style.display = 'none';
                createCards();
            }, 1500);
        });
        
        // åˆ›å»ºç‰Œ
        function createCards() {
            // æ ¹æ®ç‰Œé˜µåˆ›å»ºç‰Œ
            let cardCount = 1;
            let spreadPositions = [];
            
            if (selectedSpread === 'custom' && currentCustomSpread) {
                cardCount = currentCustomSpread.positions.length;
                spreadPositions = currentCustomSpread.positions;
            } else {
                cardCount = spreadMeanings[selectedSpread].length;
                spreadPositions = spreadMeanings[selectedSpread];
            }
            
            // æ´—ç‰Œ
            const shuffledDeck = [...tarotCards].sort(() => Math.random() - 0.5);
            
            for (let i = 0; i < cardCount; i++) {
                const card = document.createElement('div');
                card.className = 'card face-down';
                card.dataset.index = i;
                card.dataset.cardName = shuffledDeck[i].name;
                card.dataset.meaning = shuffledDeck[i].meaning;
                card.dataset.reversedMeaning = shuffledDeck[i].reversed;
                card.dataset.isReversed = Math.random() > 0.5;
                
                // æ·»åŠ ç‰Œæ–‡æœ¬
                const cardText = document.createElement('div');
                cardText.className = 'card-text';
                cardText.textContent = '?';
                card.appendChild(cardText);
                
                // æ·»åŠ ç‰Œå›¾åƒ
                const cardImage = document.createElement('img');
                cardImage.className = 'card-image';
                cardImage.src = shuffledDeck[i].image;
                cardImage.alt = shuffledDeck[i].name;
                card.appendChild(cardImage);
                
                // æ·»åŠ ç‰Œä½ç½®æ ‡ç­¾
                const positionLabel = document.createElement('div');
                positionLabel.className = 'card-position';
                positionLabel.textContent = spreadPositions[i];
                card.appendChild(positionLabel);
                
                card.addEventListener('click', revealCard);
                cardContainer.appendChild(card);
                drawnCards.push(card);
            }
        }
        
        // æ­ç¤ºç‰Œ
        function revealCard() {
            if (this.classList.contains('face-down')) {
                this.classList.remove('face-down');
                this.classList.add('face-up');
                
                // å¦‚æœæ˜¯é€†ä½ï¼Œæ·»åŠ é€†ä½ç±»
                if (this.dataset.isReversed === 'true') {
                    this.classList.add('reversed');
                }
                
                // æ£€æŸ¥æ˜¯å¦æ‰€æœ‰ç‰Œéƒ½å·²ç¿»å¼€
                checkAllRevealed();
            }
        }
        
        // æ£€æŸ¥æ˜¯å¦æ‰€æœ‰ç‰Œéƒ½å·²ç¿»å¼€
        function checkAllRevealed() {
            const allRevealed = [...drawnCards].every(card => card.classList.contains('face-up'));
            if (allRevealed) {
                showResult();
            }
        }
        
        // æ˜¾ç¤ºç»“æœ
        function showResult() {
            const question = questionInput.value.trim() || "æœªæŒ‡å®šé—®é¢˜";
            const date = new Date().toLocaleString();
            const cards = [];
            
            resultDiv.innerHTML = '<h3>å åœç»“æœ</h3>';
            resultDiv.innerHTML += `<p><strong>ç±»åˆ«:</strong> ${getCategoryName(selectedCategory)}</p>`;
            resultDiv.innerHTML += `<p><strong>é—®é¢˜:</strong> ${question}</p>`;
            resultDiv.innerHTML += `<p><strong>æ—¶é—´:</strong> ${date}</p>`;
            resultDiv.innerHTML += `<p><strong>ç‰Œé˜µ:</strong> ${getSpreadName(selectedSpread)}</p>`;
            
            drawnCards.forEach((card, index) => {
                let position = "";
                if (selectedSpread === 'custom' && currentCustomSpread) {
                    position = currentCustomSpread.positions[index];
                } else {
                    position = spreadMeanings[selectedSpread][index];
                }
                
                const isReversed = card.dataset.isReversed === 'true';
                let meaning = isReversed ? card.dataset.reversedMeaning : card.dataset.meaning;
                
                // æ·»åŠ ä¸»é¢˜ç‰¹å®šçš„è§£é‡Š
                if (selectedCategory !== 'general' && themeInterpretations[selectedCategory] && themeInterpretations[selectedCategory][card.dataset.cardName]) {
                    const themeMeaning = isReversed ? 
                        (themeInterpretations[selectedCategory][card.dataset.cardName + ' reversed'] || themeInterpretations[selectedCategory][card.dataset.cardName]) : 
                        themeInterpretations[selectedCategory][card.dataset.cardName];
                    if (themeMeaning) {
                        meaning += ` (${selectedCategory}æ–¹é¢: ${themeMeaning})`;
                    }
                }
                
                resultDiv.innerHTML += `
                    <div class="card-result">
                        <p><strong>${position}: ${card.dataset.cardName}${isReversed ? ' (é€†ä½)' : ''}</strong></p>
                        <p class="interpretation">${meaning}</p>
                        <button class="btn view-details-btn" data-card="${card.dataset.cardName}" style="padding: 5px 10px; font-size: 0.8rem; margin-top: 5px;">æŸ¥çœ‹ç‰Œé¢è¯¦æƒ…</button>
                    </div>
                `;
                
                cards.push({
                    name: card.dataset.cardName,
                    position: position,
                    isReversed: isReversed,
                    meaning: meaning
                });
            });
            
            // æ·»åŠ ç»„åˆåˆ†æ
            if (drawnCards.length > 1) {
                const combinationAnalysis = analyzeCombination(cards);
                if (combinationAnalysis) {
                    resultDiv.innerHTML += `
                        <div class="combination-analysis">
                            <h4>ç‰Œé¢ç»„åˆåˆ†æ</h4>
                            <p>${combinationAnalysis}</p>
                        </div>
                    `;
                }
            }
            
            // æ·»åŠ å»ºè®®
            const advice = getAdviceBasedOnReading(cards, selectedCategory);
            if (advice) {
                resultDiv.innerHTML += `
                    <div class="advice">
                        <h4>å»ºè®®</h4>
                        <p>${advice}</p>
                    </div>
                `;
            }
            
            // æ·»åŠ ä¿å­˜æŒ‰é’®å’Œç¬”è®°
            resultDiv.innerHTML += `
                <div class="save-form">
                    <input type="text" class="save-input" id="reading-title" placeholder="ä¸ºè¿™æ¬¡å åœæ·»åŠ æ ‡é¢˜ï¼ˆå¯é€‰ï¼‰">
                    <textarea class="notes-input" id="reading-notes" placeholder="è®°å½•ä½ çš„è§£è¯»æˆ–æ„Ÿæ‚Ÿ..."></textarea>
                    <button class="btn" id="save-btn">ä¿å­˜è®°å½•</button>
                </div>
            `;
            
            // æ·»åŠ ä¿å­˜æŒ‰é’®äº‹ä»¶
            document.getElementById('save-btn').addEventListener('click', () => {
                saveReading(question, date, cards);
            });
            
            // æ·»åŠ æŸ¥çœ‹è¯¦æƒ…æŒ‰é’®äº‹ä»¶
            document.querySelectorAll('.view-details-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const cardName = this.dataset.card;
                    showCardDetails(cardName);
                });
            });
            
            resultDiv.style.display = 'block';
            
            // æ»šåŠ¨åˆ°ç»“æœåŒºåŸŸ
            resultDiv.scrollIntoView({ behavior: 'smooth' });
        }
        
        // è·å–ç±»åˆ«åç§°
        function getCategoryName(category) {
            switch(category) {
                case 'general': return 'é€šç”¨';
                case 'love': return 'çˆ±æƒ…';
                case 'career': return 'äº‹ä¸š';
                case 'health': return 'å¥åº·';
                case 'spiritual': return 'å¿ƒçµ';
                case 'finance': return 'è´¢åŠ¡';
                case 'family': return 'å®¶åº­';
                default: return 'é€šç”¨';
            }
        }
        
        // è·å–ç‰Œé˜µåç§°
        function getSpreadName(spread) {
            switch(spread) {
                case 'single': return 'å•ç‰Œé˜µ';
                case 'three': return 'ä¸‰ç‰Œé˜µï¼ˆè¿‡å»-ç°åœ¨-æœªæ¥ï¼‰';
                case 'five': return 'äº”ç‰Œé˜µ';
                case 'celtic': return 'å‡¯å°”ç‰¹åå­—';
                case 'love': return 'çˆ±æƒ…ç‰Œé˜µ';
                case 'career': return 'äº‹ä¸šç‰Œé˜µ';
                case 'finance': return 'è´¢åŠ¡ç‰Œé˜µ';
                case 'family': return 'å®¶åº­ç‰Œé˜µ';
                default: 
                    if (spread in customSpreads) {
                        return customSpreads[spread].name;
                    }
                    return 'è‡ªå®šä¹‰ç‰Œé˜µ';
            }
        }
        
        // åˆ†æç‰Œé¢ç»„åˆ
        function analyzeCombination(cards) {
            const cardNames = cards.map(c => c.name);
            const reversedCount = cards.filter(c => c.isReversed).length;
            
            // æ£€æŸ¥æ˜¯å¦æœ‰ç‰¹å®šç‰Œç»„åˆ
            if (cardNames.includes("æ­»ç¥") && cardNames.includes("å¡”")) {
                return "æ­»ç¥ä¸å¡”çš„ç»„åˆé¢„ç¤ºç€é‡å¤§è½¬å˜å’Œçªç„¶å˜åŒ–ï¼Œè¿™å¯èƒ½æ˜¯ä¸€ä¸ªè‰°éš¾çš„æ—¶æœŸï¼Œä½†ä¹Ÿæ˜¯å½»åº•è½¬å˜å’Œæ–°å¼€å§‹çš„å¥‘æœºã€‚";
            }
            
            if (cardNames.includes("æ˜Ÿæ˜Ÿ") && cardNames.includes("å¤ªé˜³")) {
                return "æ˜Ÿæ˜Ÿä¸å¤ªé˜³çš„ç»„åˆæ˜¯éå¸¸ç§¯æçš„ä¿¡å·ï¼Œé¢„ç¤ºç€å¸Œæœ›ã€æˆåŠŸå’Œå…‰æ˜æœªæ¥çš„åˆ°æ¥ã€‚";
            }
            
            if (cardNames.includes("å¥³ç¥­å¸") && cardNames.includes("éšå£«")) {
                return "å¥³ç¥­å¸ä¸éšå£«çš„ç»„åˆå¼ºè°ƒéœ€è¦å†…çœå’Œå€¾å¬å†…åœ¨å£°éŸ³ï¼Œç°åœ¨æ˜¯å…³æ³¨å†…åœ¨æ™ºæ…§çš„æ—¶æœºã€‚";
            }
            
            // æ£€æŸ¥é€†ä½ç‰Œæ•°é‡
            if (reversedCount > cards.length / 2) {
                return "å¤šæ•°ç‰Œä¸ºé€†ä½ï¼Œè¡¨æ˜å½“å‰æƒ…å†µå¯èƒ½å­˜åœ¨é˜»ç¢æˆ–å†…åœ¨å†²çªï¼Œéœ€è¦ç‰¹åˆ«å…³æ³¨è¿™äº›æŒ‘æˆ˜ã€‚";
            }
            
            // æ ¹æ®ç‰Œé˜µç±»å‹æä¾›åˆ†æ
            if (selectedSpread === 'three') {
                const past = cards[0];
                const present = cards[1];
                const future = cards[2];
                
                if (past.isReversed && !present.isReversed && !future.isReversed) {
                    return "ä»è¿‡å»çš„å›°éš¾(é€†ä½)åˆ°ç°åœ¨çš„æ­£ä½å’Œæœªæ¥çš„æ­£ä½ï¼Œæ˜¾ç¤ºä½ æ­£åœ¨ä»æŒ‘æˆ˜ä¸­èµ°å‡ºï¼Œæœªæ¥ä¼šæ›´åŠ é¡ºåˆ©ã€‚";
                }
            }
            
            if (selectedSpread === 'love') {
                const yourFeelings = cards[0];
                const theirFeelings = cards[1];
                
                if (!yourFeelings.isReversed && theirFeelings.isReversed) {
                    return "ä½ å¯¹æ­¤å…³ç³»çš„æ€åº¦æ˜¯æ˜ç¡®çš„ï¼Œä½†å¯¹æ–¹å¯èƒ½å­˜åœ¨çŠ¹è±«æˆ–æœªè¡¨è¾¾çš„æ„Ÿå—ï¼Œéœ€è¦æ›´å¤šæ²Ÿé€šã€‚";
                }
            }
            
            return "ç‰Œé¢ç»„åˆæ˜¾ç¤ºå‡ºå¤šæ ·åŒ–çš„èƒ½é‡ï¼Œæ¯å¼ ç‰Œçš„ä½ç½®å’Œç›¸äº’å…³ç³»éƒ½éœ€è¦è¢«ä»”ç»†è€ƒè™‘ã€‚";
        }
        
        // æ ¹æ®å åœç»“æœæä¾›å»ºè®®
        function getAdviceBasedOnReading(cards, category) {
            const majorArcana = ["æ„šè€…", "é­”æœ¯å¸ˆ", "å¥³ç¥­å¸", "çš‡å", "çš‡å¸", "æ•™çš‡", "æ‹äºº", 
                               "æˆ˜è½¦", "åŠ›é‡", "éšå£«", "å‘½è¿ä¹‹è½®", "æ­£ä¹‰", "å€’åŠäºº", "æ­»ç¥", 
                               "èŠ‚åˆ¶", "æ¶é­”", "å¡”", "æ˜Ÿæ˜Ÿ", "æœˆäº®", "å¤ªé˜³", "å®¡åˆ¤", "ä¸–ç•Œ"];
            
            const majorCount = cards.filter(c => majorArcana.some(m => c.name.includes(m))).length;
            const reversedCount = cards.filter(c => c.isReversed).length;
            
            let advice = "";
            
            // æ ¹æ®å¤§é˜¿å¡çº³æ•°é‡æä¾›å»ºè®®
            if (majorCount > cards.length / 2) {
                advice += "å¤šæ•°ç‰Œä¸ºå¤§é˜¿å¡çº³ï¼Œè¡¨æ˜è¿™æ˜¯ä¸€ä¸ªé‡è¦çš„ç”Ÿå‘½è¯¾é¢˜æˆ–è½¬æŠ˜ç‚¹ã€‚";
            }
            
            // æ ¹æ®é€†ä½ç‰Œæ•°é‡æä¾›å»ºè®®
            if (reversedCount > 0) {
                advice += `æœ‰${reversedCount}å¼ é€†ä½ç‰Œï¼Œæç¤ºéœ€è¦æ³¨æ„è¿™äº›æ–¹é¢çš„é˜»ç¢æˆ–å†…åœ¨å†²çªã€‚`;
            }
            
            // æ ¹æ®ç±»åˆ«æä¾›ç‰¹å®šå»ºè®®
            switch(category) {
                case 'love':
                    advice += "åœ¨æ„Ÿæƒ…æ–¹é¢ï¼Œå»ºè®®ä¿æŒå¼€æ”¾æ²Ÿé€šï¼ŒçœŸè¯šè¡¨è¾¾ä½ çš„æ„Ÿå—å’Œéœ€æ±‚ã€‚";
                    if (cards.some(c => c.name.includes("æ‹äºº"))) {
                        advice += "æ‹äººç‰Œçš„å‡ºç°å¼ºè°ƒå…³ç³»ä¸­çš„å’Œè°ä¸é€‰æ‹©çš„é‡è¦æ€§ã€‚";
                    }
                    break;
                case 'career':
                    advice += "åœ¨äº‹ä¸šæ–¹é¢ï¼Œå»ºè®®ä¸“æ³¨äºä½ çš„é•¿æœŸç›®æ ‡ï¼ŒåŒæ—¶ä¿æŒçµæ´»æ€§ä»¥é€‚åº”å˜åŒ–ã€‚";
                    if (cards.some(c => c.name.includes("æˆ˜è½¦"))) {
                        advice += "æˆ˜è½¦ç‰Œæç¤ºä½ éœ€è¦æ„å¿—åŠ›å’Œå†³å¿ƒæ¥å…‹æœèŒä¸šæŒ‘æˆ˜ã€‚";
                    }
                    break;
                case 'health':
                    advice += "åœ¨å¥åº·æ–¹é¢ï¼Œå»ºè®®å€¾å¬èº«ä½“çš„ä¿¡å·ï¼Œä¿æŒå¹³è¡¡çš„ç”Ÿæ´»æ–¹å¼ã€‚";
                    if (cards.some(c => c.name.includes("åŠ›é‡"))) {
                        advice += "åŠ›é‡ç‰Œæç¤ºä½ æœ‰å†…åœ¨çš„éŸ§æ€§æ¥æ”¹å–„å¥åº·çŠ¶å†µã€‚";
                    }
                    break;
                case 'spiritual':
                    advice += "åœ¨å¿ƒçµæˆé•¿æ–¹é¢ï¼Œå»ºè®®ç•™å‡ºæ—¶é—´è¿›è¡Œå†¥æƒ³æˆ–åæ€ï¼Œå…³æ³¨å†…åœ¨æ™ºæ…§ã€‚";
                    if (cards.some(c => c.name.includes("éšå£«"))) {
                        advice += "éšå£«ç‰Œçš„å‡ºç°è¡¨æ˜ç°åœ¨æ˜¯å†…çœå’Œå¯»æ±‚çœŸç†çš„æœ‰åˆ©æ—¶æœºã€‚";
                    }
                    break;
                case 'finance':
                    advice += "åœ¨è´¢åŠ¡æ–¹é¢ï¼Œå»ºè®®è°¨æ…ç®¡ç†èµ„é‡‘ï¼Œé¿å…å†²åŠ¨æ¶ˆè´¹æˆ–æŠ•èµ„ã€‚";
                    if (cards.some(c => c.name.includes("æ˜Ÿå¸"))) {
                        advice += "æ˜Ÿå¸ç‰Œæç¤ºä½ éœ€è¦å…³æ³¨å®é™…çš„è´¢åŠ¡è§„åˆ’å’Œç®¡ç†ã€‚";
                    }
                    break;
                case 'family':
                    advice += "åœ¨å®¶åº­æ–¹é¢ï¼Œå»ºè®®åŠ å¼ºå®¶åº­æˆå‘˜é—´çš„æ²Ÿé€šå’Œç†è§£ã€‚";
                    if (cards.some(c => c.name.includes("çš‡å"))) {
                        advice += "çš‡åç‰Œçš„å‡ºç°å¼ºè°ƒå®¶åº­ä¸­çš„å…»è‚²å’Œå…³æ€€çš„é‡è¦æ€§ã€‚";
                    }
                    break;
                default:
                    advice += "å»ºè®®ä¿æŒå¼€æ”¾å¿ƒæ€ï¼Œä»å¤šä¸ªè§’åº¦è€ƒè™‘å½“å‰æƒ…å†µã€‚";
            }
            
            return advice;
        }
        
        // ä¿å­˜å åœè®°å½•
        function saveReading(question, date, cards) {
            const title = document.getElementById('reading-title').value.trim() || `å åœè®°å½• ${readingHistory.length + 1}`;
            const notes = document.getElementById('reading-notes').value.trim();
            
            const reading = {
                title: title,
                question: question,
                date: date,
                category: selectedCategory,
                spread: selectedSpread,
                cards: cards,
                notes: notes
            };
            
            readingHistory.unshift(reading);
            localStorage.setItem('tarotHistory', JSON.stringify(readingHistory));
            
            alert('å åœè®°å½•å·²ä¿å­˜ï¼');
            updateHistoryDisplay();
            updateTimeline();
        }
        
        // æ›´æ–°å†å²è®°å½•æ˜¾ç¤º
        function updateHistoryDisplay() {
            if (readingHistory.length === 0) {
                historyDiv.innerHTML = '<p>æš‚æ— å†å²è®°å½•</p>';
                return;
            }
            
            historyDiv.innerHTML = '';
            readingHistory.forEach((reading, index) => {
                const item = document.createElement('div');
                item.className = 'history-item';
                item.dataset.category = reading.category;
                item.innerHTML = `
                    <h4>${reading.title}</h4>
                    <p><strong>ç±»åˆ«:</strong> ${getCategoryName(reading.category)}</p>
                    <p><strong>é—®é¢˜:</strong> ${reading.question}</p>
                    <p><strong>ç‰Œé˜µ:</strong> ${getSpreadName(reading.spread)}</p>
                    <p class="history-date">${reading.date}</p>
                `;
                
                item.addEventListener('click', () => {
                    showHistoryReading(reading);
                });
                
                historyDiv.appendChild(item);
            });
            
            historyDiv.style.display = 'block';
        }
        
        // è¿‡æ»¤å†å²è®°å½•
        function filterHistory(category) {
            const items = historyDiv.querySelectorAll('.history-item');
            items.forEach(item => {
                if (category === 'all' || item.dataset.category === category) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }
        
        // æ˜¾ç¤ºå†å²å åœè®°å½•
        function showHistoryReading(reading) {
            // åˆ‡æ¢åˆ°å åœæ ‡ç­¾
            tabs.forEach(t => t.classList.remove('active'));
            tabContents.forEach(c => c.classList.remove('active'));
            
            document.querySelector('[data-tab="divination"]').classList.add('active');
            document.getElementById('divination-tab').classList.add('active');
            
            // æ˜¾ç¤ºç»“æœ
            resultDiv.innerHTML = '<h3>å†å²å åœè®°å½•</h3>';
            resultDiv.innerHTML += `<p><strong>æ ‡é¢˜:</strong> ${reading.title}</p>`;
            resultDiv.innerHTML += `<p><strong>ç±»åˆ«:</strong> ${getCategoryName(reading.category)}</p>`;
            resultDiv.innerHTML += `<p><strong>é—®é¢˜:</strong> ${reading.question}</p>`;
            resultDiv.innerHTML += `<p><strong>æ—¶é—´:</strong> ${reading.date}</p>`;
            resultDiv.innerHTML += `<p><strong>ç‰Œé˜µ:</strong> ${getSpreadName(reading.spread)}</p>`;
            
            reading.cards.forEach(card => {
                resultDiv.innerHTML += `
                    <div class="card-result">
                        <p><strong>${card.position}: ${card.name}${card.isReversed ? ' (é€†ä½)' : ''}</strong></p>
                        <p class="interpretation">${card.meaning}</p>
                        <button class="btn view-details-btn" data-card="${card.name.split('. ')[1] || card.name}" style="padding: 5px 10px; font-size: 0.8rem; margin-top: 5px;">æŸ¥çœ‹ç‰Œé¢è¯¦æƒ…</button>
                    </div>
                `;
            });
            
            // æ·»åŠ ç»„åˆåˆ†æ
            if (reading.cards.length > 1) {
                const combinationAnalysis = analyzeCombination(reading.cards);
                if (combinationAnalysis) {
                    resultDiv.innerHTML += `
                        <div class="combination-analysis">
                            <h4>ç‰Œé¢ç»„åˆåˆ†æ</h4>
                            <p>${combinationAnalysis}</p>
                        </div>
                    `;
                }
            }
            
            // æ·»åŠ å»ºè®®
            const advice = getAdviceBasedOnReading(reading.cards, reading.category);
            if (advice) {
                resultDiv.innerHTML += `
                    <div class="advice">
                        <h4>å»ºè®®</h4>
                        <p>${advice}</p>
                    </div>
                `;
            }
            
            // æ·»åŠ ç¬”è®°
            if (reading.notes) {
                resultDiv.innerHTML += `
                    <div class="advice">
                        <h4>ä½ çš„ç¬”è®°</h4>
                        <p>${reading.notes}</p>
                    </div>
                `;
            }
            
            // æ·»åŠ æŸ¥çœ‹è¯¦æƒ…æŒ‰é’®äº‹ä»¶
            document.querySelectorAll('.view-details-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const cardName = this.dataset.card;
                    showCardDetails(cardName);
                });
            });
            
            resultDiv.style.display = 'block';
            
            // æ»šåŠ¨åˆ°ç»“æœåŒºåŸŸ
            resultDiv.scrollIntoView({ behavior: 'smooth' });
        }
        
        // é‡ç½®
        resetBtn.addEventListener('click', () => {
            cardContainer.innerHTML = '';
            resultDiv.style.display = 'none';
            drawBtn.disabled = false;
            resetBtn.disabled = true;
            drawnCards = [];
            questionInput.value = '';
        });
        
        // è·å–æ¯æ—¥è¿åŠ¿
        dailyBtn.addEventListener('click', () => {
            dailyBtn.disabled = true;
            
            // éšæœºé€‰æ‹©ä¸€å¼ ç‰Œ
            const randomCard = tarotCards[Math.floor(Math.random() * tarotCards.length)];
            const isReversed = Math.random() > 0.5;
            
            const dailyCardData = {
                name: randomCard.name,
                meaning: isReversed ? randomCard.reversedMeaning : randomCard.meaning,
                isReversed: isReversed,
                image: randomCard.image
            };
            
            // ä¿å­˜ä»Šæ—¥ç‰Œ
            todayCard = JSON.stringify(dailyCardData);
            localStorage.setItem('todayCard', todayCard);
            localStorage.setItem('todayDate', todayDate);
            
            // æ˜¾ç¤ºæ¯æ—¥ç‰Œ
            showDailyCard(dailyCardData);
        });
        
        // æ˜¾ç¤ºæ¯æ—¥ç‰Œ
        function showDailyCard(cardData) {
            dailyResult.style.display = 'block';
            dailyCard.innerHTML = '';
            
            // åˆ›å»ºç‰Œå…ƒç´ 
            const card = document.createElement('div');
            card.className = `card face-up ${cardData.isReversed ? 'reversed' : ''}`;
            
            // æ·»åŠ ç‰Œå›¾åƒ
            const cardImage = document.createElement('img');
            cardImage.className = 'card-image';
            cardImage.src = cardData.image;
            cardImage.alt = cardData.name;
            card.appendChild(cardImage);
            
            // æ·»åŠ ç‰Œä½ç½®æ ‡ç­¾
            const positionLabel = document.createElement('div');
            positionLabel.className = 'card-position';
            positionLabel.textContent = 'ä»Šæ—¥è¿åŠ¿';
            card.appendChild(positionLabel);
            
            dailyCard.appendChild(card);
            
            // æ˜¾ç¤ºè§£é‡Š
            dailyInterpretation.innerHTML = `
                <h3>${cardData.name} ${cardData.isReversed ? '(é€†ä½)' : ''}</h3>
                <p class="interpretation">${cardData.meaning}</p>
                <div class="advice">
                    <h4>ä»Šæ—¥å»ºè®®</h4>
                    <p>${getDailyAdvice(cardData)}</p>
                </div>
            `;
            
            // æ»šåŠ¨åˆ°ç»“æœåŒºåŸŸ
            dailyResult.scrollIntoView({ behavior: 'smooth' });
        }
        
        // ä¿å­˜æ¯æ—¥ç¬”è®°
        saveDailyNotesBtn.addEventListener('click', () => {
            const notes = dailyNotes.value.trim();
            localStorage.setItem('dailyNotes_' + new Date().toDateString(), notes);
            alert('æ¯æ—¥ç¬”è®°å·²ä¿å­˜ï¼');
        });
        
        // è·å–æ¯æ—¥å»ºè®®
        function getDailyAdvice(cardData) {
            const cardName = cardData.name.split('. ')[1] || cardData.name;
            const isReversed = cardData.isReversed;
            
            switch(cardName) {
                case "æ„šè€…":
                    return isReversed ? "ä»Šå¤©è¦è°¨æ…è¡Œäº‹ï¼Œé¿å…å†²åŠ¨å†³å®š" : "ä»Šå¤©æ˜¯å°è¯•æ–°äº‹ç‰©çš„å¥½æ—¶æœºï¼Œä¿æŒå¼€æ”¾å¿ƒæ€";
                case "é­”æœ¯å¸ˆ":
                    return isReversed ? "æ³¨æ„ä¸è¦è¿‡åº¦è‡ªä¿¡æˆ–æ“çºµä»–äºº" : "è¿ç”¨ä½ çš„æŠ€èƒ½å’Œåˆ›é€ åŠ›è§£å†³é—®é¢˜";
                case "å¥³ç¥­å¸":
                    return isReversed ? "ä¸è¦å¿½è§†ä½ çš„ç›´è§‰ä¿¡å·" : "å€¾å¬ä½ çš„å†…åœ¨æ™ºæ…§ï¼Œå…³æ³¨æ½œæ„è¯†ä¿¡æ¯";
                case "çš‡å":
                    return isReversed ? "é¿å…è¿‡åº¦æ”¾çºµæˆ–ä¾èµ–ä»–äºº" : "åŸ¹å…»è€å¿ƒå’Œå…³æ€€ï¼Œå…³æ³¨ç”Ÿæ´»ä¸­çš„ç¾å¥½";
                case "çš‡å¸":
                    return isReversed ? "ä¸è¦è¿‡äºä¸“åˆ¶æˆ–æ§åˆ¶" : "å±•ç°é¢†å¯¼åŠ›ï¼Œå»ºç«‹ç»“æ„å’Œç§©åº";
                case "æ‹äºº":
                    return isReversed ? "æ³¨æ„å…³ç³»ä¸­çš„ä¸å¹³è¡¡æˆ–å†²çª" : "å…³æ³¨å’Œè°çš„å…³ç³»ï¼Œåšå‡ºæ˜æ™ºé€‰æ‹©";
                case "æˆ˜è½¦":
                    return isReversed ? "ä»Šå¤©å¯èƒ½éœ€è¦é‡æ–°è¯„ä¼°æ–¹å‘" : "ç”¨æ„å¿—åŠ›å’Œå†³å¿ƒå…‹æœæŒ‘æˆ˜";
                case "åŠ›é‡":
                    return isReversed ? "ä½ å¯èƒ½ä½ä¼°äº†è‡ªå·±çš„å†…åœ¨åŠ›é‡" : "ç”¨å‹‡æ°”å’Œè€å¿ƒé¢å¯¹æŒ‘æˆ˜";
                case "éšå£«":
                    return isReversed ? "ä¸è¦å­¤ç«‹è‡ªå·±ï¼Œå¿…è¦æ—¶å¯»æ±‚å¸®åŠ©" : "èŠ±æ—¶é—´ç‹¬å¤„å’Œå†…çœ";
                case "æ­»ç¥":
                    return isReversed ? "æŠ—æ‹’æ”¹å˜åªä¼šå»¶é•¿ç—›è‹¦" : "æ¥å—ç»“æŸå’Œè½¬å˜ï¼Œä¸ºæ–°å¼€å§‹åšå‡†å¤‡";
                // å…¶ä»–ç‰Œçš„å»ºè®®...
                default:
                    return "ä»Šå¤©ä¿æŒå¹³è¡¡å’Œé€‚åº¦æ˜¯å…³é”®";
            }
        }
        
        // è‡ªå®šä¹‰ç‰Œé˜µåŠŸèƒ½
        createSpreadBtn.addEventListener('click', () => {
            customSpreadDiv.style.display = 'block';
            currentCustomSpread = {
                name: "",
                positions: []
            };
            customPositions.innerHTML = '';
        });
        
        addPositionBtn.addEventListener('click', () => {
            const positionDiv = document.createElement('div');
            positionDiv.className = 'custom-position';
            positionDiv.innerHTML = `
                <input type="text" placeholder="è¾“å…¥ä½ç½®å«ä¹‰" class="position-input">
            `;
            customPositions.appendChild(positionDiv);
        });
        
        saveCustomBtn.addEventListener('click', () => {
            const name = spreadNameInput.value.trim();
            if (!name) {
                alert('è¯·è¾“å…¥ç‰Œé˜µåç§°');
                return;
            }
            
            const positions = [];
            const inputs = customPositions.querySelectorAll('.position-input');
            inputs.forEach(input => {
                if (input.value.trim()) {
                    positions.push(input.value.trim());
                }
            });
            
            if (positions.length === 0) {
                alert('è¯·è‡³å°‘æ·»åŠ ä¸€ä¸ªä½ç½®å«ä¹‰');
                return;
            }
            
            const spreadId = 'custom_' + Date.now();
            customSpreads[spreadId] = {
                name: name,
                positions: positions
            };
            
            localStorage.setItem('customSpreads', JSON.stringify(customSpreads));
            alert('è‡ªå®šä¹‰ç‰Œé˜µå·²ä¿å­˜ï¼');
        });
        
        useCustomBtn.addEventListener('click', () => {
            const name = spreadNameInput.value.trim();
            if (!name) {
                alert('è¯·è¾“å…¥ç‰Œé˜µåç§°');
                return;
            }
            
            const positions = [];
            const inputs = customPositions.querySelectorAll('.position-input');
            inputs.forEach(input => {
                if (input.value.trim()) {
                    positions.push(input.value.trim());
                }
            });
            
            if (positions.length === 0) {
                alert('è¯·è‡³å°‘æ·»åŠ ä¸€ä¸ªä½ç½®å«ä¹‰');
                return;
            }
            
            currentCustomSpread = {
                name: name,
                positions: positions
            };
            
            selectedSpread = 'custom';
            drawBtn.disabled = false;
            resetBtn.disabled = true;
            
            // åˆ‡æ¢åˆ°å åœæ ‡ç­¾
            tabs.forEach(t => t.classList.remove('active'));
            tabContents.forEach(c => c.classList.remove('active'));
            
            document.querySelector('[data-tab="divination"]').classList.add('active');
            document.getElementById('divination-tab').classList.add('active');
            
            alert('å·²å‡†å¤‡å¥½ä½¿ç”¨è‡ªå®šä¹‰ç‰Œé˜µï¼Œç‚¹å‡»"å¼€å§‹å åœ"å³å¯');
        });
        
        // ç‰Œåº“åŠŸèƒ½
        function loadCardLibrary(filter = 'all') {
            cardLibrary.innerHTML = '';
            cardLibrary.style.display = 'flex';
            cardDetail.style.display = 'none';
            
            tarotCards.forEach(card => {
                const item = document.createElement('div');
                item.className = 'card-library-item';
                item.innerHTML = `
                    <img src="${card.image}" alt="${card.name}">
                    <p>${card.name}</p>
                `;
                
                item.addEventListener('click', () => {
                    showCardDetails(card.name.split('. ')[1] || card.name);
                });
                
                cardLibrary.appendChild(item);
            });
        }
        
        function filterCardLibrary(arcana, suit) {
            cardLibrary.innerHTML = '';
            
            let filteredCards = tarotCards;
            
            if (arcana === 'major') {
                filteredCards = tarotCards.filter(card => card.arcana === 'major');
            } else if (arcana === 'minor') {
                filteredCards = tarotCards.filter(card => card.arcana === 'minor');
            } else if (suit) {
                filteredCards = tarotCards.filter(card => card.suit === suit);
            }
            
            filteredCards.forEach(card => {
                const item = document.createElement('div');
                item.className = 'card-library-item';
                item.innerHTML = `
                    <img src="${card.image}" alt="${card.name}">
                    <p>${card.name}</p>
                `;
                
                item.addEventListener('click', () => {
                    showCardDetails(card.name.split('. ')[1] || card.name);
                });
                
                cardLibrary.appendChild(item);
            });
        }
        
        function showCardDetails(cardName) {
            const card = tarotCards.find(c => c.name.includes(cardName));
            if (!card) return;
            
            cardLibrary.style.display = 'none';
            cardDetail.style.display = 'block';
            cardDetail.innerHTML = `
                <h3>${card.name}</h3>
                <div style="text-align: center; margin: 15px 0;">
                    <img src="${card.image}" alt="${card.name}" style="max-width: 150px; border-radius: 8px;">
                </div>
                
                <h4>æ­£ä½å«ä¹‰</h4>
                <p>${card.meaning}</p>
                
                <h4>é€†ä½å«ä¹‰</h4>
                <p>${card.reversedMeaning}</p>
                
                <div class="card-details">
                    <h4>ç‰Œé¢è±¡å¾</h4>
                    <div class="card-symbolism">
                        ${card.element ? `<span class="symbol-item">å…ƒç´ : ${card.element}</span>` : ''}
                        ${card.astrology ? `<span class="symbol-item">å æ˜Ÿ: ${card.astrology}</span>` : ''}
                        ${card.numerology !== undefined ? `<span class="symbol-item">æ•°å­—: ${card.numerology}</span>` : ''}
                        ${card.keywords ? card.keywords.map(kw => `<span class="symbol-item">${kw}</span>`).join('') : ''}
                    </div>
                </div>
                
                <button class="btn" id="back-to-library" style="margin-top: 15px;">è¿”å›ç‰Œåº“</button>
            `;
            
            document.getElementById('back-to-library').addEventListener('click', () => {
                cardLibrary.style.display = 'flex';
                cardDetail.style.display = 'none';
            });
            
            cardDetail.scrollIntoView({ behavior: 'smooth' });
        }
        
        // æ—¶é—´çº¿åŠŸèƒ½
        function updateTimeline() {
            timeline.innerHTML = '';
            
            if (readingHistory.length === 0) {
                timeline.innerHTML = '<p>æš‚æ— å åœè®°å½•</p>';
                return;
            }
            
            // æŒ‰æ—¥æœŸåˆ†ç»„
            const groupedByDate = {};
            readingHistory.forEach(reading => {
                const date = reading.date.split(',')[0]; // åªå–æ—¥æœŸéƒ¨åˆ†
                if (!groupedByDate[date]) {
                    groupedByDate[date] = [];
                }
                groupedByDate[date].push(reading);
            });
            
            // æ˜¾ç¤ºæ—¶é—´çº¿
            Object.keys(groupedByDate).forEach(date => {
                const dateDiv = document.createElement('div');
                dateDiv.className = 'timeline-item';
                dateDiv.innerHTML = `
                    <div class="timeline-date">${date}</div>
                    <div class="timeline-content">
                        <h4>${date}</h4>
                `;
                
                groupedByDate[date].forEach(reading => {
                    dateDiv.querySelector('.timeline-content').innerHTML += `
                        <div style="margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px dashed #ddd;">
                            <p><strong>${reading.title}</strong> (${getCategoryName(reading.category)})</p>
                            <p>${reading.question || 'æ— å…·ä½“é—®é¢˜'}</p>
                            <p style="font-size: 0.8rem; color: #666;">${reading.spread}</p>
                        </div>
                    `;
                });
                
                dateDiv.querySelector('.timeline-content').innerHTML += `</div>`;
                timeline.appendChild(dateDiv);
            });
        }
        
        // åˆ‡æ¢ä¸»é¢˜
        themeToggle.addEventListener('click', () => {
            document.body.classList.toggle('dark-mode');
        });
        
        // åˆå§‹åŒ–åº”ç”¨
        init();
    </script>
</body>
</html>