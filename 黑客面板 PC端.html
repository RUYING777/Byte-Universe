<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>黑客面板</title>
    <style>
        :root {
            --bg-color: #000;
            --text-color: #0f0;
            --accent-color: #0a0;
            --panel-bg: #111;
            --panel-border: #333;
            --selection-bg: #0a0;
            --selection-text: #000;
            --error-color: #f00;
            --warning-color: #ff0;
            --success-color: #0f0;
            --money-color: #ffd700;
            --hack-color: #00ffff;
            --player-color: #ff00ff;
            --corp-network: #5555ff;
            --home-network: #55ff55;
        }
        
        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Courier New', monospace;
            margin: 0;
            padding: 0;
            height: 100vh;
            overflow: hidden;
        }
        
        #terminal {
            display: flex;
            flex-direction: column;
            height: 100vh;
            padding: 10px;
            box-sizing: border-box;
        }
        
        #header {
            display: flex;
            justify-content: space-between;
            border-bottom: 1px solid var(--accent-color);
            padding-bottom: 5px;
            margin-bottom: 10px;
        }
        
        #logo {
            font-weight: bold;
            color: var(--accent-color);
        }
        
        #status-bar {
            display: flex;
            gap: 15px;
        }
        
        .status-item {
            display: flex;
            align-items: center;
        }
        
        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 5px;
        }
        
        .online {
            background-color: var(--success-color);
            box-shadow: 0 0 5px var(--success-color);
        }
        
        .anonymous {
            background-color: var(--warning-color);
            box-shadow: 0 0 5px var(--warning-color);
        }
        
        .firewall {
            background-color: var(--error-color);
            box-shadow: 0 0 5px var(--error-color);
        }
        
        #main-container {
            display: flex;
            flex: 1;
            gap: 10px;
            height: calc(100% - 40px);
        }
        
        #sidebar {
            width: 200px;
            background-color: var(--panel-bg);
            border: 1px solid var(--panel-border);
            padding: 10px;
            overflow-y: auto;
        }
        
        .menu-title {
            color: var(--accent-color);
            border-bottom: 1px solid var(--panel-border);
            padding-bottom: 5px;
            margin-bottom: 10px;
        }
        
        .menu-item {
            padding: 5px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .menu-item:hover {
            background-color: var(--selection-bg);
            color: var(--selection-text);
        }
        
        #content-area {
            flex: 1;
            background-color: var(--panel-bg);
            border: 1px solid var(--panel-border);
            padding: 10px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }
        
        #command-line {
            display: flex;
            margin-top: auto;
            padding-top: 10px;
            border-top: 1px solid var(--panel-border);
        }
        
        #prompt {
            margin-right: 5px;
        }
        
        #command-input {
            flex: 1;
            background-color: transparent;
            border: none;
            color: var(--text-color);
            font-family: 'Courier New', monospace;
            outline: none;
        }
        
        .output-line {
            margin: 2px 0;
            white-space: pre-wrap;
        }
        
        .success {
            color: var(--success-color);
        }
        
        .error {
            color: var(--error-color);
        }
        
        .warning {
            color: var(--warning-color);
        }
        
        .info {
            color: var(--accent-color);
        }
        
        .money {
            color: var(--money-color);
        }
        
        .hack {
            color: var(--hack-color);
        }
        
        .player {
            color: var(--player-color);
        }
        
        .hidden {
            display: none;
        }
        
        #attack-panel {
            margin-top: 10px;
            border: 1px solid var(--panel-border);
            padding: 10px;
        }
        
        .attack-option {
            margin: 5px 0;
            padding: 5px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .attack-option:hover {
            background-color: var(--selection-bg);
            color: var(--selection-text);
        }
        
        #target-info {
            margin-top: 10px;
            border: 1px solid var(--panel-border);
            padding: 10px;
        }
        
        #network-map {
            margin-top: 10px;
            border: 1px solid var(--panel-border);
            padding: 10px;
            height: 200px;
            overflow: auto;
        }
        
        .node {
            margin: 5px;
            padding: 5px;
            border: 1px solid var(--panel-border);
            cursor: pointer;
        }
        
        .node:hover {
            border-color: var(--accent-color);
        }
        
        .node.router { border-left: 3px solid var(--error-color); }
        .node.server { border-left: 3px solid var(--warning-color); }
        .node.workstation { border-left: 3px solid var(--success-color); }
        .node.admin_pc { border-left: 3px solid var(--money-color); }
        .node.player { border-left: 3px solid var(--player-color); }
        .node.corp { border-left: 3px solid var(--corp-network); }
        .node.home { border-left: 3px solid var(--home-network); }
        
        #progress-container {
            margin-top: 10px;
            height: 20px;
            border: 1px solid var(--panel-border);
        }
        
        #progress-bar {
            height: 100%;
            width: 0%;
            background-color: var(--accent-color);
            transition: width 0.3s;
        }
        
        #notifications {
            position: fixed;
            bottom: 10px;
            right: 10px;
            width: 300px;
        }
        
        .notification {
            background-color: var(--panel-bg);
            border: 1px solid var(--panel-border);
            padding: 10px;
            margin-bottom: 5px;
            animation: slideIn 0.3s;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }
        
        .tab-container {
            display: flex;
            border-bottom: 1px solid var(--panel-border);
            margin-bottom: 10px;
        }
        
        .tab {
            padding: 5px 10px;
            cursor: pointer;
            border: 1px solid transparent;
            border-bottom: none;
            margin-right: 5px;
        }
        
        .tab.active {
            border-color: var(--panel-border);
            background-color: var(--panel-bg);
            border-bottom: 1px solid var(--panel-bg);
            margin-bottom: -1px;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .skill-tree {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }
        
        .skill {
            border: 1px solid var(--panel-border);
            padding: 10px;
            text-align: center;
            cursor: pointer;
        }
        
        .skill.locked {
            opacity: 0.5;
        }
        
        .skill.unlocked {
            border-color: var(--success-color);
        }
        
        .skill.learned {
            background-color: var(--selection-bg);
            color: var(--selection-text);
        }
        
        #mission-board {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        
        .mission {
            border: 1px solid var(--panel-border);
            padding: 10px;
        }
        
        .mission-title {
            color: var(--accent-color);
            margin-bottom: 5px;
        }
        
        .mission-reward {
            color: var(--money-color);
        }
        
        #black-market {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        
        .market-item {
            border: 1px solid var(--panel-border);
            padding: 10px;
        }
        
        .item-name {
            color: var(--accent-color);
        }
        
        .item-price {
            color: var(--money-color);
        }
        
        #log-viewer {
            height: 300px;
            overflow-y: auto;
            border: 1px solid var(--panel-border);
            padding: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }
        
        .log-entry {
            margin-bottom: 5px;
            border-bottom: 1px dotted var(--panel-border);
            padding-bottom: 5px;
        }
        
        .log-time {
            color: var(--accent-color);
            font-size: 0.8em;
        }
        
        #minimap {
            width: 100%;
            height: 150px;
            border: 1px solid var(--panel-border);
            position: relative;
            margin-top: 10px;
        }
        
        .minimap-node {
            position: absolute;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: var(--accent-color);
        }
        
        .minimap-node.router { background-color: var(--error-color); }
        .minimap-node.server { background-color: var(--warning-color); }
        .minimap-node.workstation { background-color: var(--success-color); }
        .minimap-node.admin_pc { background-color: var(--money-color); }
        .minimap-node.player { background-color: var(--player-color); }
        .minimap-node.corp { background-color: var(--corp-network); }
        .minimap-node.home { background-color: var(--home-network); }
        .minimap-node.current { border: 2px solid var(--hack-color); }
        
        #multiplayer-panel {
            margin-top: 10px;
            border: 1px solid var(--panel-border);
            padding: 10px;
        }
        
        .player-list {
            margin-top: 10px;
        }
        
        .player-item {
            padding: 5px;
            border-bottom: 1px solid var(--panel-border);
            cursor: pointer;
        }
        
        .player-item:hover {
            background-color: var(--selection-bg);
            color: var(--selection-text);
        }
        
        #hardware-upgrades {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 10px;
        }
        
        .upgrade-item {
            border: 1px solid var(--panel-border);
            padding: 10px;
        }
        
        .upgrade-name {
            color: var(--accent-color);
        }
        
        .upgrade-price {
            color: var(--money-color);
        }
        
        #proxy-list {
            margin-top: 10px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .proxy-item {
            padding: 5px;
            border-bottom: 1px solid var(--panel-border);
        }
        
        .proxy-item.active {
            background-color: var(--selection-bg);
            color: var(--selection-text);
        }

        /* 新增样式 */
        .scan-result {
            margin-top: 10px;
            border: 1px solid var(--panel-border);
            padding: 10px;
        }

        .scan-result-title {
            color: var(--accent-color);
            margin-bottom: 5px;
        }

        .exploit-option {
            margin: 5px 0;
            padding: 5px;
            border: 1px solid var(--panel-border);
            cursor: pointer;
        }

        .exploit-option:hover {
            background-color: var(--selection-bg);
            color: var(--selection-text);
        }

        .tool-item {
            margin: 5px 0;
            padding: 5px;
            border-bottom: 1px solid var(--panel-border);
        }

        .inventory-category {
            margin-top: 15px;
            color: var(--accent-color);
            border-bottom: 1px solid var(--panel-border);
            padding-bottom: 5px;
        }

        .settings-option {
            margin: 10px 0;
        }

        .settings-label {
            display: inline-block;
            width: 200px;
        }

        .help-section {
            margin-bottom: 15px;
        }

        .help-title {
            color: var(--accent-color);
            margin-bottom: 5px;
        }

        .progress-text {
            text-align: center;
            margin-top: 5px;
        }

        /* 新增警告模态框样式 */
        #warning-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        #warning-content {
            background-color: var(--panel-bg);
            border: 2px solid var(--error-color);
            padding: 20px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        #warning-title {
            color: var(--error-color);
            font-size: 1.5em;
            margin-bottom: 15px;
            text-align: center;
        }

        #warning-text {
            margin-bottom: 20px;
            line-height: 1.5;
        }

        #warning-close {
            background-color: var(--error-color);
            color: black;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            display: block;
            margin: 0 auto;
        }

        #warning-close:hover {
            background-color: #ff3333;
        }

        .save-load-btn {
            background-color: var(--panel-bg);
            color: var(--text-color);
            border: 1px solid var(--panel-border);
            padding: 5px 10px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
        }

        .save-load-btn:hover {
            background-color: var(--selection-bg);
            color: var(--selection-text);
        }
        #save-load-container {
            display: flex;
            gap: 5px;
            margin-left: 10px;
        }

        .save-load-btn {
            background-color: var(--panel-bg);
            color: var(--text-color);
            border: 1px solid var(--panel-border);
            border-radius: 4px;
            padding: 5px;
            cursor: pointer;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .save-load-btn:hover {
            background-color: var(--selection-bg);
            color: var(--selection-text);
            border-color: var(--accent-color);
        }

        .save-load-btn svg {
            pointer-events: none;
        }
    </style>
</head>
<body>
    <!-- 新增安全警告模态框 -->
    <div id="warning-modal">
        <div id="warning-content">
            <div id="warning-title">安全警告与免责声明</div>
            <div id="warning-text">
                <p><strong>重要提示：</strong>此应用程序是一个模拟黑客活动的虚构游戏，仅供教育和娱乐目的。</p>
                <p>在现实世界中，未经授权访问计算机系统是非法的，可能导致严重的法律后果。</p>
                <p>本游戏中的所有内容均为虚构，不代表真实的黑客技术或方法。</p>
                <p>开发者不鼓励、不支持或宽恕任何形式的非法黑客活动。</p>
                <p>使用本游戏即表示您同意：</p>
                <ul>
                    <li>不会将此游戏用于任何非法目的</li>
                    <li>不会尝试将游戏中的技术应用于真实系统</li>
                    <li>理解游戏内容纯属虚构</li>
                    <li>自行承担使用本游戏的全部责任</li>
                </ul>
                <p>如果您不同意这些条款，请立即关闭本游戏。</p>
            </div>
            <button id="warning-close">我理解并同意</button>
        </div>
    </div>

    <div id="terminal">
        <div id="header">
            <div id="logo">黑客面板</div>
            <div id="status-bar">
                <div class="status-item">
                    <div class="status-indicator online"></div>
                    <span>在线</span>
                </div>
                <div class="status-item">
                    <div class="status-indicator anonymous"></div>
                    <span>匿名</span>
                </div>
                <div class="status-item">
                    <div class="status-indicator firewall"></div>
                    <span>防火墙: 启用</span>
                </div>
                <div class="status-item money">
                    $<span id="money-display">1000</span>
                </div>
                <div class="status-item">
                    声誉: <span id="rep-display">0</span>
                </div>
                <div class="status-item">
                    等级: <span id="level-display">1</span>
                </div>
                <div id="save-load-container">
                    <button class="save-load-btn" id="save-game" title="保存游戏">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                            <polyline points="17 21 17 13 7 13 7 21"></polyline>
                            <polyline points="7 3 7 8 15 8"></polyline>
                        </svg>
                    </button>
                    <button class="save-load-btn" id="load-game" title="加载游戏">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="7 10 12 15 17 10"></polyline>
                            <line x1="12" y1="15" x2="12" y2="3"></line>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
        
        <div id="main-container">
            <div id="sidebar">
                <div class="menu-title">导航</div>
                <div class="menu-item" data-tab="home">主控制台</div>
                <div class="menu-item" data-tab="scan">网络扫描</div>
                <div class="menu-item" data-tab="exploits">漏洞利用</div>
                <div class="menu-item" data-tab="tools">工具集</div>
                <div class="menu-item" data-tab="missions">任务系统</div>
                <div class="menu-item" data-tab="logs">日志记录</div>
                <div class="menu-item" data-tab="inventory">资源库存</div>
                <div class="menu-item" data-tab="skills">技能树</div>
                <div class="menu-item" data-tab="market">黑市交易</div>
                <div class="menu-item" data-tab="multiplayer">多人游戏</div>
                <div class="menu-item" data-tab="hardware">硬件升级</div>
                <div class="menu-item" data-tab="proxies">代理IP</div>
                
                <div class="menu-title">攻击类型</div>
                <div class="menu-item" data-tab="ddos">DDoS攻击</div>
                <div class="menu-item" data-tab="xss">XSS注入</div>
                <div class="menu-item" data-tab="sql">SQL注入</div>
                <div class="menu-item" data-tab="phishing">钓鱼攻击</div>
                <div class="menu-item" data-tab="bruteforce">暴力破解</div>
                <div class="menu-item" data-tab="mitm">中间人攻击</div>
                <div class="menu-item" data-tab="zero-day">零日漏洞</div>
                <div class="menu-item" data-tab="ransomware">勒索软件</div>
                <div class="menu-item" data-tab="iot">IoT僵尸网络</div>
                <div class="menu-item" data-tab="backdoor">后门植入</div>
                <div class="menu-item" data-tab="cryptojacking">加密货币挖矿</div>
                <div class="menu-item" data-tab="dns-spoofing">DNS欺骗</div>
                <div class="menu-item" data-tab="credential-stuffing">凭证填充</div>
                <div class="menu-item" data-tab="ai-poisoning">AI数据投毒</div>
                
                <div class="menu-title">系统</div>
                <div class="menu-item" data-tab="settings">系统设置</div>
                <div class="menu-item" data-tab="help">帮助文档</div>
            </div>
            
            <div id="content-area">
                <div class="tab-container">
                    <div class="tab active" data-tab="main">主终端</div>
                    <div class="tab" data-tab="network">网络视图</div>
                    <div class="tab" data-tab="analysis">分析面板</div>
                    <div class="tab" data-tab="minimap">网络地图</div>
                </div>
                
                <div class="tab-content active" id="main-tab">
                    <div id="output">
                        <div class="output-line">黑客面板 已启动</div>
                        <div class="output-line">正在初始化虚拟环境...</div>
                        <div class="output-line success">✓ 虚拟环境初始化完成</div>
                        <div class="output-line">正在检查网络连接...</div>
                        <div class="output-line success">✓ 网络连接已建立 (TOR 路由)</div>
                        <div class="output-line">正在加载黑客工具集...</div>
                        <div class="output-line success">✓ 工具集加载完成</div>
                        <div class="output-line info">输入 "help" 获取命令列表</div>
                        <div class="output-line"><br></div>
                    </div>
                    
                    <div id="command-line">
                        <span id="prompt">root@Hack-Panel:</span>
                        <input type="text" id="command-input" autofocus>
                    </div>
                </div>
                
                <div class="tab-content" id="network-tab">
                    <div id="network-map">
                        <div class="node router" data-ip="192.168.1.1">路由器 (192.168.1.1)</div>
                        <div class="node server" data-ip="192.168.1.2">文件服务器 (192.168.1.2)</div>
                        <div class="node server" data-ip="192.168.1.3">数据库服务器 (192.168.1.3)</div>
                        <div class="node server" data-ip="192.168.1.4">Web服务器 (192.168.1.4)</div>
                        <div class="node server" data-ip="192.168.1.5">邮件服务器 (192.168.1.5)</div>
                        <div class="node workstation" data-ip="192.168.1.100">工作站 (192.168.1.100)</div>
                        <div class="node admin_pc" data-ip="192.168.1.101">管理员PC (192.168.1.101)</div>
                    </div>
                    
                    <div id="target-info">
                        <div class="output-line">选择一个目标节点以查看更多信息</div>
                    </div>
                </div>
                
                <div class="tab-content" id="analysis-tab">
                    <div class="output-line">攻击分析面板</div>
                    <div class="output-line">------------------------</div>
                    <div class="output-line">最近活动:</div>
                    <div id="recent-activity">
                        <div class="output-line">- 无记录</div>
                    </div>
                    <div class="output-line"><br></div>
                    <div class="output-line">系统资源:</div>
                    <div class="output-line">- CPU: <span id="cpu-display">12</span>%</div>
                    <div class="output-line">- 内存: <span id="memory-display">34</span>%</div>
                    <div class="output-line">- 网络: <span id="network-display">2</span>%</div>
                    <div class="output-line">- 匿名度: <span id="anon-display">100</span>%</div>
                    <div class="output-line">- 代理IP: <span id="proxy-display">无</span></div>
                </div>
                
                <div class="tab-content" id="minimap-tab">
                    <div id="minimap"></div>
                    <div class="output-line">网络拓扑图</div>
                    <div class="output-line">- <span style="color: var(--error-color)">■</span> 路由器</div>
                    <div class="output-line">- <span style="color: var(--warning-color)">■</span> 服务器</div>
                    <div class="output-line">- <span style="color: var(--success-color)">■</span> 工作站</div>
                    <div class="output-line">- <span style="color: var(--money-color)">■</span> 管理员PC</div>
                    <div class="output-line">- <span style="color: var(--player-color)">■</span> 其他玩家</div>
                    <div class="output-line">- <span style="color: var(--corp-network)">■</span> 企业网络</div>
                    <div class="output-line">- <span style="color: var(--home-network)">■</span> 家庭网络</div>
                    <div class="output-line">- <span style="color: var(--hack-color)">■</span> 当前目标</div>
                </div>
            </div>
        </div>
    </div>
    
    <div id="notifications"></div>
    
    <script>
        // 游戏状态
        const gameState = {
            currentTab: 'main',
            currentIp: '192.168.1.100',
            targetIp: null,
            activeProxy: null,
            playerLevel: 1,
            playerExp: 0,
            resources: {
                cpu: 100,
                memory: 100,
                network: 100,
                money: 1000,
                reputation: 0,
                anonymity: 100,
                skills: {
                    hacking: 1,
                    networking: 1,
                    programming: 1,
                    social: 1,
                    stealth: 1
                }
            },
            inventory: {
                exploits: ['basic_ddos', 'simple_xss'],
                tools: ['nmap', 'metasploit', 'wireshark'],
                zeroDays: [],
                botnets: [],
                proxies: []
            },
            networkNodes: [
                // 本地网络
                { ip: '192.168.1.1', type: 'router', security: 70, services: ['firewall', 'vpn'], os: 'RouterOS 6.0', network: 'local' },
                { ip: '192.168.1.2', type: 'file_server', security: 50, services: ['ftp', 'smb'], os: 'Windows Server 2016', network: 'local' },
                { ip: '192.168.1.3', type: 'db_server', security: 80, services: ['mysql', 'postgresql'], os: 'Ubuntu Server 20.04', network: 'local' },
                { ip: '192.168.1.4', type: 'web_server', security: 40, services: ['http', 'https', 'ssh'], os: 'CentOS 7', network: 'local' },
                { ip: '192.168.1.5', type: 'mail_server', security: 60, services: ['smtp', 'imap', 'pop3'], os: 'Debian 10', network: 'local' },
                { ip: '192.168.1.100', type: 'workstation', security: 30, services: ['rdp', 'smb'], os: 'Windows 10 Pro', network: 'local' },
                { ip: '192.168.1.101', type: 'admin_pc', security: 45, services: ['rdp', 'smb', 'ssh'], os: 'Windows 10 Enterprise', network: 'local' },
                
                // 企业网络
                { ip: '10.0.0.1', type: 'router', security: 85, services: ['firewall', 'ids', 'ips'], os: 'Cisco IOS', network: 'corporate' },
                { ip: '10.0.0.2', type: 'file_server', security: 75, services: ['ftp', 'smb', 'nfs'], os: 'Windows Server 2019', network: 'corporate' },
                { ip: '10.0.0.3', type: 'db_server', security: 90, services: ['oracle', 'sqlserver'], os: 'Red Hat Enterprise Linux', network: 'corporate' },
                { ip: '10.0.0.4', type: 'web_server', security: 65, services: ['http', 'https', 'ssh'], os: 'Ubuntu Server 20.04', network: 'corporate' },
                { ip: '10.0.0.5', type: 'mail_server', security: 80, services: ['smtp', 'imap', 'pop3'], os: 'Debian 10', network: 'corporate' },
                { ip: '10.0.0.100', type: 'workstation', security: 50, services: ['rdp', 'smb'], os: 'Windows 10 Enterprise', network: 'corporate' },
                { ip: '10.0.0.101', type: 'admin_pc', security: 60, services: ['rdp', 'smb', 'ssh'], os: 'Windows 10 Enterprise', network: 'corporate' },
                
                // 家庭网络
                { ip: '192.168.0.1', type: 'router', security: 40, services: ['firewall'], os: 'TP-Link Archer', network: 'home' },
                { ip: '192.168.0.2', type: 'workstation', security: 20, services: ['rdp', 'smb'], os: 'Windows 10 Home', network: 'home' },
                { ip: '192.168.0.3', type: 'workstation', security: 25, services: ['rdp', 'smb'], os: 'macOS Catalina', network: 'home' },
                { ip: '192.168.0.4', type: 'iot_device', security: 15, services: ['http'], os: 'Custom IoT OS', network: 'home' },
                
                // 其他玩家
                { ip: '172.16.0.1', type: 'player', security: 60, services: ['ssh', 'rdp'], os: 'Kali Linux', network: 'player' },
                { ip: '172.16.0.2', type: 'player', security: 70, services: ['ssh', 'rdp'], os: 'Parrot OS', network: 'player' }
            ],
            logs: [],
            missions: [
                {
                    id: 1,
                    title: "窃取公司文件",
                    description: "从文件服务器(192.168.1.2)窃取机密文档",
                    target: "192.168.1.2",
                    reward: 500,
                    exp: 100,
                    requiredSkill: "hacking",
                    requiredLevel: 2,
                    completed: false
                },
                {
                    id: 2,
                    title: "破坏网站",
                    description: "对Web服务器(192.168.1.4)发起DDoS攻击",
                    target: "192.168.1.4",
                    reward: 300,
                    exp: 50,
                    requiredSkill: "networking",
                    requiredLevel: 1,
                    completed: false
                },
                {
                    id: 3,
                    title: "获取数据库访问权限",
                    description: "入侵数据库服务器(192.168.1.3)并获取root权限",
                    target: "192.168.1.3",
                    reward: 800,
                    exp: 150,
                    requiredSkill: "hacking",
                    requiredLevel: 3,
                    completed: false
                },
                {
                    id: 4,
                    title: "企业网络渗透",
                    description: "入侵企业网络(10.0.0.0/24)并获取至少2台服务器的控制权",
                    target: "10.0.0.0/24",
                    reward: 1500,
                    exp: 250,
                    requiredSkill: "hacking",
                    requiredLevel: 4,
                    completed: false
                },
                {
                    id: 5,
                    title: "僵尸网络创建",
                    description: "创建至少包含20个节点的僵尸网络",
                    target: "",
                    reward: 1200,
                    exp: 200,
                    requiredSkill: "networking",
                    requiredLevel: 3,
                    completed: false
                }
            ],
            blackMarket: [
                { id: 1, name: "高级漏洞包", type: "exploit", price: 750, effect: "获得3个随机漏洞" },
                { id: 2, name: "零日漏洞", type: "zero-day", price: 2000, effect: "获得1个零日漏洞" },
                { id: 3, name: "僵尸网络节点", type: "botnet", price: 500, effect: "增加10个僵尸节点" },
                { id: 4, name: "匿名VPN", type: "tool", price: 300, effect: "匿名度+20%" },
                { id: 5, name: "CPU升级", type: "upgrade", price: 600, effect: "CPU容量+20%" },
                { id: 6, name: "黑客技能手册", type: "skill", price: 400, effect: "黑客技能+1" },
                { id: 7, name: "代理IP包", type: "proxy", price: 250, effect: "获得5个代理IP" },
                { id: 8, name: "高级扫描工具", type: "tool", price: 800, effect: "解锁高级扫描功能" },
                { id: 9, name: "AI辅助工具", type: "tool", price: 1500, effect: "提高所有攻击成功率" },
                { id: 10, name: "量子计算模块", type: "upgrade", price: 5000, effect: "大幅提高计算能力" }
            ],
            hardwareUpgrades: [
                { id: 1, name: "CPU升级", type: "cpu", price: 1000, effect: "CPU容量+50%", level: 2 },
                { id: 2, name: "内存升级", type: "memory", price: 800, effect: "内存容量+50%", level: 2 },
                { id: 3, name: "网络升级", type: "network", price: 600, effect: "网络带宽+50%", level: 2 },
                { id: 4, name: "量子CPU", type: "cpu", price: 5000, effect: "CPU容量+200%", level: 5 },
                { id: 5, name: "超级内存", type: "memory", price: 4000, effect: "内存容量+200%", level: 5 },
                { id: 6, name: "光纤网络", type: "network", price: 3000, effect: "网络带宽+200%", level: 5 },
                { id: 7, name: "AI协处理器", type: "cpu", price: 8000, effect: "CPU容量+300%", level: 8 },
                { id: 8, name: "神经内存", type: "memory", price: 7000, effect: "内存容量+300%", level: 8 },
                { id: 9, name: "量子网络", type: "network", price: 6000, effect: "网络带宽+300%", level: 8 }
            ],
            skillTree: [
                { id: 1, name: "基础破解", description: "解锁基本攻击方法", cost: 0, requires: [], type: "hacking", level: 1, learned: true },
                { id: 2, name: "网络扫描", description: "提高扫描精度和速度", cost: 200, requires: [1], type: "networking", level: 1, learned: false },
                { id: 3, name: "社会工程", description: "提高钓鱼攻击成功率", cost: 300, requires: [1], type: "social", level: 1, learned: false },
                { id: 4, name: "高级漏洞利用", description: "解锁更复杂的攻击方法", cost: 500, requires: [1], type: "hacking", level: 2, learned: false },
                { id: 5, name: "僵尸网络控制", description: "可以创建和控制僵尸网络", cost: 800, requires: [2,4], type: "networking", level: 2, learned: false },
                { id: 6, name: "零日漏洞开发", description: "可以开发和利用零日漏洞", cost: 1200, requires: [4], type: "programming", level: 3, learned: false },
                { id: 7, name: "隐身技术", description: "降低执法机构关注度", cost: 600, requires: [3], type: "stealth", level: 2, learned: false },
                { id: 8, name: "企业渗透", description: "提高对企业网络的攻击成功率", cost: 1500, requires: [4,5], type: "hacking", level: 4, learned: false },
                { id: 9, name: "AI辅助攻击", description: "使用AI提高攻击效率", cost: 2000, requires: [6], type: "programming", level: 5, learned: false },
                { id: 10, name: "量子破解", description: "使用量子计算加速破解", cost: 5000, requires: [9], type: "hacking", level: 6, learned: false }
            ],
            lawEnforcement: {
                awareness: 0,
                investigationProgress: 0,
                lastActionTime: null
            },
            discoveredNodes: ['192.168.1.100'],
            hackedNodes: [],
            players: [
                { id: 1, name: "GhostHacker", ip: "172.16.0.1", level: 3, reputation: 150, online: true },
                { id: 2, name: "DarkPhantom", ip: "172.16.0.2", level: 5, reputation: 400, online: true }
            ],
            miningInterval: null,
            settings: {
                sound: true,
                animations: true,
                theme: 'dark',
                notifications: true
            }
        };
        
        // DOM元素
        const outputEl = document.getElementById('output');
        const commandInputEl = document.getElementById('command-input');
        const targetInfoEl = document.getElementById('target-info');
        const networkMapEl = document.getElementById('network-map');
        const notificationsEl = document.getElementById('notifications');
        const recentActivityEl = document.getElementById('recent-activity');
        const minimapEl = document.getElementById('minimap');
        const warningModal = document.getElementById('warning-modal');
        const warningCloseBtn = document.getElementById('warning-close');
        const saveGameBtn = document.getElementById('save-game');
        const loadGameBtn = document.getElementById('load-game');
        
        // 命令处理
        const commands = {
            help: () => {
                addOutput('可用命令:', 'info');
                addOutput('----------------------------', 'info');
                addOutput('help - 显示帮助信息', 'info');
                addOutput('scan [ip] - 扫描目标IP', 'info');
                addOutput('exploit [type] [ip] - 对目标IP发起攻击', 'info');
                addOutput('connect [ip] - 连接到目标系统', 'info');
                addOutput('disconnect - 断开当前连接', 'info');
                addOutput('clear - 清除终端输出', 'info');
                addOutput('status - 显示系统状态', 'info');
                addOutput('inventory - 显示可用工具和漏洞', 'info');
                addOutput('buy [item] - 购买工具或漏洞', 'info');
                addOutput('upgrade [resource] - 升级系统资源', 'info');
                addOutput('missions - 显示可用任务', 'info');
                addOutput('skills - 显示技能树', 'info');
                addOutput('market - 访问黑市', 'info');
                addOutput('logs - 查看活动日志', 'info');
                addOutput('use proxy [id] - 使用代理IP', 'info');
                addOutput('attack player [ip] - 攻击其他玩家', 'info');
                addOutput('botnet [command] - 控制僵尸网络', 'info');
                addOutput('settings - 查看或修改设置', 'info');
                addOutput('save - 保存游戏进度', 'info');
                addOutput('load - 加载游戏进度', 'info');
            },
            
            scan: (ip) => {
                if (!ip) {
                    addOutput('错误: 需要指定目标IP或使用"scan network"扫描整个网络', 'error');
                    addOutput('提示: 使用 "scan network" 扫描整个网络或 "scan [ip]" 扫描特定目标', 'info');
                    return;
                }
                
                if (ip === 'network') {
                    addOutput('开始扫描整个网络...这可能需要一些时间', 'info');
                    
                    // 模拟网络扫描过程
                    setTimeout(() => {
                        const newNodes = gameState.networkNodes
                            .filter(n => !gameState.discoveredNodes.includes(n.ip))
                            .map(n => n.ip);
                        
                        if (newNodes.length > 0) {
                            gameState.discoveredNodes.push(...newNodes);
                            addOutput(`发现新节点: ${newNodes.join(', ')}`, 'success');
                            updateNetworkMap();
                        } else {
                            addOutput('没有发现新的网络节点', 'warning');
                        }
                        
                        // 记录日志
                        logAction(`扫描整个网络`);
                    }, 3000);
                    return;
                }
                
                const node = gameState.networkNodes.find(n => n.ip === ip);
                if (!node) {
                    addOutput(`错误: 无法找到IP ${ip}`, 'error');
                    addOutput('提示: 使用 "scan network" 发现更多节点', 'info');
                    return;
                }
                
                addOutput(`开始扫描 ${ip}...`, 'info');
                
                // 模拟扫描过程
                setTimeout(() => {
                    addOutput(`扫描结果 - ${ip}:`, 'success');
                    addOutput(`类型: ${node.type}`);
                    addOutput(`操作系统: ${node.os}`);
                    addOutput(`安全等级: ${node.security}/100`);
                    addOutput(`运行服务: ${node.services.join(', ')}`);
                    addOutput(`网络类型: ${node.network}`);
                    gameState.targetIp = ip;
                    
                    // 添加到已发现节点
                    if (!gameState.discoveredNodes.includes(ip)) {
                        gameState.discoveredNodes.push(ip);
                        updateNetworkMap();
                    }
                    
                    // 记录日志
                    logAction(`扫描 ${ip}`);
                }, 1500);
            },
            
            exploit: (type, ip) => {
                if (!type || !ip) {
                    addOutput('错误: 需要指定攻击类型和目标IP', 'error');
                    addOutput('提示: 使用 "exploit [type] [ip]" 例如 "exploit ddos 192.168.1.1"', 'info');
                    return;
                }
                
                // 检查是否拥有该攻击方法
                const hasExploit = gameState.inventory.exploits.includes(type) || 
                                  gameState.inventory.tools.includes(type) || 
                                  gameState.inventory.zeroDays.includes(type);
                
                if (!hasExploit) {
                    addOutput(`错误: 未找到 ${type} 攻击方法`, 'error');
                    addOutput('提示: 使用 "inventory" 查看可用工具或 "market" 购买新工具', 'info');
                    return;
                }
                
                const node = gameState.networkNodes.find(n => n.ip === ip);
                if (!node) {
                    addOutput(`错误: 无法找到IP ${ip}`, 'error');
                    addOutput('提示: 使用 "scan network" 发现更多节点', 'info');
                    return;
                }
                
                // 检查技能要求
                let skillType, requiredLevel;
                switch(type) {
                    case 'ddos':
                    case 'mitm':
                    case 'iot':
                        skillType = 'networking';
                        requiredLevel = 1;
                        break;
                    case 'xss':
                    case 'sql':
                    case 'backdoor':
                        skillType = 'hacking';
                        requiredLevel = 2;
                        break;
                    case 'zero-day':
                    case 'ai-poisoning':
                        skillType = 'programming';
                        requiredLevel = 3;
                        break;
                    case 'phishing':
                    case 'credential-stuffing':
                        skillType = 'social';
                        requiredLevel = 1;
                        break;
                    case 'ransomware':
                    case 'dns-spoofing':
                        skillType = 'hacking';
                        requiredLevel = 3;
                        break;
                    default:
                        skillType = 'hacking';
                        requiredLevel = 1;
                }
                
                if (gameState.resources.skills[skillType] < requiredLevel) {
                    addOutput(`错误: 需要${skillType}技能等级${requiredLevel}`, 'error');
                    addOutput(`提示: 使用 "skills" 查看技能树或 "learn [id]" 学习新技能`, 'info');
                    return;
                }
                
                addOutput(`准备 ${type} 攻击 ${ip}...`, 'warning');
                
                // 模拟攻击过程
                const attackTime = Math.max(1000, 5000 - (gameState.resources.cpu * 30));
                let successChance = 50 + 
                    (gameState.resources.cpu / 2) - 
                    (node.security / 2) + 
                    (gameState.resources.skills[skillType] * 10);
                
                // 使用代理提高成功率
                if (gameState.activeProxy) {
                    successChance += 15;
                }
                
                // 使用零日漏洞大幅提高成功率
                if (type === 'zero-day' || gameState.inventory.zeroDays.includes(type)) {
                    successChance += 30;
                }
                
                setTimeout(() => {
                    const isSuccess = Math.random() * 100 < successChance;
                    
                    if (isSuccess) {
                        addOutput(`攻击成功! ${type} 攻击已破坏 ${ip}`, 'success');
                        gameState.resources.reputation += 10;
                        
                        // 使用代理减少匿名度下降
                        if (gameState.activeProxy) {
                            gameState.resources.anonymity -= 2;
                        } else {
                            gameState.resources.anonymity -= 5;
                        }
                        
                        // 添加到已入侵节点
                        if (!gameState.hackedNodes.includes(ip)) {
                            gameState.hackedNodes.push(ip);
                        }
                        
                        // 随机获取资源
                        if (Math.random() > 0.7) {
                            const newExploit = `exploit_${Math.floor(Math.random() * 1000)}`;
                            gameState.inventory.exploits.push(newExploit);
                            addOutput(`发现新漏洞: ${newExploit}`, 'success');
                        }
                        
                        // 特殊攻击效果
                        if (type === 'ransomware') {
                            const ransomAmount = Math.floor(Math.random() * 500) + 500;
                            gameState.resources.money += ransomAmount;
                            addOutput(`勒索软件成功! 获得 $${ransomAmount}`, 'money');
                        } else if (type === 'cryptojacking') {
                            const miningRate = Math.floor(Math.random() * 10) + 5;
                            startMining(miningRate);
                        } else if (type === 'backdoor') {
                            addOutput(`后门已植入 ${ip}, 现在可以随时连接`, 'success');
                        }
                        
                        // 检查任务完成
                        checkMissions(ip, type);
                        
                        showNotification('攻击成功', `成功攻破 ${ip}`, 'success');
                    } else {
                        addOutput(`攻击失败! ${ip} 检测到入侵`, 'error');
                        gameState.resources.reputation -= 5;
                        gameState.resources.anonymity -= 15;
                        gameState.lawEnforcement.awareness += 10;
                        
                        showNotification('攻击失败', `${ip} 检测到入侵`, 'error');
                    }
                    
                    // 记录日志
                    logAction(`${isSuccess ? '成功' : '失败'}的 ${type} 攻击 ${ip}`);
                    
                    updateStatus();
                    updateNetworkMap();
                }, attackTime);
            },
            
            connect: (ip) => {
                if (!ip) {
                    addOutput('错误: 需要指定目标IP', 'error');
                    addOutput('提示: 使用 "connect [ip]" 例如 "connect 192.168.1.1"', 'info');
                    return;
                }
                
                if (!gameState.hackedNodes.includes(ip)) {
                    addOutput(`错误: 必须先攻破 ${ip} 才能连接`, 'error');
                    addOutput('提示: 使用 "exploit [type] [ip]" 先攻破目标系统', 'info');
                    return;
                }
                
                const node = gameState.networkNodes.find(n => n.ip === ip);
                if (!node) {
                    addOutput(`错误: 无法找到IP ${ip}`, 'error');
                    return;
                }
                
                gameState.currentIp = ip;
                addOutput(`已连接到 ${ip} (${node.type})`, 'success');
                updatePrompt();
                
                // 记录日志
                logAction(`连接到 ${ip}`);
            },
            
            disconnect: () => {
                if (gameState.currentIp === '192.168.1.100') {
                    addOutput('错误: 已经断开连接', 'error');
                    return;
                }
                
                addOutput(`已从 ${gameState.currentIp} 断开连接`, 'success');
                gameState.currentIp = '192.168.1.100';
                updatePrompt();
                
                // 记录日志
                logAction(`断开连接`);
            },
            
            clear: () => {
                outputEl.innerHTML = '';
            },
            
            status: () => {
                addOutput('系统状态:', 'info');
                addOutput('----------------------------', 'info');
                addOutput(`CPU: ${gameState.resources.cpu}%`, 'info');
                addOutput(`内存: ${gameState.resources.memory}%`, 'info');
                addOutput(`网络: ${gameState.resources.network}%`, 'info');
                addOutput(`资金: $${gameState.resources.money}`, 'money');
                addOutput(`声誉: ${gameState.resources.reputation}`, 'info');
                addOutput(`匿名度: ${gameState.resources.anonymity}%`, 'info');
                addOutput(`等级: ${gameState.playerLevel} (经验: ${gameState.playerExp}/${getExpForNextLevel()})`, 'info');
                addOutput('技能:', 'info');
                addOutput(`- 黑客: ${gameState.resources.skills.hacking}`, 'info');
                addOutput(`- 网络: ${gameState.resources.skills.networking}`, 'info');
                addOutput(`- 编程: ${gameState.resources.skills.programming}`, 'info');
                addOutput(`- 社会工程: ${gameState.resources.skills.social}`, 'info');
                addOutput(`- 隐身技术: ${gameState.resources.skills.stealth}`, 'info');
                addOutput(`当前代理: ${gameState.activeProxy || '无'}`, 'info');
                addOutput(`执法关注度: ${gameState.lawEnforcement.awareness}%`, 
                    gameState.lawEnforcement.awareness > 70 ? 'error' : 
                    gameState.lawEnforcement.awareness > 30 ? 'warning' : 'info');
            },
            
            inventory: () => {
                addOutput('资源库存:', 'info');
                addOutput('----------------------------', 'info');
                addOutput('漏洞利用:', 'info');
                gameState.inventory.exploits.forEach(exp => {
                    addOutput(`- ${exp}`);
                });
                addOutput('工具:', 'info');
                gameState.inventory.tools.forEach(tool => {
                    addOutput(`- ${tool}`);
                });
                addOutput('零日漏洞:', 'info');
                gameState.inventory.zeroDays.forEach(zd => {
                    addOutput(`- ${zd}`);
                });
                addOutput('僵尸网络:', 'info');
                if (gameState.inventory.botnets.length > 0) {
                    gameState.inventory.botnets.forEach(bot => {
                        addOutput(`- ${bot.name} (${bot.nodes} 节点)`);
                    });
                } else {
                    addOutput('- 无', 'info');
                }
                addOutput('代理IP:', 'info');
                if (gameState.inventory.proxies.length > 0) {
                    gameState.inventory.proxies.forEach((proxy, index) => {
                        addOutput(`- [${index}] ${proxy.ip} (${proxy.country}) ${proxy === gameState.activeProxy ? '(使用中)' : ''}`);
                    });
                } else {
                    addOutput('- 无', 'info');
                }
            },
            
            buy: (item) => {
                if (!item) {
                    addOutput('错误: 需要指定购买项目', 'error');
                    addOutput('提示: 使用 "market" 查看可购买项目', 'info');
                    return;
                }
                
                const itemData = gameState.blackMarket.find(i => i.name === item || i.id == item);
                
                if (!itemData) {
                    addOutput(`错误: 无法购买 ${item}`, 'error');
                    addOutput('提示: 使用 "market" 查看可购买项目', 'info');
                    return;
                }
                
                if (gameState.resources.money < itemData.price) {
                    addOutput(`错误: 资金不足 (需要 $${itemData.price})`, 'error');
                    addOutput('提示: 完成任务或攻击系统获取更多资金', 'info');
                    return;
                }
                
                gameState.resources.money -= itemData.price;
                
                switch(itemData.type) {
                    case 'exploit':
                        const exploits = [
                            `exploit_${Math.floor(Math.random() * 1000)}`,
                            `exploit_${Math.floor(Math.random() * 1000)}`,
                            `exploit_${Math.floor(Math.random() * 1000)}`
                        ];
                        gameState.inventory.exploits.push(...exploits);
                        addOutput(`购买成功! 获得漏洞包: ${exploits.join(', ')}`, 'success');
                        break;
                    case 'zero-day':
                        const zeroDay = `zero_day_${Math.floor(Math.random() * 1000)}`;
                        gameState.inventory.zeroDays.push(zeroDay);
                        addOutput(`购买成功! 获得零日漏洞: ${zeroDay}`, 'success');
                        break;
                    case 'botnet':
                        const botnetName = `botnet_${Math.floor(Math.random() * 1000)}`;
                        gameState.inventory.botnets.push({
                            name: botnetName,
                            nodes: 10
                        });
                        addOutput(`购买成功! 获得僵尸网络: ${botnetName} (10节点)`, 'success');
                        break;
                    case 'tool':
                        if (itemData.name.includes('VPN')) {
                            gameState.resources.anonymity += 20;
                            addOutput(`购买成功! 匿名度增加20%`, 'success');
                        } else {
                            const toolName = itemData.name.toLowerCase().replace(' ', '_');
                            gameState.inventory.tools.push(toolName);
                            addOutput(`购买成功! 获得工具: ${toolName}`, 'success');
                        }
                        break;
                    case 'upgrade':
                        if (itemData.name.includes('CPU')) {
                            gameState.resources.cpu += 20;
                            addOutput(`购买成功! CPU容量增加20%`, 'success');
                        }
                        break;
                    case 'skill':
                        if (itemData.name.includes('黑客')) {
                            gameState.resources.skills.hacking += 1;
                            addOutput(`购买成功! 黑客技能+1`, 'success');
                        }
                        break;
                    case 'proxy':
                        const countries = ['美国', '俄罗斯', '中国', '德国', '巴西', '日本', '新加坡'];
                        const newProxies = [];
                        for (let i = 0; i < 5; i++) {
                            const country = countries[Math.floor(Math.random() * countries.length)];
                            const proxy = {
                                ip: `${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}`,
                                country: country
                            };
                            newProxies.push(proxy);
                        }
                        gameState.inventory.proxies.push(...newProxies);
                        addOutput(`购买成功! 获得代理IP:`, 'success');
                        newProxies.forEach(proxy => {
                            addOutput(`- ${proxy.ip} (${proxy.country})`);
                        });
                        break;
                }
                
                updateStatus();
                logAction(`购买了 ${itemData.name}`);
            },
            
            upgrade: (resource) => {
                if (!resource) {
                    addOutput('错误: 需要指定升级资源 (cpu/memory/network)', 'error');
                    addOutput('提示: 使用 "upgrade cpu"、"upgrade memory" 或 "upgrade network"', 'info');
                    return;
                }
                
                if (!['cpu', 'memory', 'network'].includes(resource)) {
                    addOutput(`错误: 无法升级 ${resource}`, 'error');
                    return;
                }
                
                const upgradeCost = 300 + (gameState.resources[resource] * 2);
                
                if (gameState.resources.money < upgradeCost) {
                    addOutput(`错误: 资金不足 (需要 $${upgradeCost})`, 'error');
                    return;
                }
                
                if (gameState.resources[resource] >= 200) {
                    addOutput(`错误: ${resource} 已达到最大等级`, 'error');
                    return;
                }
                
                gameState.resources.money -= upgradeCost;
                gameState.resources[resource] += 10;
                addOutput(`升级成功! ${resource} 现在为 ${gameState.resources[resource]}%`, 'success');
                
                updateStatus();
                logAction(`升级了 ${resource}`);
            },
            
            missions: () => {
                addOutput('可用任务:', 'info');
                addOutput('----------------------------', 'info');
                gameState.missions.forEach(mission => {
                    if (!mission.completed) {
                        addOutput(`[${mission.id}] ${mission.title}`, 'info');
                        addOutput(`目标: ${mission.target}`, 'info');
                        addOutput(`描述: ${mission.description}`, 'info');
                        addOutput(`奖励: $${mission.reward}`, 'money');
                        addOutput(`经验: ${mission.exp}`, 'info');
                        addOutput(`要求: ${mission.requiredSkill} 技能等级 ${mission.requiredLevel}`, 'info');
                        addOutput('', 'info');
                    }
                });
            },
            
            skills: () => {
                addOutput('技能树:', 'info');
                addOutput('----------------------------', 'info');
                gameState.skillTree.forEach(skill => {
                    const status = skill.learned ? '已学习' : 
                                  (skill.cost <= gameState.resources.money && 
                                   skill.requires.every(req => gameState.skillTree.find(s => s.id === req).learned)) ? 
                                  '可学习' : '锁定';
                    
                    addOutput(`[${skill.id}] ${skill.name} (${status})`, 'info');
                    addOutput(`描述: ${skill.description}`, 'info');
                    if (!skill.learned) {
                        addOutput(`成本: $${skill.cost}`, 'money');
                        addOutput(`要求等级: ${skill.level}`, 'info');
                    }
                    addOutput('', 'info');
                });
            },
            
            learn: (skillId) => {
                const skill = gameState.skillTree.find(s => s.id == skillId);
                
                if (!skill) {
                    addOutput(`错误: 找不到技能ID ${skillId}`, 'error');
                    addOutput('提示: 使用 "skills" 查看可用技能', 'info');
                    return;
                }
                
                if (skill.learned) {
                    addOutput(`错误: 已经学习了 ${skill.name}`, 'error');
                    return;
                }
                
                // 检查前置条件
                const unmetRequires = skill.requires.filter(req => 
                    !gameState.skillTree.find(s => s.id === req).learned);
                
                if (unmetRequires.length > 0) {
                    addOutput(`错误: 需要先学习前置技能: ${unmetRequires.join(', ')}`, 'error');
                    addOutput('提示: 查看技能树了解学习路径', 'info');
                    return;
                }
                
                // 检查等级要求
                if (gameState.playerLevel < skill.level) {
                    addOutput(`错误: 需要等级 ${skill.level} 才能学习此技能`, 'error');
                    addOutput('提示: 完成任务或攻击系统获取经验升级', 'info');
                    return;
                }
                
                if (gameState.resources.money < skill.cost) {
                    addOutput(`错误: 资金不足 (需要 $${skill.cost})`, 'error');
                    addOutput('提示: 完成任务或攻击系统获取更多资金', 'info');
                    return;
                }
                
                gameState.resources.money -= skill.cost;
                skill.learned = true;
                
                // 应用技能效果
                switch(skill.type) {
                    case 'hacking':
                        gameState.resources.skills.hacking = Math.max(
                            gameState.resources.skills.hacking, 
                            skill.level
                        );
                        break;
                    case 'networking':
                        gameState.resources.skills.networking = Math.max(
                            gameState.resources.skills.networking, 
                            skill.level
                        );
                        break;
                    case 'programming':
                        gameState.resources.skills.programming = Math.max(
                            gameState.resources.skills.programming, 
                            skill.level
                        );
                        break;
                    case 'social':
                        gameState.resources.skills.social = Math.max(
                            gameState.resources.skills.social, 
                            skill.level
                        );
                        break;
                    case 'stealth':
                        gameState.resources.skills.stealth = Math.max(
                            gameState.resources.skills.stealth, 
                            skill.level
                        );
                        break;
                }
                
                addOutput(`成功学习 ${skill.name}!`, 'success');
                updateStatus();
                logAction(`学习了技能 ${skill.name}`);
            },
            
            market: () => {
                addOutput('黑市商品:', 'info');
                addOutput('----------------------------', 'info');
                gameState.blackMarket.forEach(item => {
                    addOutput(`[${item.id}] ${item.name}`, 'info');
                    addOutput(`类型: ${item.type}`, 'info');
                    addOutput(`效果: ${item.effect}`, 'info');
                    addOutput(`价格: $${item.price}`, 'money');
                    addOutput('', 'info');
                });
            },
            
            logs: () => {
                addOutput('活动日志:', 'info');
                addOutput('----------------------------', 'info');
                if (gameState.logs.length === 0) {
                    addOutput('无日志记录', 'info');
                    return;
                }
                
                gameState.logs.slice().reverse().forEach(log => {
                    addOutput(`[${log.time}] ${log.action}`, 'info');
                });
            },
            
            use: (type, ...args) => {
                if (!type) {
                    addOutput('错误: 需要指定使用类型 (proxy/botnet)', 'error');
                    addOutput('提示: 使用 "use proxy [id]" 或 "use botnet [command]"', 'info');
                    return;
                }
                
                if (type === 'proxy') {
                    const proxyId = args[0];
                    if (!proxyId) {
                        // 显示当前代理
                        if (gameState.activeProxy) {
                            addOutput(`当前使用代理: ${gameState.activeProxy.ip} (${gameState.activeProxy.country})`, 'info');
                        } else {
                            addOutput('当前没有使用代理', 'info');
                        }
                        return;
                    }
                    
                    if (proxyId === 'off') {
                        if (gameState.activeProxy) {
                            addOutput(`已停用代理 ${gameState.activeProxy.ip}`, 'success');
                            gameState.activeProxy = null;
                        } else {
                            addOutput('当前没有使用代理', 'info');
                        }
                        return;
                    }
                    
                    const id = parseInt(proxyId);
                    if (isNaN(id) || id < 0 || id >= gameState.inventory.proxies.length) {
                        addOutput('错误: 无效的代理ID', 'error');
                        addOutput('提示: 使用 "proxies" 查看可用代理IP', 'info');
                        return;
                    }
                    
                    gameState.activeProxy = gameState.inventory.proxies[id];
                    addOutput(`已启用代理: ${gameState.activeProxy.ip} (${gameState.activeProxy.country})`, 'success');
                    updateStatus();
                    logAction(`启用了代理 ${gameState.activeProxy.ip}`);
                } else if (type === 'botnet') {
                    const command = args[0];
                    if (!command) {
                        addOutput('错误: 需要指定botnet命令 (launch/stop/status)', 'error');
                        return;
                    }
                    
                    if (gameState.inventory.botnets.length === 0) {
                        addOutput('错误: 你没有僵尸网络', 'error');
                        addOutput('提示: 可以在黑市购买僵尸网络', 'info');
                        return;
                    }
                    
                    const botnet = gameState.inventory.botnets[0]; // 简化处理，只使用第一个僵尸网络
                    
                    if (command === 'launch') {
                        const attackType = args[1];
                        const targetIp = args[2];
                        
                        if (!attackType || !targetIp) {
                            addOutput('错误: 需要指定攻击类型和目标IP', 'error');
                            addOutput('提示: 使用 "use botnet launch [type] [ip]"', 'info');
                            return;
                        }
                        
                        addOutput(`正在使用僵尸网络 ${botnet.name} (${botnet.nodes}节点) 发起 ${attackType} 攻击 ${targetIp}...`, 'warning');
                        
                        setTimeout(() => {
                            // 僵尸网络攻击成功率更高
                            const successChance = 70 + (gameState.resources.skills.networking * 5);
                            const isSuccess = Math.random() * 100 < successChance;
                            
                            if (isSuccess) {
                                addOutput(`僵尸网络攻击成功! ${targetIp} 已被攻破`, 'success');
                                if (!gameState.hackedNodes.includes(targetIp)) {
                                    gameState.hackedNodes.push(targetIp);
                                }
                                gameState.resources.reputation += 15;
                                
                                // 检查任务完成
                                checkMissions(targetIp, attackType);
                            } else {
                                addOutput(`僵尸网络攻击失败! ${targetIp} 检测到攻击`, 'error');
                                gameState.resources.reputation -= 10;
                                gameState.lawEnforcement.awareness += 20;
                            }
                            
                            updateNetworkMap();
                            updateStatus();
                            logAction(`使用僵尸网络 ${isSuccess ? '成功' : '失败'}攻击 ${targetIp}`);
                        }, 2000);
                    } else if (command === 'stop') {
                        addOutput(`已停止僵尸网络 ${botnet.name} 的所有活动`, 'success');
                        logAction(`停止了僵尸网络 ${botnet.name}`);
                    } else if (command === 'status') {
                        addOutput(`僵尸网络 ${botnet.name} 状态:`, 'info');
                        addOutput(`- 节点数量: ${botnet.nodes}`, 'info');
                        addOutput(`- 攻击能力: ${botnet.nodes * 5}%`, 'info');
                    } else {
                        addOutput(`错误: 未知的botnet命令 ${command}`, 'error');
                    }
                } else {
                    addOutput(`错误: 未知的使用类型 ${type}`, 'error');
                }
            },
            
            attack: (type, ip) => {
                if (!type || !ip) {
                    addOutput('错误: 需要指定攻击类型和目标IP', 'error');
                    addOutput('提示: 使用 "attack player [ip]" 攻击其他玩家', 'info');
                    return;
                }
                
                if (type === 'player') {
                    const player = gameState.players.find(p => p.ip === ip);
                    if (!player) {
                        addOutput(`错误: 找不到玩家 ${ip}`, 'error');
                        addOutput('提示: 使用 "multiplayer" 查看在线玩家', 'info');
                        return;
                    }
                    
                    if (player.level > gameState.playerLevel + 2) {
                        addOutput(`警告: 目标玩家等级 (${player.level}) 远高于你 (${gameState.playerLevel})`, 'warning');
                    }
                    
                    addOutput(`准备攻击玩家 ${ip}...`, 'warning');
                    
                    // 玩家对战成功率计算
                    const successChance = 50 + 
                        (gameState.playerLevel * 5) - 
                        (player.level * 5) + 
                        (gameState.resources.skills.hacking * 3);
                    
                    setTimeout(() => {
                        const isSuccess = Math.random() * 100 < successChance;
                        
                        if (isSuccess) {
                            const stolenAmount = Math.floor(Math.random() * 200) + 100;
                            gameState.resources.money += stolenAmount;
                            addOutput(`攻击成功! 从玩家 ${ip} 窃取了 $${stolenAmount}`, 'success');
                            gameState.resources.reputation += 20;
                            
                            // 经验奖励
                            addExp(50);
                        } else {
                            addOutput(`攻击失败! 玩家 ${ip} 反击了你`, 'error');
                            gameState.resources.money = Math.max(0, gameState.resources.money - 100);
                            gameState.resources.reputation -= 15;
                        }
                        
                        updateStatus();
                        logAction(`${isSuccess ? '成功' : '失败'}攻击玩家 ${ip}`);
                    }, 2000);
                } else {
                    addOutput(`错误: 未知的攻击类型 ${type}`, 'error');
                }
            },
            
            hardware: () => {
                addOutput('硬件升级:', 'info');
                addOutput('----------------------------', 'info');
                gameState.hardwareUpgrades.forEach(upgrade => {
                    const canBuy = gameState.playerLevel >= upgrade.level && 
                                  !gameState.inventory.tools.includes(upgrade.name.toLowerCase().replace(' ', '_'));
                    
                    addOutput(`[${upgrade.id}] ${upgrade.name}`, 'info');
                    addOutput(`类型: ${upgrade.type}`, 'info');
                    addOutput(`效果: ${upgrade.effect}`, 'info');
                    addOutput(`要求等级: ${upgrade.level}`, 'info');
                    addOutput(`价格: $${upgrade.price}`, 'money');
                    addOutput(`状态: ${canBuy ? '可购买' : '未解锁'}`, canBuy ? 'success' : 'error');
                    addOutput('', 'info');
                });
            },
            
            upgradehw: (id) => {
                const upgrade = gameState.hardwareUpgrades.find(u => u.id == id);
                if (!upgrade) {
                    addOutput('错误: 无效的硬件升级ID', 'error');
                    addOutput('提示: 使用 "hardware" 查看可用升级', 'info');
                    return;
                }
                
                if (gameState.playerLevel < upgrade.level) {
                    addOutput(`错误: 需要等级 ${upgrade.level} 才能购买此升级`, 'error');
                    addOutput('提示: 完成任务或攻击系统获取经验升级', 'info');
                    return;
                }
                
                if (gameState.resources.money < upgrade.price) {
                    addOutput(`错误: 资金不足 (需要 $${upgrade.price})`, 'error');
                    return;
                }
                
                // 检查是否已经拥有
                const upgradeKey = upgrade.name.toLowerCase().replace(' ', '_');
                if (gameState.inventory.tools.includes(upgradeKey)) {
                    addOutput(`错误: 已经拥有此升级`, 'error');
                    return;
                }
                
                gameState.resources.money -= upgrade.price;
                gameState.inventory.tools.push(upgradeKey);
                
                // 应用升级效果
                switch(upgrade.type) {
                    case 'cpu':
                        gameState.resources.cpu += upgrade.effect.match(/\+(\d+)%/)[1] * 1;
                        break;
                    case 'memory':
                        gameState.resources.memory += upgrade.effect.match(/\+(\d+)%/)[1] * 1;
                        break;
                    case 'network':
                        gameState.resources.network += upgrade.effect.match(/\+(\d+)%/)[1] * 1;
                        break;
                }
                
                addOutput(`购买成功! ${upgrade.name} 已安装`, 'success');
                updateStatus();
                logAction(`购买了硬件升级 ${upgrade.name}`);
            },
            
            proxies: () => {
                addOutput('代理IP管理:', 'info');
                addOutput('----------------------------', 'info');
                if (gameState.inventory.proxies.length === 0) {
                    addOutput('没有可用的代理IP', 'info');
                    addOutput('可以在黑市购买代理IP包', 'info');
                    return;
                }
                
                addOutput('可用代理IP:', 'info');
                gameState.inventory.proxies.forEach((proxy, index) => {
                    addOutput(`[${index}] ${proxy.ip} (${proxy.country}) ${proxy === gameState.activeProxy ? '(使用中)' : ''}`, 'info');
                });
                
                addOutput('', 'info');
                addOutput('使用 "use proxy [id]" 启用代理', 'info');
                addOutput('使用 "use proxy off" 停用代理', 'info');
            },

            settings: (setting, value) => {
                if (!setting) {
                    // 显示当前设置
                    addOutput('当前系统设置:', 'info');
                    addOutput('----------------------------', 'info');
                    addOutput(`声音: ${gameState.settings.sound ? '开启' : '关闭'}`, 'info');
                    addOutput(`动画: ${gameState.settings.animations ? '开启' : '关闭'}`, 'info');
                    addOutput(`主题: ${gameState.settings.theme}`, 'info');
                    addOutput(`通知: ${gameState.settings.notifications ? '开启' : '关闭'}`, 'info');
                    addOutput('', 'info');
                    addOutput('使用 "settings [选项] [on/off]" 修改设置', 'info');
                    addOutput('例如: "settings sound off" 关闭声音', 'info');
                    return;
                }

                if (!value) {
                    addOutput(`错误: 需要指定设置值 (on/off)`, 'error');
                    return;
                }

                const validSettings = ['sound', 'animations', 'notifications'];
                if (validSettings.includes(setting)) {
                    if (value === 'on' || value === 'off') {
                        gameState.settings[setting] = value === 'on';
                        addOutput(`设置已更新: ${setting} = ${value}`, 'success');
                        logAction(`修改设置 ${setting}=${value}`);
                    } else {
                        addOutput(`错误: 无效的值, 使用 on 或 off`, 'error');
                    }
                } else if (setting === 'theme') {
                    if (['dark', 'light', 'green'].includes(value)) {
                        gameState.settings.theme = value;
                        addOutput(`主题已更改为: ${value}`, 'success');
                        applyTheme(value);
                        logAction(`更改主题为 ${value}`);
                    } else {
                        addOutput(`错误: 无效的主题, 可用选项: dark, light, green`, 'error');
                    }
                } else {
                    addOutput(`错误: 未知的设置选项`, 'error');
                }
            },

            help: () => {
                addOutput('KaliNet 帮助文档', 'info');
                addOutput('----------------------------', 'info');
                addOutput('基本命令:', 'info');
                addOutput('- help: 显示帮助信息', 'info');
                addOutput('- clear: 清除终端输出', 'info');
                addOutput('- status: 显示系统状态', 'info');
                addOutput('', 'info');
                
                addOutput('网络操作:', 'info');
                addOutput('- scan [ip|network]: 扫描目标IP或整个网络', 'info');
                addOutput('- connect [ip]: 连接到已攻破的系统', 'info');
                addOutput('- disconnect: 断开当前连接', 'info');
                addOutput('', 'info');
                
                addOutput('攻击命令:', 'info');
                addOutput('- exploit [type] [ip]: 对目标发起特定攻击', 'info');
                addOutput('- attack player [ip]: 攻击其他玩家', 'info');
                addOutput('- botnet [command]: 控制僵尸网络', 'info');
                addOutput('', 'info');
                
                addOutput('资源管理:', 'info');
                addOutput('- inventory: 查看库存', 'info');
                addOutput('- buy [item]: 购买物品', 'info');
                addOutput('- upgrade [cpu|memory|network]: 升级资源', 'info');
                addOutput('- upgradehw [id]: 购买硬件升级', 'info');
                addOutput('', 'info');
                
                addOutput('其他:', 'info');
                addOutput('- missions: 查看任务', 'info');
                addOutput('- skills: 查看技能树', 'info');
                addOutput('- learn [id]: 学习技能', 'info');
                addOutput('- market: 访问黑市', 'info');
                addOutput('- logs: 查看活动日志', 'info');
                addOutput('- proxies: 管理代理IP', 'info');
                addOutput('- settings: 查看或修改设置', 'info');
                addOutput('- save: 保存游戏进度', 'info');
                addOutput('- load: 加载游戏进度', 'info');
            },

            save: () => {
                try {
                    const saveData = JSON.stringify(gameState);
                    localStorage.setItem('kaliNetSave', saveData);
                    addOutput('游戏进度已保存', 'success');
                    showNotification('保存成功', '游戏进度已保存', 'success');
                    logAction('保存了游戏进度');
                } catch (e) {
                    addOutput('保存失败: ' + e.message, 'error');
                }
            },

            load: () => {
                try {
                    const saveData = localStorage.getItem('kaliNetSave');
                    if (!saveData) {
                        addOutput('没有找到保存的游戏进度', 'error');
                        return;
                    }
                    
                    const loadedState = JSON.parse(saveData);
                    Object.assign(gameState, loadedState);
                    
                    // 恢复游戏状态
                    updateStatus();
                    updateNetworkMap();
                    updatePrompt();
                    
                    addOutput('游戏进度已加载', 'success');
                    showNotification('加载成功', '游戏进度已加载', 'success');
                    logAction('加载了游戏进度');
                } catch (e) {
                    addOutput('加载失败: ' + e.message, 'error');
                }
            }
        };
        
        // 辅助函数
        function addOutput(text, type = '') {
            const line = document.createElement('div');
            line.className = `output-line ${type}`;
            line.textContent = text;
            outputEl.appendChild(line);
            outputEl.scrollTop = outputEl.scrollHeight;
            
            // 添加到最近活动
            if (type === 'error' || type === 'success' || type === 'warning') {
                const activityLine = document.createElement('div');
                activityLine.className = `output-line ${type}`;
                activityLine.textContent = text;
                recentActivityEl.insertBefore(activityLine, recentActivityEl.firstChild);
                
                if (recentActivityEl.children.length > 10) {
                    recentActivityEl.removeChild(recentActivityEl.lastChild);
                }
            }
        }
        
        function showNotification(title, message, type) {
            if (!gameState.settings.notifications) return;
            
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `<strong>${title}</strong><br>${message}`;
            notificationsEl.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }
        
        function updateStatus() {
            // 使用requestAnimationFrame优化性能
            requestAnimationFrame(() => {
                // 更新状态指示器
                const anonymityIndicator = document.querySelector('.anonymous');
                if (gameState.resources.anonymity < 30) {
                    anonymityIndicator.style.backgroundColor = 'var(--error-color)';
                    anonymityIndicator.style.boxShadow = '0 0 5px var(--error-color)';
                } else if (gameState.resources.anonymity < 70) {
                    anonymityIndicator.style.backgroundColor = 'var(--warning-color)';
                    anonymityIndicator.style.boxShadow = '0 0 5px var(--warning-color)';
                } else {
                    anonymityIndicator.style.backgroundColor = 'var(--success-color)';
                    anonymityIndicator.style.boxShadow = '0 0 5px var(--success-color)';
                }
                
                // 更新显示值
                document.getElementById('money-display').textContent = gameState.resources.money;
                document.getElementById('rep-display').textContent = gameState.resources.reputation;
                document.getElementById('level-display').textContent = gameState.playerLevel;
                document.getElementById('cpu-display').textContent = gameState.resources.cpu;
                document.getElementById('memory-display').textContent = gameState.resources.memory;
                document.getElementById('network-display').textContent = gameState.resources.network;
                document.getElementById('anon-display').textContent = gameState.resources.anonymity;
                document.getElementById('proxy-display').textContent = gameState.activeProxy ? 
                    `${gameState.activeProxy.ip} (${gameState.activeProxy.country})` : '无';
            });
        }
        
        function updatePrompt() {
            requestAnimationFrame(() => {
                const promptEl = document.getElementById('prompt');
                if (gameState.currentIp === '192.168.1.100') {
                    promptEl.textContent = 'root@Hack-Panel:';
                } else {
                    const node = gameState.networkNodes.find(n => n.ip === gameState.currentIp);
                    promptEl.textContent = `hacker@${node.type.replace('_', '-')}:~#`;
                }
            });
        }
        
        function logAction(action) {
            const now = new Date();
            const timeStr = `${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`;
            gameState.logs.push({
                time: timeStr,
                action: action
            });
            
            // 限制日志数量
            if (gameState.logs.length > 100) {
                gameState.logs.shift();
            }
        }
        
        function checkMissions(ip, attackType) {
            gameState.missions.forEach(mission => {
                if (!mission.completed) {
                    // 检查特定IP任务
                    if (mission.target === ip) {
                        mission.completed = true;
                        gameState.resources.money += mission.reward;
                        addExp(mission.exp);
                        addOutput(`任务完成: ${mission.title}! 获得 $${mission.reward} 和 ${mission.exp}经验`, 'money');
                        showNotification('任务完成', mission.title, 'success');
                    }
                    // 检查网络范围任务
                    else if (mission.target.includes('/24') && ip.startsWith(mission.target.split('.')[0])) {
                        // 检查是否已经攻破足够数量的服务器
                        const hackedServers = gameState.networkNodes.filter(n => 
                            n.ip.startsWith(mission.target.split('.')[0]) && 
                            n.type.includes('server') && 
                            gameState.hackedNodes.includes(n.ip)).length;
                        
                        if (hackedServers >= 2) {
                            mission.completed = true;
                            gameState.resources.money += mission.reward;
                            addExp(mission.exp);
                            addOutput(`任务完成: ${mission.title}! 获得 $${mission.reward} 和 ${mission.exp}经验`, 'money');
                            showNotification('任务完成', mission.title, 'success');
                        }
                    }
                    // 检查僵尸网络任务
                    else if (mission.title.includes('僵尸网络') && 
                             gameState.inventory.botnets.length > 0 && 
                             gameState.inventory.botnets[0].nodes >= 20) {
                        mission.completed = true;
                        gameState.resources.money += mission.reward;
                        addExp(mission.exp);
                        addOutput(`任务完成: ${mission.title}! 获得 $${mission.reward} 和 ${mission.exp}经验`, 'money');
                        showNotification('任务完成', mission.title, 'success');
                    }
                }
            });
        }
        
        function updateNetworkMap() {
            // 使用requestAnimationFrame优化性能
            requestAnimationFrame(() => {
                // 更新网络地图
                networkMapEl.innerHTML = '';
                gameState.networkNodes.forEach(node => {
                    if (gameState.discoveredNodes.includes(node.ip)) {
                        const nodeEl = document.createElement('div');
                        nodeEl.className = `node ${node.type.replace('_', '-')} ${node.network}`;
                        nodeEl.setAttribute('data-ip', node.ip);
                        
                        let displayName = `${node.type} (${node.ip})`;
                        if (node.type === 'player') {
                            const player = gameState.players.find(p => p.ip === node.ip);
                            if (player) {
                                displayName = `${player.name} (Lv.${player.level}) (${node.ip})`;
                            }
                        }
                        
                        nodeEl.textContent = displayName;
                        
                        if (gameState.hackedNodes.includes(node.ip)) {
                            nodeEl.style.borderColor = 'var(--hack-color)';
                        }
                        
                        nodeEl.addEventListener('click', () => {
                            targetInfoEl.innerHTML = '';
                            const infoLine = document.createElement('div');
                            infoLine.className = 'output-line info';
                            infoLine.textContent = `目标信息 - ${node.ip}:`;
                            targetInfoEl.appendChild(infoLine);
                            
                            const typeLine = document.createElement('div');
                            typeLine.className = 'output-line';
                            typeLine.textContent = `类型: ${node.type}`;
                            targetInfoEl.appendChild(typeLine);
                            
                            const osLine = document.createElement('div');
                            osLine.className = 'output-line';
                            osLine.textContent = `操作系统: ${node.os}`;
                            targetInfoEl.appendChild(osLine);
                            
                            const securityLine = document.createElement('div');
                            securityLine.className = 'output-line';
                            securityLine.textContent = `安全等级: ${node.security}/100`;
                            targetInfoEl.appendChild(securityLine);
                            
                            const servicesLine = document.createElement('div');
                            servicesLine.className = 'output-line';
                            servicesLine.textContent = `运行服务: ${node.services.join(', ')}`;
                            targetInfoEl.appendChild(servicesLine);
                            
                            const networkLine = document.createElement('div');
                            networkLine.className = 'output-line';
                            networkLine.textContent = `网络类型: ${node.network}`;
                            targetInfoEl.appendChild(networkLine);
                            
                            if (node.type === 'player') {
                                const player = gameState.players.find(p => p.ip === node.ip);
                                if (player) {
                                    const playerLine = document.createElement('div');
                                    playerLine.className = 'output-line player';
                                    playerLine.textContent = `玩家: ${player.name} (等级 ${player.level}, 声誉 ${player.reputation})`;
                                    targetInfoEl.appendChild(playerLine);
                                }
                            }
                            
                            if (gameState.hackedNodes.includes(node.ip)) {
                                const hackedLine = document.createElement('div');
                                hackedLine.className = 'output-line success';
                                hackedLine.textContent = `状态: 已攻破`;
                                targetInfoEl.appendChild(hackedLine);
                            }
                            
                            gameState.targetIp = node.ip;
                        });
                        
                        networkMapEl.appendChild(nodeEl);
                    }
                });
                
                // 更新迷你地图
                updateMinimap();
            });
        }
        
        function updateMinimap() {
            requestAnimationFrame(() => {
                minimapEl.innerHTML = '';
                
                gameState.networkNodes.forEach(node => {
                    if (gameState.discoveredNodes.includes(node.ip)) {
                        const nodeEl = document.createElement('div');
                        nodeEl.className = `minimap-node ${node.type.replace('_', '-')} ${node.network}`;
                        
                        // 随机位置
                        const left = 10 + Math.random() * 80;
                        const top = 10 + Math.random() * 80;
                        nodeEl.style.left = `${left}%`;
                        nodeEl.style.top = `${top}%`;
                        
                        if (node.ip === gameState.targetIp) {
                            nodeEl.classList.add('current');
                        }
                        
                        minimapEl.appendChild(nodeEl);
                    }
                });
            });
        }
        
        function addExp(amount) {
            gameState.playerExp += amount;
            const expNeeded = getExpForNextLevel();
            
            if (gameState.playerExp >= expNeeded) {
                gameState.playerLevel++;
                gameState.playerExp -= expNeeded;
                addOutput(`升级! 你现在是等级 ${gameState.playerLevel}`, 'success');
                showNotification('升级', `恭喜你升到等级 ${gameState.playerLevel}`, 'success');
            }
            
            updateStatus();
        }
        
        function getExpForNextLevel() {
            return gameState.playerLevel * 200;
        }
        
        function startMining(rate) {
            if (gameState.miningInterval) {
                clearInterval(gameState.miningInterval);
            }
            
            addOutput(`开始加密货币挖矿 (速率: $${rate}/分钟)`, 'success');
            
            gameState.miningInterval = setInterval(() => {
                gameState.resources.money += rate;
                gameState.resources.cpu = Math.max(10, gameState.resources.cpu - 5);
                gameState.resources.memory = Math.max(10, gameState.resources.memory - 3);
                
                if (gameState.resources.cpu <= 10 || gameState.resources.memory <= 10) {
                    addOutput('资源不足，挖矿停止', 'error');
                    clearInterval(gameState.miningInterval);
                    gameState.miningInterval = null;
                }
                
                updateStatus();
            }, 60000);
        }

        function applyTheme(theme) {
            const root = document.documentElement;
            
            switch(theme) {
                case 'dark':
                    root.style.setProperty('--bg-color', '#000');
                    root.style.setProperty('--text-color', '#0f0');
                    root.style.setProperty('--accent-color', '#0a0');
                    root.style.setProperty('--panel-bg', '#111');
                    break;
                case 'light':
                    root.style.setProperty('--bg-color', '#f0f0f0');
                    root.style.setProperty('--text-color', '#333');
                    root.style.setProperty('--accent-color', '#0066cc');
                    root.style.setProperty('--panel-bg', '#fff');
                    break;
                case 'green':
                    root.style.setProperty('--bg-color', '#001a00');
                    root.style.setProperty('--text-color', '#00ff00');
                    root.style.setProperty('--accent-color', '#00cc00');
                    root.style.setProperty('--panel-bg', '#002200');
                    break;
            }
        }

        function saveGame() {
            commands.save();
        }

        function loadGame() {
            commands.load();
        }
        
        // 事件监听器
        commandInputEl.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                const commandText = commandInputEl.value.trim();
                if (commandText) {
                    addOutput(`${document.getElementById('prompt').textContent} ${commandText}`);
                    
                    const parts = commandText.split(' ');
                    const command = parts[0];
                    const args = parts.slice(1);
                    
                    if (commands[command]) {
                        commands[command](...args);
                    } else {
                        addOutput(`错误: 未知命令 "${command}"`, 'error');
                        addOutput('提示: 输入 "help" 查看可用命令', 'info');
                    }
                    
                    commandInputEl.value = '';
                }
            }
        });
        
        // 标签切换
        document.querySelectorAll('.menu-item[data-tab]').forEach(item => {
            item.addEventListener('click', () => {
                const tabName = item.getAttribute('data-tab');
                gameState.currentTab = tabName;
                
                // 清空输出并显示相关内容
                outputEl.innerHTML = '';
                
                switch(tabName) {
                    case 'home':
                        addOutput('主控制台', 'info');
                        addOutput('----------------------------', 'info');
                        addOutput('欢迎回到主控制台', 'info');
                        addOutput('从这里可以访问所有功能', 'info');
                        addOutput('使用左侧菜单导航或直接输入命令', 'info');
                        break;
                    
                    case 'scan':
                        addOutput('网络扫描工具', 'info');
                        addOutput('----------------------------', 'info');
                        addOutput('已发现节点:', 'info');
                        gameState.discoveredNodes.forEach(ip => {
                            const node = gameState.networkNodes.find(n => n.ip === ip);
                            if (node) {
                                addOutput(`- ${ip} (${node.type})`, 'info');
                            }
                        });
                        addOutput('', 'info');
                        addOutput('使用 "scan [ip]" 扫描特定目标', 'info');
                        addOutput('使用 "scan network" 扫描整个网络', 'info');
                        break;
                    
                    case 'exploits':
                        addOutput('漏洞利用工具', 'info');
                        addOutput('----------------------------', 'info');
                        addOutput('可用漏洞:', 'info');
                        gameState.inventory.exploits.forEach(exp => {
                            addOutput(`- ${exp}`, 'info');
                        });
                        if (gameState.inventory.zeroDays.length > 0) {
                            addOutput('零日漏洞:', 'info');
                            gameState.inventory.zeroDays.forEach(zd => {
                                addOutput(`- ${zd} (零日漏洞)`, 'hack');
                            });
                        }
                        addOutput('', 'info');
                        addOutput('使用 "exploit [type] [ip]" 发起攻击', 'info');
                        break;
                    
                    case 'tools':
                        addOutput('黑客工具集', 'info');
                        addOutput('----------------------------', 'info');
                        addOutput('已安装工具:', 'info');
                        gameState.inventory.tools.forEach(tool => {
                            addOutput(`- ${tool}`, 'info');
                        });
                        addOutput('', 'info');
                        addOutput('使用 "buy [tool]" 从黑市购买新工具', 'info');
                        break;
                    
                    case 'ddos':
                        addOutput('DDoS 攻击面板', 'info');
                        addOutput('----------------------------', 'info');
                        addOutput('选择目标:', 'info');
                        gameState.networkNodes.filter(n => n.type !== 'router').forEach(node => {
                            if (gameState.discoveredNodes.includes(node.ip)) {
                                addOutput(`- ${node.ip} (${node.type})`, 'info');
                            }
                        });
                        addOutput('', 'info');
                        addOutput('输入 "exploit ddos [ip]" 发起攻击', 'info');
                        break;
                    
                    case 'xss':
                        addOutput('XSS 注入面板', 'info');
                        addOutput('----------------------------', 'info');
                        addOutput('选择目标:', 'info');
                        gameState.networkNodes.filter(n => n.services.includes('http')).forEach(node => {
                            if (gameState.discoveredNodes.includes(node.ip)) {
                                addOutput(`- ${node.ip} (${node.type})`, 'info');
                            }
                        });
                        addOutput('', 'info');
                        addOutput('输入 "exploit xss [ip]" 发起攻击', 'info');
                        break;
                    
                    case 'sql':
                        addOutput('SQL 注入面板', 'info');
                        addOutput('----------------------------', 'info');
                        addOutput('选择目标:', 'info');
                        gameState.networkNodes.filter(n => n.services.some(s => s.includes('sql'))).forEach(node => {
                            if (gameState.discoveredNodes.includes(node.ip)) {
                                addOutput(`- ${node.ip} (${node.type})`, 'info');
                            }
                        });
                        addOutput('', 'info');
                        addOutput('输入 "exploit sql [ip]" 发起攻击', 'info');
                        break;
                    
                    case 'phishing':
                        addOutput('钓鱼攻击面板', 'info');
                        addOutput('----------------------------', 'info');
                        addOutput('选择目标:', 'info');
                        gameState.networkNodes.filter(n => n.type === 'workstation' || n.type === 'admin_pc').forEach(node => {
                            if (gameState.discoveredNodes.includes(node.ip)) {
                                addOutput(`- ${node.ip} (${node.type})`, 'info');
                            }
                        });
                        addOutput('', 'info');
                        addOutput('输入 "exploit phishing [ip]" 发起攻击', 'info');
                        break;
                    
                    case 'bruteforce':
                        addOutput('暴力破解面板', 'info');
                        addOutput('----------------------------', 'info');
                        addOutput('选择目标:', 'info');
                        gameState.networkNodes.filter(n => n.services.includes('ssh') || n.services.includes('rdp')).forEach(node => {
                            if (gameState.discoveredNodes.includes(node.ip)) {
                                addOutput(`- ${node.ip} (${node.type})`, 'info');
                            }
                        });
                        addOutput('', 'info');
                        addOutput('输入 "exploit bruteforce [ip]" 发起攻击', 'info');
                        break;
                    
                    case 'mitm':
                        addOutput('中间人攻击面板', 'info');
                        addOutput('----------------------------', 'info');
                        addOutput('选择目标:', 'info');
                        gameState.networkNodes.filter(n => n.type === 'router' || n.type === 'workstation').forEach(node => {
                            if (gameState.discoveredNodes.includes(node.ip)) {
                                addOutput(`- ${node.ip} (${node.type})`, 'info');
                            }
                        });
                        addOutput('', 'info');
                        addOutput('输入 "exploit mitm [ip]" 发起攻击', 'info');
                        break;
                    
                    case 'zero-day':
                        addOutput('零日漏洞面板', 'info');
                        addOutput('----------------------------', 'info');
                        if (gameState.inventory.zeroDays.length === 0) {
                            addOutput('你没有零日漏洞', 'warning');
                            addOutput('可以在黑市购买零日漏洞', 'info');
                        } else {
                            addOutput('可用零日漏洞:', 'info');
                            gameState.inventory.zeroDays.forEach(zd => {
                                addOutput(`- ${zd}`, 'hack');
                            });
                            addOutput('', 'info');
                            addOutput('选择目标:', 'info');
                            gameState.networkNodes.forEach(node => {
                                if (gameState.discoveredNodes.includes(node.ip)) {
                                    addOutput(`- ${node.ip} (${node.type})`, 'info');
                                }
                            });
                            addOutput('', 'info');
                            addOutput('输入 "exploit zero-day [ip]" 发起攻击', 'info');
                        }
                        break;
                    
                    case 'ransomware':
                        addOutput('勒索软件面板', 'info');
                        addOutput('----------------------------', 'info');
                        addOutput('选择目标:', 'info');
                        gameState.networkNodes.filter(n => n.type === 'workstation' || n.type === 'admin_pc' || n.type === 'file_server').forEach(node => {
                            if (gameState.discoveredNodes.includes(node.ip)) {
                                addOutput(`- ${node.ip} (${node.type})`, 'info');
                            }
                        });
                        addOutput('', 'info');
                        addOutput('输入 "exploit ransomware [ip]" 发起攻击', 'info');
                        break;
                    
                    case 'iot':
                        addOutput('IoT僵尸网络面板', 'info');
                        addOutput('----------------------------', 'info');
                        addOutput('选择目标:', 'info');
                        gameState.networkNodes.filter(n => n.type === 'iot_device').forEach(node => {
                            if (gameState.discoveredNodes.includes(node.ip)) {
                                addOutput(`- ${node.ip} (${node.type})`, 'info');
                            }
                        });
                        addOutput('', 'info');
                        addOutput('输入 "exploit iot [ip]" 发起攻击', 'info');
                        break;
                    
                    case 'backdoor':
                        addOutput('后门植入面板', 'info');
                        addOutput('----------------------------', 'info');
                        addOutput('选择目标:', 'info');
                        gameState.networkNodes.filter(n => n.type !== 'router').forEach(node => {
                            if (gameState.discoveredNodes.includes(node.ip)) {
                                addOutput(`- ${node.ip} (${node.type})`, 'info');
                            }
                        });
                        addOutput('', 'info');
                        addOutput('输入 "exploit backdoor [ip]" 发起攻击', 'info');
                        break;
                    
                    case 'cryptojacking':
                        addOutput('加密货币挖矿面板', 'info');
                        addOutput('----------------------------', 'info');
                        addOutput('选择目标:', 'info');
                        gameState.networkNodes.filter(n => n.type === 'workstation' || n.type === 'server').forEach(node => {
                            if (gameState.discoveredNodes.includes(node.ip)) {
                                addOutput(`- ${node.ip} (${node.type})`, 'info');
                            }
                        });
                        addOutput('', 'info');
                        addOutput('输入 "exploit cryptojacking [ip]" 发起攻击', 'info');
                        break;
                    
                    case 'dns-spoofing':
                        addOutput('DNS欺骗面板', 'info');
                        addOutput('----------------------------', 'info');
                        addOutput('选择目标:', 'info');
                        gameState.networkNodes.filter(n => n.type === 'router' || n.type === 'dns_server').forEach(node => {
                            if (gameState.discoveredNodes.includes(node.ip)) {
                                addOutput(`- ${node.ip} (${node.type})`, 'info');
                            }
                        });
                        addOutput('', 'info');
                        addOutput('输入 "exploit dns-spoofing [ip]" 发起攻击', 'info');
                        break;
                    
                    case 'credential-stuffing':
                        addOutput('凭证填充面板', 'info');
                        addOutput('----------------------------', 'info');
                        addOutput('选择目标:', 'info');
                        gameState.networkNodes.filter(n => n.services.includes('http') || n.services.includes('https')).forEach(node => {
                            if (gameState.discoveredNodes.includes(node.ip)) {
                                addOutput(`- ${node.ip} (${node.type})`, 'info');
                            }
                        });
                        addOutput('', 'info');
                        addOutput('输入 "exploit credential-stuffing [ip]" 发起攻击', 'info');
                        break;
                    
                    case 'ai-poisoning':
                        addOutput('AI数据投毒面板', 'info');
                        addOutput('----------------------------', 'info');
                        addOutput('选择目标:', 'info');
                        gameState.networkNodes.filter(n => n.type === 'ai_server').forEach(node => {
                            if (gameState.discoveredNodes.includes(node.ip)) {
                                addOutput(`- ${node.ip} (${node.type})`, 'info');
                            }
                        });
                        addOutput('', 'info');
                        addOutput('输入 "exploit ai-poisoning [ip]" 发起攻击', 'info');
                        break;
                    
                    case 'missions':
                        commands.missions();
                        break;
                    
                    case 'logs':
                        commands.logs();
                        break;
                    
                    case 'inventory':
                        commands.inventory();
                        break;
                    
                    case 'skills':
                        commands.skills();
                        break;
                    
                    case 'market':
                        commands.market();
                        break;
                    
                    case 'multiplayer':
                        addOutput('多人游戏面板', 'info');
                        addOutput('----------------------------', 'info');
                        addOutput('在线玩家:', 'info');
                        gameState.players.forEach(player => {
                            addOutput(`- ${player.name} (${player.ip})`, 'player');
                            addOutput(`  等级: ${player.level}, 声誉: ${player.reputation}`, 'info');
                        });
                        addOutput('', 'info');
                        addOutput('输入 "attack player [ip]" 攻击其他玩家', 'info');
                        break;
                    
                    case 'hardware':
                        commands.hardware();
                        break;
                    
                    case 'proxies':
                        commands.proxies();
                        break;
                    
                    case 'settings':
                        commands.settings();
                        break;
                    
                    case 'help':
                        commands.help();
                        break;
                    
                    default:
                        addOutput(`${tabName} 功能`, 'info');
                        addOutput('----------------------------', 'info');
                        addOutput('此功能已完全实现', 'info');
                }
            });
        });
        
        // 标签页切换
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                const tabName = tab.getAttribute('data-tab');
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById(`${tabName}-tab`).classList.add('active');
            });
        });

        // 警告模态框关闭按钮
        warningCloseBtn.addEventListener('click', () => {
            warningModal.style.display = 'none';
        });

        // 保存/加载按钮事件
        saveGameBtn.addEventListener('click', saveGame);
        loadGameBtn.addEventListener('click', loadGame);
        
        // 初始化
        updateStatus();
        updateNetworkMap();
        updatePrompt();
        
        // 游戏循环 - 执法机构追踪
        setInterval(() => {
            if (gameState.lawEnforcement.awareness > 0) {
                // 随时间降低关注度
                const stealthReduction = gameState.resources.skills.stealth * 2;
                gameState.lawEnforcement.awareness = Math.max(0, gameState.lawEnforcement.awareness - stealthReduction);
                
                // 如果关注度高，可能触发调查
                if (gameState.lawEnforcement.awareness > 70 && 
                    Math.random() < 0.1) {
                    gameState.lawEnforcement.investigationProgress += 5 + Math.random() * 10;
                    showNotification('警告', '执法机构正在调查你的活动', 'error');
                    
                    if (gameState.lawEnforcement.investigationProgress >= 100) {
                        // 游戏结束
                        addOutput('执法机构已追踪到你的位置!', 'error');
                        addOutput('游戏结束 - 你被逮捕了', 'error');
                        showNotification('游戏结束', '你被执法机构逮捕了', 'error');
                        commandInputEl.disabled = true;
                    }
                }
                
                updateStatus();
            }
            
            // 随机事件
            if (Math.random() < 0.05) {
                const events = [
                    { msg: "网络波动导致匿名度下降", effect: () => { gameState.resources.anonymity -= 5; }, type: "warning" },
                    { msg: "发现未修补的系统漏洞", effect: () => { 
                        const newExploit = `exploit_${Math.floor(Math.random() * 1000)}`;
                        gameState.inventory.exploits.push(newExploit);
                        return `获得新漏洞: ${newExploit}`;
                    }, type: "success" },
                    { msg: "加密货币价格上涨", effect: () => { 
                        if (gameState.miningInterval) {
                            const bonus = Math.floor(Math.random() * 100) + 50;
                            gameState.resources.money += bonus;
                            return `挖矿收益增加 $${bonus}`;
                        }
                        return null;
                    }, type: "money" }
                ];
                
                const event = events[Math.floor(Math.random() * events.length)];
                const result = event.effect();
                
                addOutput(`[随机事件] ${event.msg}`, event.type);
                if (result) {
                    addOutput(`[随机事件] ${result}`, event.type);
                }
                
                updateStatus();
            }
        }, 10000);
    </script>
</body>
</html>