<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H5ä½ä»£ç ç¼–è¾‘å™¨ - å¢å¼ºç‰ˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Arial', sans-serif;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }
        .sidebar {
            width: 250px;
            background-color: #2c3e50;
            color: white;
            padding: 10px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }
        .sidebar-section {
            margin-bottom: 15px;
        }
        .sidebar-section h3 {
            padding: 5px 0;
            border-bottom: 1px solid #34495e;
            margin-bottom: 5px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .sidebar-section h3::after {
            content: 'â–¼';
            font-size: 0.8em;
            transition: transform 0.2s;
        }
        .sidebar-section.collapsed h3::after {
            transform: rotate(-90deg);
        }
        .sidebar-section.collapsed .component-list {
            display: none;
        }
        .component-list {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 5px;
        }
        .component {
            padding: 8px;
            background-color: #34495e;
            border-radius: 4px;
            cursor: grab;
            user-select: none;
            font-size: 0.9em;
            text-align: center;
        }
        .component:hover {
            background-color: #3d566e;
        }
        .workspace {
            flex: 1;
            display: flex;
            flex-direction: column;
            background-color: #ecf0f1;
        }
        .toolbar {
            padding: 10px;
            background-color: #3498db;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .toolbar-group {
            display: flex;
            gap: 10px;
        }
        .toolbar-btn {
            padding: 5px 10px;
            background-color: #2980b9;
            border: none;
            color: white;
            border-radius: 4px;
            cursor: pointer;
        }
        .toolbar-btn:hover {
            background-color: #1a6ea3;
        }
        .toolbar-btn.active {
            background-color: #16a085;
        }
        .toolbar-btn.disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
        }
        .preview-container {
            flex: 1;
            padding: 20px;
            overflow: auto;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            background-color: #bdc3c7;
        }
        .preview-frame {
            background-color: white;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            position: relative;
            overflow: auto;
            transition: width 0.3s;
        }
        .droppable {
            min-height: 50px;
            border: 2px dashed #7f8c8d;
            margin: 5px;
            padding: 10px;
            width: 100%;
            height: 100%;
            box-sizing: border-box;
        }
        .element {
            margin: 5px;
            padding: 10px;
            background-color: #bdc3c7;
            position: relative;
            cursor: move;
        }
        .element:hover {
            outline: 2px solid #3498db;
        }
        .element.selected {
            outline: 2px solid #e74c3c;
        }
        .element-toolbar {
            position: absolute;
            top: -25px;
            right: 0;
            background-color: #3498db;
            display: none;
            border-radius: 3px 3px 0 0;
            overflow: hidden;
        }
        .element:hover .element-toolbar, .element.selected .element-toolbar {
            display: flex;
        }
        .element-toolbar button {
            background: none;
            border: none;
            color: white;
            padding: 2px 5px;
            cursor: pointer;
            font-size: 0.8em;
        }
        .element-toolbar button:hover {
            background-color: #2980b9;
        }
        .properties-panel {
            width: 300px;
            background-color: #34495e;
            color: white;
            padding: 10px;
            overflow-y: auto;
        }
        .property-item {
            margin-bottom: 10px;
        }
        .property-item label {
            display: block;
            margin-bottom: 5px;
            font-size: 0.9em;
        }
        .property-item input, .property-item select, .property-item textarea {
            width: 100%;
            padding: 5px;
            border-radius: 3px;
            border: 1px solid #2c3e50;
        }
        .tab-container {
            display: flex;
            margin-bottom: 10px;
            border-bottom: 1px solid #2c3e50;
        }
        .tab {
            padding: 5px 10px;
            background-color: #7f8c8d;
            margin-right: 5px;
            cursor: pointer;
            border-radius: 3px 3px 0 0;
            font-size: 0.9em;
        }
        .tab.active {
            background-color: #3498db;
        }
        .code-editor {
            width: 100%;
            height: 200px;
            font-family: monospace;
            background-color: #2c3e50;
            color: #ecf0f1;
            border: 1px solid #2c3e50;
        }
        .device-selector {
            display: flex;
            gap: 5px;
        }
        .template-preview {
            width: 100%;
            height: 80px;
            background-color: #ecf0f1;
            margin-bottom: 5px;
            overflow: hidden;
            position: relative;
            cursor: pointer;
        }
        .template-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .template-item {
            margin-bottom: 15px;
            background-color: #3d566e;
            padding: 10px;
            border-radius: 4px;
        }
        .template-item h4 {
            margin-bottom: 5px;
        }
        .color-picker {
            display: flex;
            align-items: center;
        }
        .color-picker input[type="color"] {
            width: 30px;
            height: 30px;
            padding: 0;
            margin-right: 5px;
        }
        .color-picker input[type="text"] {
            flex: 1;
        }
        .history-controls {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #2c3e50;
        }
        .component-icon {
            font-size: 1.5em;
            margin-bottom: 3px;
        }
        .search-box {
            margin-bottom: 10px;
        }
        .search-box input {
            width: 100%;
            padding: 5px;
            border-radius: 3px;
            border: 1px solid #2c3e50;
        }
    </style>
</head>
<body>
    <!-- å·¦ä¾§ç»„ä»¶é¢æ¿ -->
    <div class="sidebar" id="components-panel">
        <div class="search-box">
            <input type="text" id="component-search" placeholder="æœç´¢ç»„ä»¶...">
        </div>
        
        <div class="sidebar-section">
            <h3>åŸºç¡€ç»„ä»¶</h3>
            <div class="component-list">
                <div class="component" draggable="true" data-type="container">
                    <div class="component-icon">ğŸ“¦</div>
                    <div>å®¹å™¨</div>
                </div>
                <div class="component" draggable="true" data-type="text">
                    <div class="component-icon">ğŸ“</div>
                    <div>æ–‡æœ¬</div>
                </div>
                <div class="component" draggable="true" data-type="button">
                    <div class="component-icon">ğŸ”˜</div>
                    <div>æŒ‰é’®</div>
                </div>
                <div class="component" draggable="true" data-type="image">
                    <div class="component-icon">ğŸ–¼ï¸</div>
                    <div>å›¾ç‰‡</div>
                </div>
                <div class="component" draggable="true" data-type="input">
                    <div class="component-icon">ğŸ“¥</div>
                    <div>è¾“å…¥æ¡†</div>
                </div>
                <div class="component" draggable="true" data-type="textarea">
                    <div class="component-icon">ğŸ“„</div>
                    <div>å¤šè¡Œæ–‡æœ¬</div>
                </div>
                <div class="component" draggable="true" data-type="video">
                    <div class="component-icon">ğŸ¬</div>
                    <div>è§†é¢‘</div>
                </div>
                <div class="component" draggable="true" data-type="audio">
                    <div class="component-icon">ğŸµ</div>
                    <div>éŸ³é¢‘</div>
                </div>
                <div class="component" draggable="true" data-type="progress">
                    <div class="component-icon">ğŸ“Š</div>
                    <div>è¿›åº¦æ¡</div>
                </div>
                <div class="component" draggable="true" data-type="table">
                    <div class="component-icon">ğŸ“‹</div>
                    <div>è¡¨æ ¼</div>
                </div>
            </div>
        </div>
        
        <div class="sidebar-section">
            <h3>è¡¨å•ç»„ä»¶</h3>
            <div class="component-list">
                <div class="component" draggable="true" data-type="form">
                    <div class="component-icon">ğŸ“‹</div>
                    <div>è¡¨å•</div>
                </div>
                <div class="component" draggable="true" data-type="checkbox">
                    <div class="component-icon">â˜‘ï¸</div>
                    <div>å¤é€‰æ¡†</div>
                </div>
                <div class="component" draggable="true" data-type="radio">
                    <div class="component-icon">ğŸ”˜</div>
                    <div>å•é€‰æŒ‰é’®</div>
                </div>
                <div class="component" draggable="true" data-type="select">
                    <div class="component-icon">ğŸ”½</div>
                    <div>ä¸‹æ‹‰æ¡†</div>
                </div>
                <div class="component" draggable="true" data-type="range">
                    <div class="component-icon">ğŸšï¸</div>
                    <div>æ»‘å—</div>
                </div>
                <div class="component" draggable="true" data-type="date">
                    <div class="component-icon">ğŸ“…</div>
                    <div>æ—¥æœŸé€‰æ‹©</div>
                </div>
                <div class="component" draggable="true" data-type="file">
                    <div class="component-icon">ğŸ“</div>
                    <div>æ–‡ä»¶ä¸Šä¼ </div>
                </div>
                <div class="component" draggable="true" data-type="submit">
                    <div class="component-icon">âœ…</div>
                    <div>æäº¤æŒ‰é’®</div>
                </div>
            </div>
        </div>
        
        <div class="sidebar-section">
            <h3>å¸ƒå±€ç»„ä»¶</h3>
            <div class="component-list">
                <div class="component" draggable="true" data-type="row">
                    <div class="component-icon">â†”ï¸</div>
                    <div>è¡Œ</div>
                </div>
                <div class="component" draggable="true" data-type="column">
                    <div class="component-icon">â†•ï¸</div>
                    <div>åˆ—</div>
                </div>
                <div class="component" draggable="true" data-type="grid">
                    <div class="component-icon">â¹ï¸</div>
                    <div>ç½‘æ ¼</div>
                </div>
                <div class="component" draggable="true" data-type="card">
                    <div class="component-icon">ğŸƒ</div>
                    <div>å¡ç‰‡</div>
                </div>
                <div class="component" draggable="true" data-type="section">
                    <div class="component-icon">ğŸ“‘</div>
                    <div>åŒºå—</div>
                </div>
                <div class="component" draggable="true" data-type="divider">
                    <div class="component-icon">â–</div>
                    <div>åˆ†éš”çº¿</div>
                </div>
            </div>
        </div>
        
        <div class="sidebar-section">
            <h3>é«˜çº§ç»„ä»¶</h3>
            <div class="component-list">
                <div class="component" draggable="true" data-type="carousel">
                    <div class="component-icon">ğŸ–¼ï¸ğŸ”„</div>
                    <div>è½®æ’­å›¾</div>
                </div>
                <div class="component" draggable="true" data-type="accordion">
                    <div class="component-icon">ğŸ“‘ğŸ“‘</div>
                    <div>æ‰‹é£ç´</div>
                </div>
                <div class="component" draggable="true" data-type="tabs">
                    <div class="component-icon">ğŸ“‘ğŸ“‘ğŸ“‘</div>
                    <div>æ ‡ç­¾é¡µ</div>
                </div>
                <div class="component" draggable="true" data-type="modal">
                    <div class="component-icon">ğŸªŸ</div>
                    <div>æ¨¡æ€æ¡†</div>
                </div>
                <div class="component" draggable="true" data-type="navbar">
                    <div class="component-icon">ğŸ“±</div>
                    <div>å¯¼èˆªæ </div>
                </div>
                <div class="component" draggable="true" data-type="sidebar">
                    <div class="component-icon">ğŸ“š</div>
                    <div>ä¾§è¾¹æ </div>
                </div>
                <div class="component" draggable="true" data-type="footer">
                    <div class="component-icon">ğŸ”»</div>
                    <div>é¡µè„š</div>
                </div>
                <div class="component" draggable="true" data-type="map">
                    <div class="component-icon">ğŸ—ºï¸</div>
                    <div>åœ°å›¾</div>
                </div>
            </div>
        </div>
        
        <div class="sidebar-section">
            <h3>é¢„è®¾æ¨¡æ¿</h3>
            <div class="component-list">
                <div class="template-item">
                    <div class="template-preview" data-template="landing">
                        <img src="https://via.placeholder.com/200x80/3498db/ffffff?text=Landing+Page" alt="Landing Page">
                    </div>
                    <h4>è½åœ°é¡µ</h4>
                </div>
                <div class="template-item">
                    <div class="template-preview" data-template="contact">
                        <img src="https://via.placeholder.com/200x80/e74c3c/ffffff?text=Contact+Form" alt="Contact Form">
                    </div>
                    <h4>è”ç³»è¡¨å•</h4>
                </div>
                <div class="template-item">
                    <div class="template-preview" data-template="dashboard">
                        <img src="https://via.placeholder.com/200x80/2ecc71/ffffff?text=Dashboard" alt="Dashboard">
                    </div>
                    <h4>ä»ªè¡¨ç›˜</h4>
                </div>
                <div class="template-item">
                    <div class="template-preview" data-template="blog">
                        <img src="https://via.placeholder.com/200x80/9b59b6/ffffff?text=Blog+Post" alt="Blog Post">
                    </div>
                    <h4>åšå®¢æ–‡ç« </h4>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ä¸­é—´å·¥ä½œåŒº -->
    <div class="workspace">
        <div class="toolbar">
            <div class="toolbar-group">
                <div class="device-selector">
                    <button class="toolbar-btn active" data-device="desktop">PCç«¯</button>
                    <button class="toolbar-btn" data-device="mobile">ç§»åŠ¨ç«¯</button>
                    <button class="toolbar-btn" data-device="tablet">å¹³æ¿</button>
                    <button class="toolbar-btn" data-device="weapp">å°ç¨‹åº</button>
                </div>
            </div>
            
            <div class="toolbar-group">
                <button class="toolbar-btn" id="undo-btn" title="æ’¤é”€ (Ctrl+Z)">â†©ï¸ æ’¤é”€</button>
                <button class="toolbar-btn" id="redo-btn" title="é‡åš (Ctrl+Y)">â†ªï¸ é‡åš</button>
                <button class="toolbar-btn" id="clear-btn" title="æ¸…ç©ºç”»å¸ƒ">ğŸ—‘ï¸ æ¸…ç©º</button>
            </div>
            
            <div class="toolbar-group">
                <button class="toolbar-btn" id="preview-btn">ğŸ‘ï¸ é¢„è§ˆ</button>
                <button class="toolbar-btn" id="export-btn">ğŸ’¾ å¯¼å‡ºä»£ç </button>
                <input type="file" id="upload-file" accept=".html,.htm,.json" style="display: none;">
                <button class="toolbar-btn" id="upload-btn">ğŸ“¤ å¯¼å…¥</button>
                <button class="toolbar-btn" id="save-btn">ğŸ’¾ ä¿å­˜</button>
            </div>
        </div>
        
        <div class="preview-container">
            <div class="preview-frame" id="preview-frame" style="width: 100%; min-height: 100%;">
                <div class="droppable" id="canvas" style="min-height: 100%;">
                    <!-- è¿™é‡Œæ˜¯å¯æ‹–æ”¾çš„ç”»å¸ƒåŒºåŸŸ -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- å³ä¾§å±æ€§é¢æ¿ -->
    <div class="properties-panel" id="properties-panel">
        <div class="tab-container">
            <div class="tab active" data-tab="properties">å±æ€§</div>
            <div class="tab" data-tab="styles">æ ·å¼</div>
            <div class="tab" data-tab="events">äº‹ä»¶</div>
            <div class="tab" data-tab="code">ä»£ç </div>
            <div class="tab" data-tab="settings">è®¾ç½®</div>
        </div>
        
        <div id="properties-content">
            <div class="property-item">
                <label>å…ƒç´ ç±»å‹</label>
                <input type="text" id="prop-type" readonly>
            </div>
            <div class="property-item">
                <label>ID</label>
                <input type="text" id="prop-id" placeholder="å”¯ä¸€æ ‡è¯†ç¬¦">
            </div>
            <div class="property-item">
                <label>ç±»å</label>
                <input type="text" id="prop-class" placeholder="ç©ºæ ¼åˆ†éš”çš„ç±»å">
            </div>
            <div class="property-item">
                <label>æ–‡æœ¬å†…å®¹</label>
                <input type="text" id="prop-text">
            </div>
            <div class="property-item">
                <label>èƒŒæ™¯é¢œè‰²</label>
                <div class="color-picker">
                    <input type="color" id="prop-bgcolor">
                    <input type="text" id="prop-bgcolor-text" placeholder="#ffffff">
                </div>
            </div>
            <div class="property-item">
                <label>è¾¹æ¡†</label>
                <input type="text" id="prop-border" placeholder="1px solid #000">
            </div>
            <div class="property-item">
                <label>è¾¹æ¡†åŠå¾„</label>
                <input type="text" id="prop-border-radius" placeholder="4px">
            </div>
            <div class="property-item">
                <label>å¯è§æ€§</label>
                <select id="prop-visible">
                    <option value="visible">å¯è§</option>
                    <option value="hidden">éšè—</option>
                    <option value="none">ä¸æ˜¾ç¤º</option>
                </select>
            </div>
            <div class="property-item">
                <label>æ•°æ®ç»‘å®š</label>
                <input type="text" id="prop-data-bind" placeholder="æ•°æ®å­—æ®µå">
            </div>
        </div>
        
        <div id="styles-content" style="display: none;">
            <div class="property-item">
                <label>å®½åº¦</label>
                <input type="text" id="style-width" placeholder="ä¾‹å¦‚: 100px æˆ– 50%">
            </div>
            <div class="property-item">
                <label>é«˜åº¦</label>
                <input type="text" id="style-height" placeholder="ä¾‹å¦‚: 100px æˆ– 50%">
            </div>
            <div class="property-item">
                <label>ä½ç½®</label>
                <select id="style-position">
                    <option value="static">static</option>
                    <option value="relative">relative</option>
                    <option value="absolute">absolute</option>
                    <option value="fixed">fixed</option>
                    <option value="sticky">sticky</option>
                </select>
            </div>
            <div class="property-item">
                <label>ä¸Šè¾¹è·</label>
                <input type="text" id="style-top" placeholder="ä¾‹å¦‚: 10px">
            </div>
            <div class="property-item">
                <label>å·¦è¾¹è·</label>
                <input type="text" id="style-left" placeholder="ä¾‹å¦‚: 10px">
            </div>
            <div class="property-item">
                <label>å¤–è¾¹è·</label>
                <input type="text" id="style-margin" placeholder="ä¾‹å¦‚: 10px æˆ– 10px 5px">
            </div>
            <div class="property-item">
                <label>å†…è¾¹è·</label>
                <input type="text" id="style-padding" placeholder="ä¾‹å¦‚: 10px æˆ– 10px 5px">
            </div>
            <div class="property-item">
                <label>å­—ä½“å¤§å°</label>
                <input type="text" id="style-font-size" placeholder="ä¾‹å¦‚: 16px">
            </div>
            <div class="property-item">
                <label>å­—ä½“é¢œè‰²</label>
                <div class="color-picker">
                    <input type="color" id="style-color">
                    <input type="text" id="style-color-text" placeholder="#000000">
                </div>
            </div>
            <div class="property-item">
                <label>å­—ä½“ç²—ç»†</label>
                <select id="style-font-weight">
                    <option value="normal">normal</option>
                    <option value="bold">bold</option>
                    <option value="bolder">bolder</option>
                    <option value="lighter">lighter</option>
                    <option value="100">100</option>
                    <option value="200">200</option>
                    <option value="300">300</option>
                    <option value="400">400</option>
                    <option value="500">500</option>
                    <option value="600">600</option>
                    <option value="700">700</option>
                    <option value="800">800</option>
                    <option value="900">900</option>
                </select>
            </div>
            <div class="property-item">
                <label>æ–‡æœ¬å¯¹é½</label>
                <select id="style-text-align">
                    <option value="left">left</option>
                    <option value="right">right</option>
                    <option value="center">center</option>
                    <option value="justify">justify</option>
                </select>
            </div>
            <div class="property-item">
                <label>æ˜¾ç¤ºæ–¹å¼</label>
                <select id="style-display">
                    <option value="block">block</option>
                    <option value="inline">inline</option>
                    <option value="inline-block">inline-block</option>
                    <option value="flex">flex</option>
                    <option value="grid">grid</option>
                    <option value="none">none</option>
                </select>
            </div>
            <div class="property-item">
                <label>Flex æ–¹å‘</label>
                <select id="style-flex-direction">
                    <option value="row">row</option>
                    <option value="row-reverse">row-reverse</option>
                    <option value="column">column</option>
                    <option value="column-reverse">column-reverse</option>
                </select>
            </div>
            <div class="property-item">
                <label>Flex å¯¹é½</label>
                <select id="style-justify-content">
                    <option value="flex-start">flex-start</option>
                    <option value="flex-end">flex-end</option>
                    <option value="center">center</option>
                    <option value="space-between">space-between</option>
                    <option value="space-around">space-around</option>
                    <option value="space-evenly">space-evenly</option>
                </select>
            </div>
        </div>
        
        <div id="events-content" style="display: none;">
            <div class="property-item">
                <label>ç‚¹å‡»äº‹ä»¶</label>
                <select id="event-click">
                    <option value="">æ— </option>
                    <option value="alert">æ˜¾ç¤ºæç¤º</option>
                    <option value="navigate">å¯¼èˆª</option>
                    <option value="toggle">åˆ‡æ¢æ˜¾ç¤º</option>
                    <option value="submit">æäº¤è¡¨å•</option>
                    <option value="custom">è‡ªå®šä¹‰</option>
                </select>
            </div>
            <div class="property-item" id="custom-click-container" style="display: none;">
                <label>è‡ªå®šä¹‰ä»£ç </label>
                <textarea id="event-click-custom" rows="3" placeholder="function(event) { ... }"></textarea>
            </div>
            
            <div class="property-item">
                <label>é¼ æ ‡æ‚¬åœäº‹ä»¶</label>
                <select id="event-hover">
                    <option value="">æ— </option>
                    <option value="tooltip">æ˜¾ç¤ºå·¥å…·æç¤º</option>
                    <option value="highlight">é«˜äº®å…ƒç´ </option>
                    <option value="custom">è‡ªå®šä¹‰</option>
                </select>
            </div>
            <div class="property-item" id="custom-hover-container" style="display: none;">
                <label>è‡ªå®šä¹‰ä»£ç </label>
                <textarea id="event-hover-custom" rows="3" placeholder="function(event) { ... }"></textarea>
            </div>
            
            <div class="property-item">
                <label>è¾“å…¥å˜åŒ–äº‹ä»¶</label>
                <select id="event-change">
                    <option value="">æ— </option>
                    <option value="validate">éªŒè¯è¾“å…¥</option>
                    <option value="update">æ›´æ–°è§†å›¾</option>
                    <option value="custom">è‡ªå®šä¹‰</option>
                </select>
            </div>
            <div class="property-item" id="custom-change-container" style="display: none;">
                <label>è‡ªå®šä¹‰ä»£ç </label>
                <textarea id="event-change-custom" rows="3" placeholder="function(event) { ... }"></textarea>
            </div>
        </div>
        
        <div id="code-content" style="display: none;">
            <div class="property-item">
                <label>å…ƒç´ HTML</label>
                <textarea class="code-editor" id="element-html" readonly></textarea>
            </div>
            <div class="property-item">
                <label>è‡ªå®šä¹‰CSS</label>
                <textarea class="code-editor" id="element-css"></textarea>
            </div>
            <div class="property-item">
                <label>è‡ªå®šä¹‰JS</label>
                <textarea class="code-editor" id="element-js"></textarea>
            </div>
            <div class="property-item">
                <button class="toolbar-btn" id="apply-code-btn">åº”ç”¨ä»£ç </button>
            </div>
        </div>
        
        <div id="settings-content" style="display: none;">
            <div class="property-item">
                <label>ç”»å¸ƒå®½åº¦</label>
                <input type="text" id="setting-canvas-width" placeholder="ä¾‹å¦‚: 1200px">
            </div>
            <div class="property-item">
                <label>ç”»å¸ƒèƒŒæ™¯</label>
                <div class="color-picker">
                    <input type="color" id="setting-canvas-bgcolor">
                    <input type="text" id="setting-canvas-bgcolor-text" placeholder="#ffffff">
                </div>
            </div>
            <div class="property-item">
                <label>ç½‘æ ¼æ˜¾ç¤º</label>
                <select id="setting-grid-show">
                    <option value="true">æ˜¾ç¤º</option>
                    <option value="false">éšè—</option>
                </select>
            </div>
            <div class="property-item">
                <label>ç½‘æ ¼å¤§å°</label>
                <input type="number" id="setting-grid-size" placeholder="ä¾‹å¦‚: 10" value="10">
            </div>
            <div class="property-item">
                <label>ç½‘æ ¼é¢œè‰²</label>
                <div class="color-picker">
                    <input type="color" id="setting-grid-color" value="#e0e0e0">
                    <input type="text" id="setting-grid-color-text" placeholder="#e0e0e0" value="#e0e0e0">
                </div>
            </div>
            <div class="property-item">
                <label>è‡ªåŠ¨ä¿å­˜</label>
                <select id="setting-autosave">
                    <option value="true">å¯ç”¨</option>
                    <option value="false">ç¦ç”¨</option>
                </select>
            </div>
            <div class="property-item">
                <label>ä¿å­˜é—´éš”(ç§’)</label>
                <input type="number" id="setting-autosave-interval" value="30" min="5">
            </div>
            <div class="history-controls">
                <button class="toolbar-btn" id="import-settings-btn">å¯¼å…¥è®¾ç½®</button>
                <button class="toolbar-btn" id="export-settings-btn">å¯¼å‡ºè®¾ç½®</button>
            </div>
        </div>
        
        <div class="history-controls">
            <button class="toolbar-btn" id="history-btn">å†å²è®°å½•</button>
            <button class="toolbar-btn" id="collab-btn">åä½œæ¨¡å¼</button>
        </div>
    </div>

    <script>
        // å½“å‰é€‰ä¸­çš„å…ƒç´ 
        let selectedElement = null;
        // è®¾å¤‡ç±»å‹
        let currentDevice = 'desktop';
        // å†å²è®°å½•
        let historyStack = [];
        let historyIndex = -1;
        // åä½œçŠ¶æ€
        let collaborationMode = false;
        // åä½œç”¨æˆ·
        let collaborators = {};
        // ç»„ä»¶åº“
        const componentLibrary = {};
        // æ¨¡æ¿åº“
        const templateLibrary = {
            landing: {
                name: "è½åœ°é¡µ",
                html: `<div class="container" style="width: 100%; max-width: 1200px; margin: 0 auto; padding: 20px;">
    <header style="display: flex; justify-content: space-between; align-items: center; padding: 20px 0; border-bottom: 1px solid #eee;">
        <div style="font-size: 24px; font-weight: bold;">å…¬å¸Logo</div>
        <nav style="display: flex; gap: 20px;">
            <a href="#" style="text-decoration: none; color: #333;">é¦–é¡µ</a>
            <a href="#" style="text-decoration: none; color: #333;">äº§å“</a>
            <a href="#" style="text-decoration: none; color: #333;">å…³äº</a>
            <a href="#" style="text-decoration: none; color: #333;">è”ç³»</a>
        </nav>
    </header>
    
    <section style="padding: 80px 0; text-align: center;">
        <h1 style="font-size: 48px; margin-bottom: 20px;">æ¬¢è¿æ¥åˆ°æˆ‘ä»¬çš„ç½‘ç«™</h1>
        <p style="font-size: 18px; margin-bottom: 30px; max-width: 700px; margin-left: auto; margin-right: auto;">
            è¿™æ˜¯ä¸€ä¸ªç°ä»£åŒ–çš„è½åœ°é¡µæ¨¡æ¿ï¼Œæ‚¨å¯ä»¥è½»æ¾åœ°è‡ªå®šä¹‰å®ƒæ¥æ»¡è¶³æ‚¨çš„éœ€æ±‚ã€‚
        </p>
        <button style="padding: 12px 24px; background-color: #3498db; color: white; border: none; border-radius: 4px; font-size: 16px; cursor: pointer;">
            äº†è§£æ›´å¤š
        </button>
    </section>
    
    <section style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 30px; padding: 50px 0;">
        <div style="padding: 20px; border: 1px solid #eee; border-radius: 4px;">
            <h3 style="margin-bottom: 15px;">ç‰¹æ€§ä¸€</h3>
            <p>è¿™é‡Œæ˜¯ç‰¹æ€§ä¸€çš„æè¿°å†…å®¹ï¼Œè¯´æ˜è¿™ä¸ªç‰¹æ€§çš„ä¼˜åŠ¿å’Œç‰¹ç‚¹ã€‚</p>
        </div>
        <div style="padding: 20px; border: 1px solid #eee; border-radius: 4px;">
            <h3 style="margin-bottom: 15px;">ç‰¹æ€§äºŒ</h3>
            <p>è¿™é‡Œæ˜¯ç‰¹æ€§äºŒçš„æè¿°å†…å®¹ï¼Œè¯´æ˜è¿™ä¸ªç‰¹æ€§çš„ä¼˜åŠ¿å’Œç‰¹ç‚¹ã€‚</p>
        </div>
        <div style="padding: 20px; border: 1px solid #eee; border-radius: 4px;">
            <h3 style="margin-bottom: 15px;">ç‰¹æ€§ä¸‰</h3>
            <p>è¿™é‡Œæ˜¯ç‰¹æ€§ä¸‰çš„æè¿°å†…å®¹ï¼Œè¯´æ˜è¿™ä¸ªç‰¹æ€§çš„ä¼˜åŠ¿å’Œç‰¹ç‚¹ã€‚</p>
        </div>
    </section>
    
    <footer style="padding: 30px 0; text-align: center; border-top: 1px solid #eee; margin-top: 50px;">
        <p>Â© 2023 å…¬å¸åç§°. ä¿ç•™æ‰€æœ‰æƒåˆ©.</p>
    </footer>
</div>`
            },
            contact: {
                name: "è”ç³»è¡¨å•",
                html: `<div class="container" style="width: 100%; max-width: 600px; margin: 0 auto; padding: 40px 20px;">
    <h2 style="text-align: center; margin-bottom: 30px;">è”ç³»æˆ‘ä»¬</h2>
    <form style="display: grid; gap: 20px;">
        <div>
            <label style="display: block; margin-bottom: 5px; font-weight: bold;">å§“å</label>
            <input type="text" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
        </div>
        <div>
            <label style="display: block; margin-bottom: 5px; font-weight: bold;">é‚®ç®±</label>
            <input type="email" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
        </div>
        <div>
            <label style="display: block; margin-bottom: 5px; font-weight: bold;">ä¸»é¢˜</label>
            <select style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                <option>å’¨è¯¢</option>
                <option>å»ºè®®</option>
                <option>æŠ•è¯‰</option>
                <option>å…¶ä»–</option>
            </select>
        </div>
        <div>
            <label style="display: block; margin-bottom: 5px; font-weight: bold;">æ¶ˆæ¯</label>
            <textarea style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; min-height: 150px;"></textarea>
        </div>
        <button type="submit" style="padding: 12px 24px; background-color: #3498db; color: white; border: none; border-radius: 4px; font-size: 16px; cursor: pointer;">
            æäº¤
        </button>
    </form>
</div>`
            },
            dashboard: {
                name: "ä»ªè¡¨ç›˜",
                html: `<div class="container" style="width: 100%; height: 100vh; display: grid; grid-template-columns: 250px 1fr; grid-template-rows: 60px 1fr;">
    <header style="grid-column: 1 / 3; background-color: #2c3e50; color: white; display: flex; align-items: center; padding: 0 20px;">
        <h2 style="margin: 0;">ä»ªè¡¨ç›˜</h2>
    </header>
    
    <aside style="background-color: #34495e; color: white; padding: 20px;">
        <nav style="display: grid; gap: 10px;">
            <a href="#" style="color: white; text-decoration: none; padding: 10px; border-radius: 4px; background-color: #3498db;">æ¦‚è§ˆ</a>
            <a href="#" style="color: white; text-decoration: none; padding: 10px; border-radius: 4px;">åˆ†æ</a>
            <a href="#" style="color: white; text-decoration: none; padding: 10px; border-radius: 4px;">æŠ¥å‘Š</a>
            <a href="#" style="color: white; text-decoration: none; padding: 10px; border-radius: 4px;">è®¾ç½®</a>
        </nav>
    </aside>
    
    <main style="padding: 20px; background-color: #ecf0f1;">
        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px;">
            <div style="background-color: white; padding: 20px; border-radius: 4px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                <h3 style="margin-top: 0;">ç”¨æˆ·æ•°</h3>
                <p style="font-size: 24px; font-weight: bold; margin: 0;">1,234</p>
            </div>
            <div style="background-color: white; padding: 20px; border-radius: 4px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                <h3 style="margin-top: 0;">æ”¶å…¥</h3>
                <p style="font-size: 24px; font-weight: bold; margin: 0;">$12,345</p>
            </div>
            <div style="background-color: white; padding: 20px; border-radius: 4px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                <h3 style="margin-top: 0;">è½¬åŒ–ç‡</h3>
                <p style="font-size: 24px; font-weight: bold; margin: 0;">3.2%</p>
            </div>
            <div style="background-color: white; padding: 20px; border-radius: 4px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                <h3 style="margin-top: 0;">æ´»è·ƒåº¦</h3>
                <p style="font-size: 24px; font-weight: bold; margin: 0;">78%</p>
            </div>
        </div>
        
        <div style="background-color: white; padding: 20px; border-radius: 4px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 20px;">
            <h3 style="margin-top: 0;">æ•°æ®è¶‹åŠ¿</h3>
            <div style="height: 300px; background-color: #f9f9f9; display: flex; justify-content: center; align-items: center;">
                å›¾è¡¨åŒºåŸŸ
            </div>
        </div>
        
        <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 20px;">
            <div style="background-color: white; padding: 20px; border-radius: 4px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                <h3 style="margin-top: 0;">æœ€è¿‘æ´»åŠ¨</h3>
                <div style="height: 300px; overflow-y: auto;">
                    <div style="padding: 10px 0; border-bottom: 1px solid #eee;">ç”¨æˆ·A å®Œæˆäº†è®¢å• #1234</div>
                    <div style="padding: 10px 0; border-bottom: 1px solid #eee;">ç”¨æˆ·B æ³¨å†Œäº†æ–°è´¦æˆ·</div>
                    <div style="padding: 10px 0; border-bottom: 1px solid #eee;">ç³»ç»Ÿ è¿›è¡Œäº†æ—¥å¸¸å¤‡ä»½</div>
                    <div style="padding: 10px 0; border-bottom: 1px solid #eee;">ç”¨æˆ·C æäº¤äº†åé¦ˆ</div>
                    <div style="padding: 10px 0; border-bottom: 1px solid #eee;">ç®¡ç†å‘˜ æ›´æ–°äº†ç³»ç»Ÿè®¾ç½®</div>
                </div>
            </div>
            <div style="background-color: white; padding: 20px; border-radius: 4px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                <h3 style="margin-top: 0;">å¿«é€Ÿæ“ä½œ</h3>
                <div style="display: grid; gap: 10px;">
                    <button style="padding: 10px; background-color: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer;">æ·»åŠ ç”¨æˆ·</button>
                    <button style="padding: 10px; background-color: #2ecc71; color: white; border: none; border-radius: 4px; cursor: pointer;">ç”ŸæˆæŠ¥å‘Š</button>
                    <button style="padding: 10px; background-color: #e74c3c; color: white; border: none; border-radius: 4px; cursor: pointer;">å‘é€é€šçŸ¥</button>
                </div>
            </div>
        </div>
    </main>
</div>`
            },
            blog: {
                name: "åšå®¢æ–‡ç« ",
                html: `<div class="container" style="width: 100%; max-width: 800px; margin: 0 auto; padding: 40px 20px;">
    <article>
        <header style="margin-bottom: 40px;">
            <h1 style="font-size: 36px; margin-bottom: 10px;">åšå®¢æ–‡ç« æ ‡é¢˜</h1>
            <div style="display: flex; align-items: center; gap: 15px; color: #777; margin-bottom: 20px;">
                <span>ä½œè€…: å¼ ä¸‰</span>
                <span>å‘å¸ƒæ—¥æœŸ: 2023-01-01</span>
            </div>
            <img src="https://via.placeholder.com/800x400" alt="æ–‡ç« å°é¢å›¾" style="width: 100%; height: auto; border-radius: 4px;">
        </header>
        
        <div style="line-height: 1.6; font-size: 18px;">
            <p style="margin-bottom: 20px;">è¿™æ˜¯æ–‡ç« çš„å¼•è¨€éƒ¨åˆ†ï¼Œé€šå¸¸ç”¨æ¥æ¦‚è¿°æ–‡ç« çš„ä¸»è¦å†…å®¹ï¼Œå¸å¼•è¯»è€…ç»§ç»­é˜…è¯»ã€‚</p>
            
            <h2 style="margin-top: 40px; margin-bottom: 20px;">ç¬¬ä¸€éƒ¨åˆ†æ ‡é¢˜</h2>
            <p style="margin-bottom: 20px;">è¿™æ˜¯ç¬¬ä¸€éƒ¨åˆ†çš„å†…å®¹ã€‚åšå®¢æ–‡ç« é€šå¸¸åŒ…å«å¤šä¸ªéƒ¨åˆ†ï¼Œæ¯ä¸ªéƒ¨åˆ†è®¨è®ºä¸€ä¸ªç‰¹å®šçš„ä¸»é¢˜æˆ–è§‚ç‚¹ã€‚</p>
            
            <h2 style="margin-top: 40px; margin-bottom: 20px;">ç¬¬äºŒéƒ¨åˆ†æ ‡é¢˜</h2>
            <p style="margin-bottom: 20px;">è¿™æ˜¯ç¬¬äºŒéƒ¨åˆ†çš„å†…å®¹ã€‚å¯ä»¥ä½¿ç”¨å›¾ç‰‡ã€åˆ—è¡¨ã€å¼•ç”¨ç­‰å…ƒç´ æ¥ä¸°å¯Œæ–‡ç« å†…å®¹ã€‚</p>
            
            <blockquote style="border-left: 4px solid #3498db; padding-left: 15px; margin: 20px 0; color: #555;">
                è¿™æ˜¯ä¸€ä¸ªå¼•ç”¨ç¤ºä¾‹ï¼Œå¯ä»¥ç”¨æ¥çªå‡ºæ˜¾ç¤ºé‡è¦çš„è§‚ç‚¹æˆ–ä»–äººçš„è¨€è®ºã€‚
            </blockquote>
            
            <h2 style="margin-top: 40px; margin-bottom: 20px;">ç¬¬ä¸‰éƒ¨åˆ†æ ‡é¢˜</h2>
            <p style="margin-bottom: 20px;">è¿™æ˜¯ç¬¬ä¸‰éƒ¨åˆ†çš„å†…å®¹ã€‚æ–‡ç« çš„æœ€åé€šå¸¸åŒ…å«æ€»ç»“æˆ–ç»“è®ºã€‚</p>
            
            <ul style="margin-bottom: 20px; padding-left: 20px;">
                <li>åˆ—è¡¨é¡¹ä¸€</li>
                <li>åˆ—è¡¨é¡¹äºŒ</li>
                <li>åˆ—è¡¨é¡¹ä¸‰</li>
            </ul>
            
            <p style="margin-bottom: 20px;">æ–‡ç« çš„ç»“å°¾éƒ¨åˆ†ï¼Œå¯ä»¥æ€»ç»“ä¸»è¦è§‚ç‚¹æˆ–æå‡ºé—®é¢˜ä¾›è¯»è€…æ€è€ƒã€‚</p>
        </div>
        
        <footer style="margin-top: 50px; padding-top: 20px; border-top: 1px solid #eee;">
            <div style="display: flex; gap: 15px; margin-bottom: 20px;">
                <span>æ ‡ç­¾: </span>
                <a href="#" style="color: #3498db; text-decoration: none;">æŠ€æœ¯</a>
                <a href="#" style="color: #3498db; text-decoration: none;">è®¾è®¡</a>
                <a href="#" style="color: #3498db; text-decoration: none;">å¼€å‘</a>
            </div>
            
            <div style="display: flex; justify-content: space-between;">
                <button style="padding: 8px 16px; background-color: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer;">ä¸Šä¸€ç¯‡</button>
                <button style="padding: 8px 16px; background-color: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer;">ä¸‹ä¸€ç¯‡</button>
            </div>
        </footer>
    </article>
    
    <section style="margin-top: 60px;">
        <h3 style="margin-bottom: 20px;">è¯„è®º (3)</h3>
        
        <div style="margin-bottom: 30px; padding-bottom: 30px; border-bottom: 1px solid #eee;">
            <div style="display: flex; gap: 15px; margin-bottom: 10px;">
                <img src="https://via.placeholder.com/50" alt="ç”¨æˆ·å¤´åƒ" style="width: 50px; height: 50px; border-radius: 50%;">
                <div>
                    <div style="font-weight: bold;">æå››</div>
                    <div style="color: #777; font-size: 14px;">2023-01-02 10:30</div>
                </div>
            </div>
            <p>è¿™æ˜¯ä¸€æ¡è¯„è®ºå†…å®¹ã€‚è¯»è€…å¯ä»¥åœ¨è¿™é‡Œåˆ†äº«ä»–ä»¬çš„æƒ³æ³•å’Œåé¦ˆã€‚</p>
        </div>
        
        <form style="margin-top: 40px;">
            <h3 style="margin-bottom: 20px;">å‘è¡¨è¯„è®º</h3>
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px;">å§“å</label>
                <input type="text" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
            </div>
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px;">é‚®ç®±</label>
                <input type="email" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
            </div>
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px;">è¯„è®º</label>
                <textarea style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; min-height: 120px;"></textarea>
            </div>
            <button type="submit" style="padding: 10px 20px; background-color: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer;">æäº¤è¯„è®º</button>
        </form>
    </section>
</div>`
            }
        };
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // æ‹–æ‹½ç›¸å…³äº‹ä»¶
            setupDragAndDrop();
            
            // è®¾å¤‡åˆ‡æ¢
            setupDeviceSwitcher();
            
            // æŒ‰é’®äº‹ä»¶
            setupButtons();
            
            // å±æ€§é¢æ¿æ ‡ç­¾åˆ‡æ¢
            setupPropertyTabs();
            
            // å…ƒç´ é€‰æ‹©
            setupElementSelection();
            
            // åˆå§‹åŒ–å†å²è®°å½•
            saveHistory();
            
            // ä¾§è¾¹æ æŠ˜å 
            setupSidebarSections();
            
            // ç»„ä»¶æœç´¢
            setupComponentSearch();
            
            // æ¨¡æ¿ç‚¹å‡»
            setupTemplateClick();
            
            // å¿«æ·é”®
            setupKeyboardShortcuts();
            
            // åˆå§‹åŒ–è®¾ç½®
            loadSettings();
            
            // è®¾ç½®å…ƒç´ æ‹–åŠ¨
            setupElementDragging();
        });
        
        // è®¾ç½®æ‹–æ‹½åŠŸèƒ½
        function setupDragAndDrop() {
            const components = document.querySelectorAll('.component[draggable="true"]');
            const canvas = document.getElementById('canvas');
            
            // ä¸ºæ¯ä¸ªç»„ä»¶æ·»åŠ æ‹–æ‹½å¼€å§‹äº‹ä»¶
            components.forEach(component => {
                component.addEventListener('dragstart', function(e) {
                    e.dataTransfer.setData('text/plain', this.getAttribute('data-type'));
                    e.dataTransfer.effectAllowed = 'copy';
                });
            });
            
            // ç”»å¸ƒæ‹–æ‹½ç›¸å…³äº‹ä»¶
            canvas.addEventListener('dragover', function(e) {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'copy';
                this.style.borderColor = '#3498db';
            });
            
            canvas.addEventListener('dragleave', function() {
                this.style.borderColor = '#7f8c8d';
            });
            
            canvas.addEventListener('drop', function(e) {
                e.preventDefault();
                this.style.borderColor = '#7f8c8d';
                
                const componentType = e.dataTransfer.getData('text/plain');
                if (!componentType) return;
                
                createNewElement(componentType, e.clientX, e.clientY);
            });
        }
        
        // è®¾ç½®å…ƒç´ æ‹–åŠ¨åŠŸèƒ½
        function setupElementDragging() {
            const canvas = document.getElementById('canvas');
            let draggedElement = null;
            let offsetX = 0;
            let offsetY = 0;
            
            canvas.addEventListener('mousedown', function(e) {
                let target = e.target;
                
                // å‘ä¸ŠæŸ¥æ‰¾.elementå…ƒç´ 
                while (target && !target.classList.contains('element') && target !== this) {
                    target = target.parentElement;
                }
                
                if (target && target.classList.contains('element')) {
                    // é˜»æ­¢å†’æ³¡ï¼Œé¿å…ä¸é€‰æ‹©å…ƒç´ å†²çª
                    e.stopPropagation();
                    
                    draggedElement = target;
                    const rect = target.getBoundingClientRect();
                    offsetX = e.clientX - rect.left;
                    offsetY = e.clientY - rect.top;
                    
                    // è®¾ç½®å…ƒç´ æ ·å¼
                    draggedElement.style.cursor = 'grabbing';
                    draggedElement.style.zIndex = '1000';
                }
            });
            
            document.addEventListener('mousemove', function(e) {
                if (draggedElement) {
                    draggedElement.style.left = (e.clientX - offsetX) + 'px';
                    draggedElement.style.top = (e.clientY - offsetY) + 'px';
                }
            });
            
            document.addEventListener('mouseup', function() {
                if (draggedElement) {
                    draggedElement.style.cursor = 'move';
                    draggedElement.style.zIndex = '';
                    draggedElement = null;
                    saveHistory();
                }
            });
        }
        
        // åˆ›å»ºæ–°å…ƒç´ 
        function createNewElement(type, x, y) {
            const canvas = document.getElementById('canvas');
            const rect = canvas.getBoundingClientRect();
            const relativeX = x - rect.left;
            const relativeY = y - rect.top;
            
            const element = document.createElement('div');
            element.className = 'element';
            element.setAttribute('data-type', type);
            
            // æ ¹æ®ç±»å‹è®¾ç½®ä¸åŒçš„åˆå§‹å†…å®¹
            switch(type) {
                case 'container':
                    element.innerHTML = '<div class="droppable" style="min-height: 100px; background-color: #f5f5f5;">å®¹å™¨</div>';
                    break;
                case 'text':
                    element.textContent = 'åŒå‡»ç¼–è¾‘æ–‡æœ¬';
                    element.style.padding = '10px';
                    element.style.backgroundColor = 'transparent';
                    break;
                case 'button':
                    element.innerHTML = '<button style="padding: 8px 16px; background-color: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer;">æŒ‰é’®</button>';
                    element.style.backgroundColor = 'transparent';
                    break;
                case 'image':
                    element.innerHTML = '<img src="https://via.placeholder.com/150" alt="å›¾ç‰‡" style="max-width: 100%; display: block;">';
                    element.style.backgroundColor = 'transparent';
                    break;
                case 'input':
                    element.innerHTML = '<input type="text" placeholder="è¾“å…¥æ¡†" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px; width: 100%;">';
                    element.style.backgroundColor = 'transparent';
                    break;
                case 'textarea':
                    element.innerHTML = '<textarea placeholder="å¤šè¡Œæ–‡æœ¬" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px; width: 100%; min-height: 100px;"></textarea>';
                    element.style.backgroundColor = 'transparent';
                    break;
                case 'video':
                    element.innerHTML = '<div style="background-color: #000; width: 100%; height: 200px; display: flex; justify-content: center; align-items: center; color: white;">è§†é¢‘æ’­æ”¾å™¨</div>';
                    break;
                case 'audio':
                    element.innerHTML = '<div style="background-color: #f5f5f5; width: 100%; padding: 15px; border-radius: 4px; text-align: center;">éŸ³é¢‘æ’­æ”¾å™¨</div>';
                    break;
                case 'form':
                    element.innerHTML = '<form style="display: grid; gap: 15px; padding: 15px; background-color: #f5f5f5; border-radius: 4px;"><input type="text" placeholder="å§“å"><input type="email" placeholder="é‚®ç®±"><button type="submit" style="padding: 8px 16px; background-color: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer;">æäº¤</button></form>';
                    break;
                case 'checkbox':
                    element.innerHTML = '<label style="display: flex; align-items: center; gap: 8px;"><input type="checkbox"> å¤é€‰æ¡†</label>';
                    element.style.backgroundColor = 'transparent';
                    break;
                case 'radio':
                    element.innerHTML = '<label style="display: flex; align-items: center; gap: 8px;"><input type="radio" name="radio-group"> å•é€‰æŒ‰é’®</label>';
                    element.style.backgroundColor = 'transparent';
                    break;
                case 'select':
                    element.innerHTML = '<select style="padding: 8px; border: 1px solid #ddd; border-radius: 4px; width: 100%;"><option>é€‰é¡¹1</option><option>é€‰é¡¹2</option><option>é€‰é¡¹3</option></select>';
                    element.style.backgroundColor = 'transparent';
                    break;
                case 'range':
                    element.innerHTML = '<div style="display: grid; gap: 5px;"><input type="range" style="width: 100%;"><div style="display: flex; justify-content: space-between;"><span>0</span><span>100</span></div></div>';
                    element.style.backgroundColor = 'transparent';
                    break;
                case 'date':
                    element.innerHTML = '<input type="date" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px; width: 100%;">';
                    element.style.backgroundColor = 'transparent';
                    break;
                case 'file':
                    element.innerHTML = '<div style="border: 2px dashed #ddd; padding: 20px; text-align: center; border-radius: 4px;"><div>ç‚¹å‡»æˆ–æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„</div><input type="file" style="display: none;"></div>';
                    element.style.backgroundColor = 'transparent';
                    break;
                case 'submit':
                    element.innerHTML = '<button type="submit" style="padding: 10px 20px; background-color: #2ecc71; color: white; border: none; border-radius: 4px; cursor: pointer; width: 100%;">æäº¤</button>';
                    element.style.backgroundColor = 'transparent';
                    break;
                case 'row':
                    element.innerHTML = '<div class="droppable" style="display: flex; min-height: 50px; background-color: #f5f5f5; gap: 10px; padding: 10px;">è¡Œå¸ƒå±€</div>';
                    break;
                case 'column':
                    element.innerHTML = '<div class="droppable" style="display: flex; flex-direction: column; min-height: 50px; background-color: #f5f5f5; gap: 10px; padding: 10px;">åˆ—å¸ƒå±€</div>';
                    break;
                case 'grid':
                    element.innerHTML = '<div class="droppable" style="display: grid; grid-template-columns: repeat(2, 1fr); min-height: 50px; background-color: #f5f5f5; gap: 10px; padding: 10px;">ç½‘æ ¼å¸ƒå±€</div>';
                    break;
                case 'card':
                    element.innerHTML = '<div style="border: 1px solid #eee; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 4px rgba(0,0,0,0.1);"><img src="https://via.placeholder.com/300x200" alt="å¡ç‰‡å›¾ç‰‡" style="width: 100%; height: auto; display: block;"><div style="padding: 15px;"><h3 style="margin-top: 0;">å¡ç‰‡æ ‡é¢˜</h3><p style="margin-bottom: 0;">å¡ç‰‡å†…å®¹æè¿°</p></div></div>';
                    break;
                case 'section':
                    element.innerHTML = '<div class="droppable" style="min-height: 100px; background-color: #f5f5f5; padding: 20px;">åŒºå—</div>';
                    break;
                case 'divider':
                    element.innerHTML = '<hr style="border: none; border-top: 1px solid #ddd; margin: 20px 0;">';
                    element.style.backgroundColor = 'transparent';
                    element.style.padding = '0';
                    break;
                case 'carousel':
                    element.innerHTML = '<div class="carousel" style="width: 100%; height: 200px; background: #ddd; display: flex; justify-content: center; align-items: center; position: relative; overflow: hidden;"><div style="position: absolute; width: 100%; height: 100%; display: flex; transition: transform 0.5s;"><div style="min-width: 100%; background: #3498db; display: flex; justify-content: center; align-items: center; color: white;">å¹»ç¯ç‰‡1</div><div style="min-width: 100%; background: #e74c3c; display: flex; justify-content: center; align-items: center; color: white;">å¹»ç¯ç‰‡2</div><div style="min-width: 100%; background: #2ecc71; display: flex; justify-content: center; align-items: center; color: white;">å¹»ç¯ç‰‡3</div></div><button style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%); background: rgba(0,0,0,0.5); color: white; border: none; width: 30px; height: 30px; border-radius: 50%; cursor: pointer;">â®</button><button style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: rgba(0,0,0,0.5); color: white; border: none; width: 30px; height: 30px; border-radius: 50%; cursor: pointer;">â¯</button></div>';
                    break;
                case 'accordion':
                    element.innerHTML = '<div class="accordion" style="width: 100%;"><div class="accordion-item" style="margin-bottom: 5px;"><div style="background: #eee; padding: 10px; cursor: pointer;">æ ‡é¢˜1</div><div style="padding: 10px; background: #f9f9f9; display: none;">å†…å®¹1</div></div><div class="accordion-item" style="margin-bottom: 5px;"><div style="background: #eee; padding: 10px; cursor: pointer;">æ ‡é¢˜2</div><div style="padding: 10px; background: #f9f9f9; display: none;">å†…å®¹2</div></div></div>';
                    break;
                case 'tabs':
                    element.innerHTML = '<div class="tabs" style="width: 100%;"><div style="display: flex; border-bottom: 1px solid #ddd;"><div style="padding: 10px; border: 1px solid #ddd; border-bottom: none; margin-right: 5px; cursor: pointer; background: #f5f5f5;">æ ‡ç­¾1</div><div style="padding: 10px; border: 1px solid #ddd; border-bottom: none; cursor: pointer; background: #f5f5f5;">æ ‡ç­¾2</div></div><div style="padding: 15px; border: 1px solid #ddd; border-top: none; background: white;">æ ‡ç­¾å†…å®¹1</div></div>';
                    break;
                case 'modal':
                    element.innerHTML = '<div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; justify-content: center; align-items: center; z-index: 1000; display: none;"><div style="background: white; padding: 20px; border-radius: 4px; max-width: 500px; width: 100%;"><h3 style="margin-top: 0;">æ¨¡æ€æ¡†æ ‡é¢˜</h3><p>æ¨¡æ€æ¡†å†…å®¹</p><button style="padding: 8px 16px; background: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer;">å…³é—­</button></div></div><button style="padding: 8px 16px; background: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer;">æ‰“å¼€æ¨¡æ€æ¡†</button>';
                    element.style.position = 'relative';
                    break;
                case 'navbar':
                    element.innerHTML = '<nav style="display: flex; justify-content: space-between; align-items: center; padding: 15px; background-color: #2c3e50; color: white;"><div style="font-size: 1.2em; font-weight: bold;">Logo</div><div style="display: flex; gap: 20px;"><a href="#" style="color: white; text-decoration: none;">é¦–é¡µ</a><a href="#" style="color: white; text-decoration: none;">äº§å“</a><a href="#" style="color: white; text-decoration: none;">å…³äº</a></div></nav>';
                    element.style.width = '100%';
                    break;
                case 'sidebar':
                    element.innerHTML = '<aside style="width: 250px; height: 100vh; background-color: #34495e; color: white; padding: 20px;"><nav style="display: grid; gap: 10px;"><a href="#" style="color: white; text-decoration: none; padding: 10px; border-radius: 4px;">èœå•é¡¹1</a><a href="#" style="color: white; text-decoration: none; padding: 10px; border-radius: 4px;">èœå•é¡¹2</a><a href="#" style="color: white; text-decoration: none; padding: 10px; border-radius: 4px;">èœå•é¡¹3</a></nav></aside>';
                    break;
                case 'footer':
                    element.innerHTML = '<footer style="padding: 30px; background-color: #2c3e50; color: white; text-align: center;"><p>Â© 2023 å…¬å¸åç§°. ä¿ç•™æ‰€æœ‰æƒåˆ©.</p></footer>';
                    element.style.width = '100%';
                    break;
                case 'map':
                    element.innerHTML = '<div style="width: 100%; height: 300px; background-color: #ddd; display: flex; justify-content: center; align-items: center;">åœ°å›¾ç»„ä»¶</div>';
                    break;
                case 'progress':
                    element.innerHTML = '<div style="width: 100%;"><div style="width: 50%; height: 20px; background-color: #3498db; border-radius: 10px; display: flex; justify-content: center; align-items: center; color: white; font-size: 12px;">50%</div></div>';
                    element.style.backgroundColor = 'transparent';
                    break;
                case 'table':
                    element.innerHTML = '<table style="width: 100%; border-collapse: collapse;"><thead><tr><th style="border: 1px solid #ddd; padding: 8px; text-align: left; background-color: #f2f2f2;">æ ‡é¢˜1</th><th style="border: 1px solid #ddd; padding: 8px; text-align: left; background-color: #f2f2f2;">æ ‡é¢˜2</th></tr></thead><tbody><tr><td style="border: 1px solid #ddd; padding: 8px;">å†…å®¹1</td><td style="border: 1px solid #ddd; padding: 8px;">å†…å®¹2</td></tr><tr><td style="border: 1px solid #ddd; padding: 8px;">å†…å®¹3</td><td style="border: 1px solid #ddd; padding: 8px;">å†…å®¹4</td></tr></tbody></table>';
                    element.style.backgroundColor = 'transparent';
                    break;
                default:
                    element.textContent = 'æ–°å…ƒç´ ';
            }
            
            // æ·»åŠ å…ƒç´ å·¥å…·æ 
            const toolbar = document.createElement('div');
            toolbar.className = 'element-toolbar';
            toolbar.innerHTML = `
                <button class="edit-btn" title="ç¼–è¾‘">âœï¸</button>
                <button class="delete-btn" title="åˆ é™¤">ğŸ—‘ï¸</button>
                <button class="copy-btn" title="å¤åˆ¶">â˜</button>
                <button class="move-up-btn" title="ä¸Šç§»">â†‘</button>
                <button class="move-down-btn" title="ä¸‹ç§»">â†“</button>
            `;
            element.appendChild(toolbar);
            
            // è®¾ç½®å…ƒç´ ä½ç½®
            element.style.position = 'absolute';
            element.style.left = relativeX + 'px';
            element.style.top = relativeY + 'px';
            
            // æ·»åŠ åˆ°ç”»å¸ƒ
            canvas.appendChild(element);
            
            // é€‰ä¸­æ–°åˆ›å»ºçš„å…ƒç´ 
            selectElement(element);
            
            // ä¸ºåµŒå¥—çš„å¯æ‹–æ”¾åŒºåŸŸè®¾ç½®äº‹ä»¶
            const nestedDroppables = element.querySelectorAll('.droppable');
            nestedDroppables.forEach(droppable => {
                setupNestedDroppable(droppable);
            });
            
            // ä¿å­˜å†å²çŠ¶æ€
            saveHistory();
            
            // åŒå‡»ç¼–è¾‘æ–‡æœ¬
            if (type === 'text') {
                element.addEventListener('dblclick', function() {
                    const newText = prompt('ç¼–è¾‘æ–‡æœ¬:', this.textContent);
                    if (newText !== null) {
                        this.textContent = newText;
                        updatePropertiesPanel();
                        saveHistory();
                    }
                });
            }
        }
        
        // è®¾ç½®åµŒå¥—çš„å¯æ‹–æ”¾åŒºåŸŸ
        function setupNestedDroppable(droppable) {
            droppable.addEventListener('dragover', function(e) {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'copy';
                this.style.borderColor = '#3498db';
            });
            
            droppable.addEventListener('dragleave', function() {
                this.style.borderColor = '#7f8c8d';
            });
            
            droppable.addEventListener('drop', function(e) {
                e.preventDefault();
                this.style.borderColor = '#7f8c8d';
                
                const componentType = e.dataTransfer.getData('text/plain');
                if (!componentType) return;
                
                createNewElement(componentType, e.clientX, e.clientY);
            });
        }
        
        // è®¾ç½®è®¾å¤‡åˆ‡æ¢
        function setupDeviceSwitcher() {
            const deviceBtns = document.querySelectorAll('.toolbar-btn[data-device]');
            const previewFrame = document.getElementById('preview-frame');
            
            deviceBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    deviceBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    currentDevice = this.getAttribute('data-device');
                    
                    switch(currentDevice) {
                        case 'desktop':
                            previewFrame.style.width = '100%';
                            previewFrame.style.maxWidth = 'none';
                            break;
                        case 'mobile':
                            previewFrame.style.width = '375px';
                            previewFrame.style.maxWidth = '100%';
                            break;
                        case 'tablet':
                            previewFrame.style.width = '768px';
                            previewFrame.style.maxWidth = '100%';
                            break;
                        case 'weapp':
                            previewFrame.style.width = '414px';
                            previewFrame.style.maxWidth = '100%';
                            break;
                    }
                    
                    saveSettings();
                });
            });
        }
        
        // è®¾ç½®æŒ‰é’®äº‹ä»¶
        function setupButtons() {
            // é¢„è§ˆæŒ‰é’®
            document.getElementById('preview-btn').addEventListener('click', function() {
                const html = generateHTML();
                const previewWindow = window.open('', '_blank');
                previewWindow.document.write(html);
                previewWindow.document.close();
            });
            
            // å¯¼å‡ºä»£ç æŒ‰é’®
            document.getElementById('export-btn').addEventListener('click', function() {
                const html = generateHTML();
                const blob = new Blob([html], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'exported-page.html';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            });
            
            // ä¸Šä¼ HTMLæŒ‰é’®
            document.getElementById('upload-btn').addEventListener('click', function() {
                document.getElementById('upload-file').click();
            });
            
            // æ–‡ä»¶ä¸Šä¼ å¤„ç†
            document.getElementById('upload-file').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(event) {
                    if (file.name.endsWith('.json')) {
                        try {
                            const data = JSON.parse(event.target.result);
                            loadFromJSON(data);
                        } catch (error) {
                            alert('è§£æJSONæ–‡ä»¶å¤±è´¥: ' + error.message);
                        }
                    } else {
                        parseHTML(event.target.result);
                    }
                };
                reader.readAsText(file);
                
                // é‡ç½®æ–‡ä»¶è¾“å…¥ï¼Œå…è®¸é‡å¤ä¸Šä¼ åŒä¸€æ–‡ä»¶
                e.target.value = '';
            });
            
            // ä¿å­˜æŒ‰é’®
            document.getElementById('save-btn').addEventListener('click', function() {
                const data = {
                    elements: getCanvasData(),
                    settings: getCurrentSettings(),
                    version: '1.0',
                    savedAt: new Date().toISOString()
                };
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'design-' + new Date().toISOString().slice(0, 10) + '.json';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            });
            
            // æ’¤é”€æŒ‰é’®
            document.getElementById('undo-btn').addEventListener('click', undo);
            
            // é‡åšæŒ‰é’®
            document.getElementById('redo-btn').addEventListener('click', redo);
            
            // æ¸…ç©ºæŒ‰é’®
            document.getElementById('clear-btn').addEventListener('click', function() {
                if (confirm('ç¡®å®šè¦æ¸…ç©ºç”»å¸ƒå—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼')) {
                    document.getElementById('canvas').innerHTML = '';
                    selectedElement = null;
                    clearPropertiesPanel();
                    saveHistory();
                }
            });
            
            // åº”ç”¨ä»£ç æŒ‰é’®
            document.getElementById('apply-code-btn').addEventListener('click', function() {
                if (!selectedElement) return;
                
                try {
                    const css = document.getElementById('element-css').value;
                    const js = document.getElementById('element-js').value;
                    
                    // åº”ç”¨CSS
                    if (css.trim()) {
                        const styleId = 'element-style-' + (selectedElement.id || Math.random().toString(36).substr(2, 8));
                        let styleElement = document.getElementById(styleId);
                        if (!styleElement) {
                            styleElement = document.createElement('style');
                            styleElement.id = styleId;
                            document.head.appendChild(styleElement);
                        }
                        styleElement.textContent = `#${selectedElement.id} { ${css} }`;
                    }
                    
                    // åº”ç”¨JS
                    if (js.trim()) {
                        const scriptId = 'element-script-' + (selectedElement.id || Math.random().toString(36).substr(2, 8));
                        let scriptElement = document.getElementById(scriptId);
                        if (scriptElement) {
                            scriptElement.remove();
                        }
                        scriptElement = document.createElement('script');
                        scriptElement.id = scriptId;
                        scriptElement.textContent = `(function() { ${js} })();`;
                        document.body.appendChild(scriptElement);
                    }
                    
                    alert('ä»£ç åº”ç”¨æˆåŠŸï¼');
                    saveHistory();
                } catch (error) {
                    alert('åº”ç”¨ä»£ç æ—¶å‡ºé”™: ' + error.message);
                }
            });
            
            // å†å²è®°å½•æŒ‰é’®
            document.getElementById('history-btn').addEventListener('click', function() {
                alert('å†å²è®°å½•åŠŸèƒ½: å½“å‰ç‰ˆæœ¬ ' + historyIndex + '/' + (historyStack.length - 1));
            });
            
            // åä½œæ¨¡å¼æŒ‰é’®
            document.getElementById('collab-btn').addEventListener('click', function() {
                collaborationMode = !collaborationMode;
                this.classList.toggle('active');
                if (collaborationMode) {
                    alert('åä½œæ¨¡å¼å·²å¯ç”¨');
                    // å®é™…å®ç°ä¸­ï¼Œè¿™é‡Œä¼šè¿æ¥åˆ°WebSocketæœåŠ¡å™¨
                } else {
                    alert('åä½œæ¨¡å¼å·²ç¦ç”¨');
                    // å®é™…å®ç°ä¸­ï¼Œè¿™é‡Œä¼šæ–­å¼€WebSocketè¿æ¥
                }
            });
            
            // å¯¼å…¥è®¾ç½®æŒ‰é’®
            document.getElementById('import-settings-btn').addEventListener('click', function() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                input.onchange = e => {
                    const file = e.target.files[0];
                    if (!file) return;
                    
                    const reader = new FileReader();
                    reader.onload = event => {
                        try {
                            const settings = JSON.parse(event.target.result);
                            applySettings(settings);
                            alert('è®¾ç½®å¯¼å…¥æˆåŠŸï¼');
                        } catch (error) {
                            alert('å¯¼å…¥è®¾ç½®å¤±è´¥: ' + error.message);
                        }
                    };
                    reader.readAsText(file);
                };
                input.click();
            });
            
            // å¯¼å‡ºè®¾ç½®æŒ‰é’®
            document.getElementById('export-settings-btn').addEventListener('click', function() {
                const settings = getCurrentSettings();
                const blob = new Blob([JSON.stringify(settings, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'editor-settings.json';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            });
        }
        
        // è§£æä¸Šä¼ çš„HTML
        function parseHTML(html) {
            // æ¸…ç©ºå½“å‰ç”»å¸ƒ
            document.getElementById('canvas').innerHTML = '';
            
            // åˆ›å»ºä¸€ä¸ªä¸´æ—¶DOMæ¥è§£æHTML
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            
            // æ›´å¤æ‚çš„è§£æé€»è¾‘ï¼Œå°†HTMLå…ƒç´ è½¬æ¢ä¸ºç¼–è¾‘å™¨ä¸­çš„ç»„ä»¶
            const body = doc.body;
            convertHTMLToElements(body, document.getElementById('canvas'));
            
            alert('HTMLå·²è§£æå¹¶åŠ è½½åˆ°ç¼–è¾‘å™¨ä¸­');
            saveHistory();
        }
        
        // é€’å½’è½¬æ¢HTMLå…ƒç´ ä¸ºç¼–è¾‘å™¨å…ƒç´ 
        function convertHTMLToElements(sourceElement, targetElement) {
            Array.from(sourceElement.children).forEach(child => {
                let elementType = 'container';
                let elementContent = child.outerHTML;
                
                // æ ¹æ®å…ƒç´ ç±»å‹ç¡®å®šç¼–è¾‘å™¨ä¸­çš„ç»„ä»¶ç±»å‹
                if (child.tagName === 'DIV' && child.className.includes('container')) {
                    elementType = 'container';
                } else if (child.tagName === 'P' || child.tagName === 'SPAN' || child.tagName === 'H1' || child.tagName === 'H2' || child.tagName === 'H3' || child.tagName === 'H4' || child.tagName === 'H5' || child.tagName === 'H6') {
                    elementType = 'text';
                    elementContent = child.textContent;
                } else if (child.tagName === 'BUTTON') {
                    elementType = 'button';
                } else if (child.tagName === 'IMG') {
                    elementType = 'image';
                } else if (child.tagName === 'INPUT') {
                    if (child.type === 'text' || child.type === 'email' || child.type === 'password') {
                        elementType = 'input';
                    } else if (child.type === 'checkbox') {
                        elementType = 'checkbox';
                    } else if (child.type === 'radio') {
                        elementType = 'radio';
                    } else if (child.type === 'range') {
                        elementType = 'range';
                    } else if (child.type === 'date') {
                        elementType = 'date';
                    } else if (child.type === 'file') {
                        elementType = 'file';
                    } else if (child.type === 'submit') {
                        elementType = 'submit';
                    }
                } else if (child.tagName === 'TEXTAREA') {
                    elementType = 'textarea';
                } else if (child.tagName === 'SELECT') {
                    elementType = 'select';
                } else if (child.tagName === 'FORM') {
                    elementType = 'form';
                } else if (child.tagName === 'VIDEO') {
                    elementType = 'video';
                } else if (child.tagName === 'AUDIO') {
                    elementType = 'audio';
                } else if (child.tagName === 'NAV') {
                    elementType = 'navbar';
                } else if (child.tagName === 'FOOTER') {
                    elementType = 'footer';
                } else if (child.tagName === 'ASIDE') {
                    elementType = 'sidebar';
                } else if (child.tagName === 'UL' || child.tagName === 'OL') {
                    elementType = 'container';
                } else if (child.tagName === 'TABLE') {
                    elementType = 'table';
                } else if (child.tagName === 'PROGRESS') {
                    elementType = 'progress';
                }
                
                // åˆ›å»ºç¼–è¾‘å™¨å…ƒç´ 
                const element = document.createElement('div');
                element.className = 'element';
                element.setAttribute('data-type', elementType);
                
                if (elementType === 'text') {
                    element.textContent = elementContent;
                } else {
                    element.innerHTML = elementContent;
                }
                
                // å¤åˆ¶æ ·å¼
                const style = window.getComputedStyle(child);
                for (let i = 0; i < style.length; i++) {
                    const property = style[i];
                    element.style[property] = style[property];
                }
                
                // å¤åˆ¶å±æ€§
                Array.from(child.attributes).forEach(attr => {
                    if (attr.name !== 'style') {
                        element.setAttribute(attr.name, attr.value);
                    }
                });
                
                // æ·»åŠ åˆ°ç”»å¸ƒ
                targetElement.appendChild(element);
                
                // å¤„ç†å­å…ƒç´ 
                if (child.children.length > 0 && elementType !== 'text') {
                    const container = element.querySelector('.droppable') || element;
                    convertHTMLToElements(child, container);
                }
                
                // æ·»åŠ å…ƒç´ å·¥å…·æ 
                const toolbar = document.createElement('div');
                toolbar.className = 'element-toolbar';
                toolbar.innerHTML = `
                    <button class="edit-btn" title="ç¼–è¾‘">âœï¸</button>
                    <button class="delete-btn" title="åˆ é™¤">ğŸ—‘ï¸</button>
                    <button class="copy-btn" title="å¤åˆ¶">â˜</button>
                    <button class="move-up-btn" title="ä¸Šç§»">â†‘</button>
                    <button class="move-down-btn" title="ä¸‹ç§»">â†“</button>
                `;
                element.appendChild(toolbar);
            });
        }
        
        // ä»JSONåŠ è½½è®¾è®¡
        function loadFromJSON(data) {
            if (data.elements) {
                document.getElementById('canvas').innerHTML = '';
                loadElementsFromData(data.elements, document.getElementById('canvas'));
            }
            
            if (data.settings) {
                applySettings(data.settings);
            }
            
            alert('è®¾è®¡å·²åŠ è½½ï¼');
            saveHistory();
        }
        
        // ä»æ•°æ®åŠ è½½å…ƒç´ 
        function loadElementsFromData(elementsData, parentElement) {
            elementsData.forEach(elementData => {
                const element = document.createElement('div');
                element.className = 'element';
                element.setAttribute('data-type', elementData.type || 'container');
                
                // è®¾ç½®ä½ç½®å’Œå†…å®¹
                if (elementData.type === 'text') {
                    element.textContent = elementData.content || '';
                } else {
                    element.innerHTML = elementData.html || '<div class="droppable">å®¹å™¨</div>';
                }
                
                // è®¾ç½®æ ·å¼
                if (elementData.style) {
                    Object.keys(elementData.style).forEach(property => {
                        element.style[property] = elementData.style[property];
                    });
                }
                
                // è®¾ç½®å±æ€§
                if (elementData.attributes) {
                    Object.keys(elementData.attributes).forEach(attr => {
                        element.setAttribute(attr, elementData.attributes[attr]);
                    });
                }
                
                // æ·»åŠ åˆ°çˆ¶å…ƒç´ 
                parentElement.appendChild(element);
                
                // æ·»åŠ å…ƒç´ å·¥å…·æ 
                const toolbar = document.createElement('div');
                toolbar.className = 'element-toolbar';
                toolbar.innerHTML = `
                    <button class="edit-btn" title="ç¼–è¾‘">âœï¸</button>
                    <button class="delete-btn" title="åˆ é™¤">ğŸ—‘ï¸</button>
                    <button class="copy-btn" title="å¤åˆ¶">â˜</button>
                    <button class="move-up-btn" title="ä¸Šç§»">â†‘</button>
                    <button class="move-down-btn" title="ä¸‹ç§»">â†“</button>
                `;
                element.appendChild(toolbar);
                
                // å¤„ç†å­å…ƒç´ 
                if (elementData.children && elementData.children.length > 0) {
                    const container = element.querySelector('.droppable') || element;
                    loadElementsFromData(elementData.children, container);
                }
            });
        }
        
        // è·å–ç”»å¸ƒæ•°æ®
        function getCanvasData() {
            const canvas = document.getElementById('canvas');
            return Array.from(canvas.children).map(element => {
                return getElementData(element);
            });
        }
        
        // è·å–å…ƒç´ æ•°æ®
        function getElementData(element) {
            const data = {
                type: element.getAttribute('data-type') || 'container',
                style: {},
                attributes: {},
                children: []
            };
            
            // è·å–æ ·å¼
            const style = window.getComputedStyle(element);
            for (let i = 0; i < style.length; i++) {
                const property = style[i];
                if (property.startsWith('webkit') || property === 'length' || property === 'parentRule') continue;
                const value = style[property];
                if (value && !value.includes('matrix') && !value.includes('rgb(0, 0, 0)')) {
                    data.style[property] = value;
                }
            }
            
            // è·å–å±æ€§
            Array.from(element.attributes).forEach(attr => {
                if (attr.name !== 'style') {
                    data.attributes[attr.name] = attr.value;
                }
            });
            
            // è·å–å†…å®¹
            if (data.type === 'text') {
                data.content = element.textContent;
            } else {
                data.html = element.innerHTML;
            }
            
            // è·å–å­å…ƒç´ 
            const droppable = element.querySelector('.droppable');
            if (droppable) {
                data.children = Array.from(droppable.children).map(child => getElementData(child));
            }
            
            return data;
        }
        
        // ç”ŸæˆHTMLä»£ç 
        function generateHTML() {
            const canvas = document.getElementById('canvas');
            let html = `<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”Ÿæˆçš„é¡µé¢</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            line-height: 1.6;
        }
        
        /* åŸºç¡€æ ·å¼ */
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
        }
        
        /* è¿™é‡Œå¯ä»¥æ·»åŠ ç”Ÿæˆçš„CSS */
    </style>
</head>
<body>
`;
            
            // éå†ç”»å¸ƒä¸­çš„å…ƒç´ å¹¶ç”ŸæˆHTML
            Array.from(canvas.children).forEach(element => {
                html += `    ${element.outerHTML}\n`;
            });
            
            html += `</body>
</html>`;
            
            return html;
        }
        
        // è®¾ç½®å±æ€§é¢æ¿æ ‡ç­¾åˆ‡æ¢
        function setupPropertyTabs() {
            const tabs = document.querySelectorAll('.tab');
            const contents = [
                document.getElementById('properties-content'),
                document.getElementById('styles-content'),
                document.getElementById('events-content'),
                document.getElementById('code-content'),
                document.getElementById('settings-content')
            ];
            
            tabs.forEach((tab, index) => {
                tab.addEventListener('click', function() {
                    tabs.forEach(t => t.classList.remove('active'));
                    contents.forEach(c => c.style.display = 'none');
                    
                    this.classList.add('active');
                    contents[index].style.display = 'block';
                    
                    // å¦‚æœåˆ‡æ¢åˆ°ä»£ç æ ‡ç­¾ï¼Œæ›´æ–°ä»£ç æ˜¾ç¤º
                    if (index === 3 && selectedElement) {
                        updateCodeView();
                    }
                });
            });
        }
        
        // è®¾ç½®å…ƒç´ é€‰æ‹©
        function setupElementSelection() {
            document.addEventListener('click', function(e) {
                let target = e.target;
                
                // å‘ä¸ŠæŸ¥æ‰¾.elementå…ƒç´ 
                while (target && !target.classList.contains('element') && target !== document.body) {
                    target = target.parentElement;
                }
                
                // å¦‚æœç‚¹å‡»çš„æ˜¯å…ƒç´ æˆ–å…ƒç´ çš„å­å…ƒç´ 
                if (target && target.classList.contains('element')) {
                    // å¤„ç†å…ƒç´ å·¥å…·æ æŒ‰é’®ç‚¹å‡»
                    if (e.target.classList.contains('delete-btn')) {
                        if (confirm('ç¡®å®šè¦åˆ é™¤æ­¤å…ƒç´ å—ï¼Ÿ')) {
                            target.remove();
                            selectedElement = null;
                            clearPropertiesPanel();
                            saveHistory();
                        }
                        return;
                    }
                    
                    if (e.target.classList.contains('copy-btn')) {
                        const clone = target.cloneNode(true);
                        clone.style.left = (parseInt(target.style.left) + 20) + 'px';
                        clone.style.top = (parseInt(target.style.top) + 20) + 'px';
                        target.parentElement.appendChild(clone);
                        selectElement(clone);
                        saveHistory();
                        return;
                    }
                    
                    if (e.target.classList.contains('move-up-btn')) {
                        if (target.previousElementSibling) {
                            target.parentNode.insertBefore(target, target.previousElementSibling);
                            saveHistory();
                        }
                        return;
                    }
                    
                    if (e.target.classList.contains('move-down-btn')) {
                        if (target.nextElementSibling) {
                            target.parentNode.insertBefore(target.nextElementSibling, target);
                            saveHistory();
                        }
                        return;
                    }
                    
                    if (e.target.classList.contains('edit-btn')) {
                        // ç¼–è¾‘é€»è¾‘ï¼Œæ ¹æ®å…ƒç´ ç±»å‹ä¸åŒè€Œä¸åŒ
                        const type = target.getAttribute('data-type');
                        if (type === 'text') {
                            const newText = prompt('ç¼–è¾‘æ–‡æœ¬:', target.textContent);
                            if (newText !== null) {
                                target.textContent = newText;
                                updatePropertiesPanel();
                                saveHistory();
                            }
                        } else if (type === 'image') {
                            const img = target.querySelector('img');
                            if (img) {
                                const newSrc = prompt('å›¾ç‰‡URL:', img.src);
                                if (newSrc !== null) {
                                    img.src = newSrc;
                                    updatePropertiesPanel();
                                    saveHistory();
                                }
                            }
                        } else if (type === 'button') {
                            const button = target.querySelector('button');
                            if (button) {
                                const newText = prompt('æŒ‰é’®æ–‡æœ¬:', button.textContent);
                                if (newText !== null) {
                                    button.textContent = newText;
                                    updatePropertiesPanel();
                                    saveHistory();
                                }
                            }
                        } else if (type === 'progress') {
                            const progress = target.querySelector('div > div');
                            if (progress) {
                                const newValue = prompt('è¿›åº¦å€¼ (0-100):', progress.style.width.replace('%', ''));
                                if (newValue !== null && !isNaN(newValue) && newValue >= 0 && newValue <= 100) {
                                    progress.style.width = newValue + '%';
                                    progress.textContent = newValue + '%';
                                    updatePropertiesPanel();
                                    saveHistory();
                                }
                            }
                        } else if (type === 'table') {
                            const table = target.querySelector('table');
                            if (table) {
                                const newRows = prompt('è¡Œæ•°:', table.rows.length);
                                const newCols = prompt('åˆ—æ•°:', table.rows[0] ? table.rows[0].cells.length : 2);
                                
                                if (newRows !== null && newCols !== null && !isNaN(newRows) && !isNaN(newCols)) {
                                    // æ¸…ç©ºè¡¨æ ¼
                                    table.innerHTML = '';
                                    
                                    // åˆ›å»ºè¡¨å¤´
                                    const thead = document.createElement('thead');
                                    const headerRow = document.createElement('tr');
                                    for (let i = 0; i < newCols; i++) {
                                        const th = document.createElement('th');
                                        th.textContent = 'æ ‡é¢˜' + (i + 1);
                                        th.style.border = '1px solid #ddd';
                                        th.style.padding = '8px';
                                        th.style.textAlign = 'left';
                                        th.style.backgroundColor = '#f2f2f2';
                                        headerRow.appendChild(th);
                                    }
                                    thead.appendChild(headerRow);
                                    table.appendChild(thead);
                                    
                                    // åˆ›å»ºè¡¨ä½“
                                    const tbody = document.createElement('tbody');
                                    for (let i = 0; i < newRows; i++) {
                                        const row = document.createElement('tr');
                                        for (let j = 0; j < newCols; j++) {
                                            const td = document.createElement('td');
                                            td.textContent = 'å†…å®¹' + (i + 1) + '-' + (j + 1);
                                            td.style.border = '1px solid #ddd';
                                            td.style.padding = '8px';
                                            row.appendChild(td);
                                        }
                                        tbody.appendChild(row);
                                    }
                                    table.appendChild(tbody);
                                    
                                    updatePropertiesPanel();
                                    saveHistory();
                                }
                            }
                        }
                        return;
                    }
                    
                    // é€‰æ‹©å…ƒç´ 
                    selectElement(target);
                } else {
                    // ç‚¹å‡»ç©ºç™½å¤„å–æ¶ˆé€‰æ‹©
                    if (selectedElement) {
                        selectedElement.classList.remove('selected');
                        selectedElement = null;
                        clearPropertiesPanel();
                    }
                }
            });
        }
        
        // é€‰æ‹©å…ƒç´ 
        function selectElement(element) {
            // å–æ¶ˆä¹‹å‰é€‰ä¸­çš„å…ƒç´ 
            if (selectedElement) {
                selectedElement.classList.remove('selected');
            }
            
            // é€‰ä¸­æ–°å…ƒç´ 
            selectedElement = element;
            element.classList.add('selected');
            
            // æ›´æ–°å±æ€§é¢æ¿
            updatePropertiesPanel();
        }
        
        // æ›´æ–°å±æ€§é¢æ¿
        function updatePropertiesPanel() {
            if (!selectedElement) return;
            
            const type = selectedElement.getAttribute('data-type');
            
            // æ›´æ–°åŸºæœ¬å±æ€§
            document.getElementById('prop-type').value = type;
            document.getElementById('prop-id').value = selectedElement.id || '';
            document.getElementById('prop-class').value = selectedElement.className.replace('element', '').replace('selected', '').trim();
            
            // æ ¹æ®å…ƒç´ ç±»å‹æ›´æ–°ç‰¹å®šå±æ€§
            if (type === 'text') {
                document.getElementById('prop-text').value = selectedElement.textContent;
                document.getElementById('prop-text').disabled = false;
            } else {
                document.getElementById('prop-text').value = '';
                document.getElementById('prop-text').disabled = true;
            }
            
            // æ›´æ–°æ ·å¼
            const style = window.getComputedStyle(selectedElement);
            document.getElementById('style-width').value = style.width;
            document.getElementById('style-height').value = style.height;
            document.getElementById('style-position').value = style.position;
            document.getElementById('style-top').value = style.top;
            document.getElementById('style-left').value = style.left;
            document.getElementById('style-margin').value = style.margin;
            document.getElementById('style-padding').value = style.padding;
            document.getElementById('style-font-size').value = style.fontSize;
            document.getElementById('style-color').value = rgbToHex(style.color);
            document.getElementById('style-color-text').value = rgbToHex(style.color);
            document.getElementById('style-font-weight').value = style.fontWeight;
            document.getElementById('style-text-align').value = style.textAlign;
            document.getElementById('style-display').value = style.display;
            document.getElementById('style-flex-direction').value = style.flexDirection;
            document.getElementById('style-justify-content').value = style.justifyContent;
            
            // æ›´æ–°å…¶ä»–å±æ€§
            document.getElementById('prop-bgcolor').value = rgbToHex(style.backgroundColor);
            document.getElementById('prop-bgcolor-text').value = rgbToHex(style.backgroundColor);
            document.getElementById('prop-border').value = style.border;
            document.getElementById('prop-border-radius').value = style.borderRadius;
            document.getElementById('prop-visible').value = style.visibility === 'hidden' ? 'hidden' : style.display === 'none' ? 'none' : 'visible';
            
            // æ›´æ–°ä»£ç è§†å›¾
            updateCodeView();
            
            // è®¾ç½®å±æ€§å˜åŒ–ç›‘å¬
            setupPropertyChangeListeners();
        }
        
        // RGBé¢œè‰²è½¬HEX
        function rgbToHex(rgb) {
            if (!rgb || rgb === 'transparent' || rgb === 'rgba(0, 0, 0, 0)') return '#ffffff';
            
            // å¤„ç†rgb(r, g, b)æ ¼å¼
            if (rgb.startsWith('rgb(')) {
                const parts = rgb.substring(4, rgb.length - 1).split(',');
                const r = parseInt(parts[0].trim());
                const g = parseInt(parts[1].trim());
                const b = parseInt(parts[2].trim());
                return `#${((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1)}`;
            }
            
            // å¤„ç†rgba(r, g, b, a)æ ¼å¼
            if (rgb.startsWith('rgba(')) {
                const parts = rgb.substring(5, rgb.length - 1).split(',');
                const r = parseInt(parts[0].trim());
                const g = parseInt(parts[1].trim());
                const b = parseInt(parts[2].trim());
                return `#${((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1)}`;
            }
            
            return rgb;
        }
        
        // æ›´æ–°ä»£ç è§†å›¾
        function updateCodeView() {
            if (!selectedElement) return;
            
            document.getElementById('element-html').value = selectedElement.outerHTML;
            
            // è·å–å…ƒç´ ç‰¹å®šCSS
            const style = window.getComputedStyle(selectedElement);
            let css = '';
            for (let i = 0; i < style.length; i++) {
                const property = style[i];
                if (!property.startsWith('webkit') && property !== 'length' && property !== 'parentRule') {
                    const value = style[property];
                    if (value && !value.includes('matrix') && !value.includes('rgb(0, 0, 0)')) {
                        css += `${property}: ${value};\n`;
                    }
                }
            }
            document.getElementById('element-css').value = css;
            
            // è·å–å…ƒç´ ç‰¹å®šJS
            document.getElementById('element-js').value = '// è‡ªå®šä¹‰JavaScriptä»£ç \n// ä¾‹å¦‚: console.log("Hello");';
        }
        
        // è®¾ç½®å±æ€§å˜åŒ–ç›‘å¬
        function setupPropertyChangeListeners() {
            if (!selectedElement) return;
            
            // ID
            document.getElementById('prop-id').addEventListener('change', function() {
                selectedElement.id = this.value;
                updateCodeView();
                saveHistory();
            });
            
            // ç±»å
            document.getElementById('prop-class').addEventListener('change', function() {
                selectedElement.className = 'element ' + this.value;
                if (selectedElement.classList.contains('selected')) {
                    selectedElement.className += ' selected';
                }
                updateCodeView();
                saveHistory();
            });
            
            // æ–‡æœ¬å†…å®¹
            document.getElementById('prop-text').addEventListener('change', function() {
                if (selectedElement.getAttribute('data-type') === 'text') {
                    selectedElement.textContent = this.value;
                    updateCodeView();
                    saveHistory();
                }
            });
            
            // èƒŒæ™¯é¢œè‰²
            document.getElementById('prop-bgcolor').addEventListener('change', function() {
                selectedElement.style.backgroundColor = this.value;
                document.getElementById('prop-bgcolor-text').value = this.value;
                updateCodeView();
                saveHistory();
            });
            
            document.getElementById('prop-bgcolor-text').addEventListener('change', function() {
                selectedElement.style.backgroundColor = this.value;
                document.getElementById('prop-bgcolor').value = this.value;
                updateCodeView();
                saveHistory();
            });
            
            // è¾¹æ¡†
            document.getElementById('prop-border').addEventListener('change', function() {
                selectedElement.style.border = this.value;
                updateCodeView();
                saveHistory();
            });
            
            // è¾¹æ¡†åŠå¾„
            document.getElementById('prop-border-radius').addEventListener('change', function() {
                selectedElement.style.borderRadius = this.value;
                updateCodeView();
                saveHistory();
            });
            
            // å¯è§æ€§
            document.getElementById('prop-visible').addEventListener('change', function() {
                if (this.value === 'hidden') {
                    selectedElement.style.visibility = 'hidden';
                    selectedElement.style.display = '';
                } else if (this.value === 'none') {
                    selectedElement.style.display = 'none';
                    selectedElement.style.visibility = '';
                } else {
                    selectedElement.style.visibility = '';
                    selectedElement.style.display = '';
                }
                updateCodeView();
                saveHistory();
            });
            
            // å®½åº¦
            document.getElementById('style-width').addEventListener('change', function() {
                selectedElement.style.width = this.value;
                updateCodeView();
                saveHistory();
            });
            
            // é«˜åº¦
            document.getElementById('style-height').addEventListener('change', function() {
                selectedElement.style.height = this.value;
                updateCodeView();
                saveHistory();
            });
            
            // ä½ç½®
            document.getElementById('style-position').addEventListener('change', function() {
                selectedElement.style.position = this.value;
                updateCodeView();
                saveHistory();
            });
            
            // ä¸Šè¾¹è·
            document.getElementById('style-top').addEventListener('change', function() {
                selectedElement.style.top = this.value;
                updateCodeView();
                saveHistory();
            });
            
            // å·¦è¾¹è·
            document.getElementById('style-left').addEventListener('change', function() {
                selectedElement.style.left = this.value;
                updateCodeView();
                saveHistory();
            });
            
            // å¤–è¾¹è·
            document.getElementById('style-margin').addEventListener('change', function() {
                selectedElement.style.margin = this.value;
                updateCodeView();
                saveHistory();
            });
            
            // å†…è¾¹è·
            document.getElementById('style-padding').addEventListener('change', function() {
                selectedElement.style.padding = this.value;
                updateCodeView();
                saveHistory();
            });
            
            // å­—ä½“å¤§å°
            document.getElementById('style-font-size').addEventListener('change', function() {
                selectedElement.style.fontSize = this.value;
                updateCodeView();
                saveHistory();
            });
            
            // å­—ä½“é¢œè‰²
            document.getElementById('style-color').addEventListener('change', function() {
                selectedElement.style.color = this.value;
                document.getElementById('style-color-text').value = this.value;
                updateCodeView();
                saveHistory();
            });
            
            document.getElementById('style-color-text').addEventListener('change', function() {
                selectedElement.style.color = this.value;
                document.getElementById('style-color').value = this.value;
                updateCodeView();
                saveHistory();
            });
            
            // å­—ä½“ç²—ç»†
            document.getElementById('style-font-weight').addEventListener('change', function() {
                selectedElement.style.fontWeight = this.value;
                updateCodeView();
                saveHistory();
            });
            
            // æ–‡æœ¬å¯¹é½
            document.getElementById('style-text-align').addEventListener('change', function() {
                selectedElement.style.textAlign = this.value;
                updateCodeView();
                saveHistory();
            });
            
            // æ˜¾ç¤ºæ–¹å¼
            document.getElementById('style-display').addEventListener('change', function() {
                selectedElement.style.display = this.value;
                updateCodeView();
                saveHistory();
            });
            
            // Flex æ–¹å‘
            document.getElementById('style-flex-direction').addEventListener('change', function() {
                selectedElement.style.flexDirection = this.value;
                updateCodeView();
                saveHistory();
            });
            
            // Flex å¯¹é½
            document.getElementById('style-justify-content').addEventListener('change', function() {
                selectedElement.style.justifyContent = this.value;
                updateCodeView();
                saveHistory();
            });
            
            // ç‚¹å‡»äº‹ä»¶
            document.getElementById('event-click').addEventListener('change', function() {
                if (this.value === 'custom') {
                    document.getElementById('custom-click-container').style.display = 'block';
                } else {
                    document.getElementById('custom-click-container').style.display = 'none';
                    // è®¾ç½®é¢„è®¾äº‹ä»¶
                    if (this.value === 'alert') {
                        selectedElement.onclick = function() { alert('ç‚¹å‡»äº‹ä»¶è§¦å‘ï¼'); };
                    } else if (this.value === 'navigate') {
                        selectedElement.onclick = function() { window.location.href = '#'; };
                    } else if (this.value === 'toggle') {
                        selectedElement.onclick = function() { 
                            this.style.display = this.style.display === 'none' ? '' : 'none'; 
                        };
                    } else if (this.value === 'submit') {
                        selectedElement.onclick = function(e) { 
                            e.preventDefault();
                            alert('è¡¨å•æäº¤ï¼'); 
                        };
                    } else {
                        selectedElement.onclick = null;
                    }
                }
                updateCodeView();
                saveHistory();
            });
            
            // è‡ªå®šä¹‰ç‚¹å‡»äº‹ä»¶
            document.getElementById('event-click-custom').addEventListener('change', function() {
                try {
                    selectedElement.onclick = new Function('event', this.value);
                    updateCodeView();
                    saveHistory();
                } catch (error) {
                    alert('è‡ªå®šä¹‰ä»£ç é”™è¯¯: ' + error.message);
                }
            });
            
            // é¼ æ ‡æ‚¬åœäº‹ä»¶
            document.getElementById('event-hover').addEventListener('change', function() {
                if (this.value === 'custom') {
                    document.getElementById('custom-hover-container').style.display = 'block';
                } else {
                    document.getElementById('custom-hover-container').style.display = 'none';
                    // è®¾ç½®é¢„è®¾äº‹ä»¶
                    if (this.value === 'tooltip') {
                        selectedElement.onmouseover = function() { 
                            const tooltip = document.createElement('div');
                            tooltip.textContent = 'æç¤ºä¿¡æ¯';
                            tooltip.style.position = 'absolute';
                            tooltip.style.backgroundColor = 'black';
                            tooltip.style.color = 'white';
                            tooltip.style.padding = '5px';
                            tooltip.style.borderRadius = '3px';
                            tooltip.style.zIndex = '1000';
                            tooltip.style.top = (this.offsetTop - 30) + 'px';
                            tooltip.style.left = this.offsetLeft + 'px';
                            tooltip.id = 'tooltip-' + Date.now();
                            document.body.appendChild(tooltip);
                        };
                        selectedElement.onmouseout = function() {
                            const tooltips = document.querySelectorAll('[id^="tooltip-"]');
                            tooltips.forEach(t => t.remove());
                        };
                    } else if (this.value === 'highlight') {
                        selectedElement.onmouseover = function() { 
                            this.style.boxShadow = '0 0 10px rgba(0,0,0,0.3)';
                        };
                        selectedElement.onmouseout = function() {
                            this.style.boxShadow = '';
                        };
                    } else {
                        selectedElement.onmouseover = null;
                        selectedElement.onmouseout = null;
                    }
                }
                updateCodeView();
                saveHistory();
            });
            
            // è‡ªå®šä¹‰æ‚¬åœäº‹ä»¶
            document.getElementById('event-hover-custom').addEventListener('change', function() {
                try {
                    selectedElement.onmouseover = new Function('event', this.value);
                    updateCodeView();
                    saveHistory();
                } catch (error) {
                    alert('è‡ªå®šä¹‰ä»£ç é”™è¯¯: ' + error.message);
                }
            });
            
            // è¾“å…¥å˜åŒ–äº‹ä»¶
            document.getElementById('event-change').addEventListener('change', function() {
                if (this.value === 'custom') {
                    document.getElementById('custom-change-container').style.display = 'block';
                } else {
                    document.getElementById('custom-change-container').style.display = 'none';
                    // è®¾ç½®é¢„è®¾äº‹ä»¶
                    if (this.value === 'validate') {
                        selectedElement.onchange = function() { 
                            if (!this.value) {
                                this.style.borderColor = 'red';
                            } else {
                                this.style.borderColor = '';
                            }
                        };
                    } else if (this.value === 'update') {
                        selectedElement.onchange = function() { 
                            const output = document.getElementById(this.id + '-output');
                            if (output) output.textContent = this.value;
                        };
                    } else {
                        selectedElement.onchange = null;
                    }
                }
                updateCodeView();
                saveHistory();
            });
            
            // è‡ªå®šä¹‰å˜åŒ–äº‹ä»¶
            document.getElementById('event-change-custom').addEventListener('change', function() {
                try {
                    selectedElement.onchange = new Function('event', this.value);
                    updateCodeView();
                    saveHistory();
                } catch (error) {
                    alert('è‡ªå®šä¹‰ä»£ç é”™è¯¯: ' + error.message);
                }
            });
            
            // ç”»å¸ƒå®½åº¦è®¾ç½®
            document.getElementById('setting-canvas-width').addEventListener('change', function() {
                document.getElementById('preview-frame').style.width = this.value;
                saveSettings();
            });
            
            // ç”»å¸ƒèƒŒæ™¯é¢œè‰²
            document.getElementById('setting-canvas-bgcolor').addEventListener('change', function() {
                document.getElementById('canvas').style.backgroundColor = this.value;
                document.getElementById('setting-canvas-bgcolor-text').value = this.value;
                saveSettings();
            });
            
            document.getElementById('setting-canvas-bgcolor-text').addEventListener('change', function() {
                document.getElementById('canvas').style.backgroundColor = this.value;
                document.getElementById('setting-canvas-bgcolor').value = this.value;
                saveSettings();
            });
            
            // ç½‘æ ¼æ˜¾ç¤º
            document.getElementById('setting-grid-show').addEventListener('change', function() {
                if (this.value === 'true') {
                    const gridColor = document.getElementById('setting-grid-color').value;
                    const color = hexToRgba(gridColor, 0.1);
                    const gridSize = document.getElementById('setting-grid-size').value;
                    document.getElementById('canvas').style.backgroundImage = `linear-gradient(${color} 1px, transparent 1px), linear-gradient(90deg, ${color} 1px, transparent 1px)`;
                    document.getElementById('canvas').style.backgroundSize = `${gridSize}px ${gridSize}px`;
                } else {
                    document.getElementById('canvas').style.backgroundImage = 'none';
                }
                saveSettings();
            });
            
            // ç½‘æ ¼å¤§å°
            document.getElementById('setting-grid-size').addEventListener('change', function() {
                if (document.getElementById('setting-grid-show').value === 'true') {
                    const gridColor = document.getElementById('setting-grid-color').value;
                    const color = hexToRgba(gridColor, 0.1);
                    document.getElementById('canvas').style.backgroundSize = `${this.value}px ${this.value}px`;
                }
                saveSettings();
            });
            
            // ç½‘æ ¼é¢œè‰²
            document.getElementById('setting-grid-color').addEventListener('change', function() {
                if (document.getElementById('setting-grid-show').value === 'true') {
                    const color = hexToRgba(this.value, 0.1);
                    document.getElementById('canvas').style.backgroundImage = `linear-gradient(${color} 1px, transparent 1px), linear-gradient(90deg, ${color} 1px, transparent 1px)`;
                }
                document.getElementById('setting-grid-color-text').value = this.value;
                saveSettings();
            });
            
            document.getElementById('setting-grid-color-text').addEventListener('change', function() {
                if (document.getElementById('setting-grid-show').value === 'true') {
                    const color = hexToRgba(this.value, 0.1);
                    document.getElementById('canvas').style.backgroundImage = `linear-gradient(${color} 1px, transparent 1px), linear-gradient(90deg, ${color} 1px, transparent 1px)`;
                }
                document.getElementById('setting-grid-color').value = this.value;
                saveSettings();
            });
            
            // è‡ªåŠ¨ä¿å­˜
            document.getElementById('setting-autosave').addEventListener('change', function() {
                saveSettings();
            });
            
            // è‡ªåŠ¨ä¿å­˜é—´éš”
            document.getElementById('setting-autosave-interval').addEventListener('change', function() {
                saveSettings();
            });
        }
        
        // HEXé¢œè‰²è½¬RGBA
        function hexToRgba(hex, alpha) {
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            return `rgba(${r}, ${g}, ${b}, ${alpha})`;
        }
        
        // æ¸…ç©ºå±æ€§é¢æ¿
        function clearPropertiesPanel() {
            document.getElementById('properties-content').querySelectorAll('input, select, textarea').forEach(input => {
                input.value = '';
            });
            document.getElementById('styles-content').querySelectorAll('input').forEach(input => {
                input.value = '';
            });
            document.getElementById('events-content').querySelectorAll('select, textarea').forEach(input => {
                input.value = '';
            });
            document.getElementById('custom-click-container').style.display = 'none';
            document.getElementById('custom-hover-container').style.display = 'none';
            document.getElementById('custom-change-container').style.display = 'none';
            document.getElementById('element-html').value = '';
            document.getElementById('element-css').value = '';
            document.getElementById('element-js').value = '';
        }
        
        // ä¿å­˜å†å²çŠ¶æ€
        function saveHistory() {
            // å¦‚æœå½“å‰ä¸æ˜¯æœ€æ–°çš„å†å²è®°å½•ï¼Œåˆ™ä¸¢å¼ƒåé¢çš„è®°å½•
            if (historyIndex < historyStack.length - 1) {
                historyStack = historyStack.slice(0, historyIndex + 1);
            }
            
            // ä¿å­˜å½“å‰çŠ¶æ€
            const canvas = document.getElementById('canvas');
            const snapshot = {
                html: canvas.innerHTML,
                selectedElementId: selectedElement ? selectedElement.id : null,
                timestamp: new Date().toISOString()
            };
            
            historyStack.push(snapshot);
            historyIndex = historyStack.length - 1;
            
            // é™åˆ¶å†å²è®°å½•æ•°é‡
            if (historyStack.length > 50) {
                historyStack.shift();
                historyIndex--;
            }
            
            // æ›´æ–°æ’¤é”€/é‡åšæŒ‰é’®çŠ¶æ€
            updateHistoryButtons();
        }
        
        // æ’¤é”€æ“ä½œ
        function undo() {
            if (historyIndex <= 0) return;
            
            historyIndex--;
            restoreFromHistory();
        }
        
        // é‡åšæ“ä½œ
        function redo() {
            if (historyIndex >= historyStack.length - 1) return;
            
            historyIndex++;
            restoreFromHistory();
        }
        
        // ä»å†å²è®°å½•æ¢å¤
        function restoreFromHistory() {
            const snapshot = historyStack[historyIndex];
            const canvas = document.getElementById('canvas');
            
            canvas.innerHTML = snapshot.html;
            
            // é‡æ–°è®¾ç½®æ‰€æœ‰å…ƒç´ çš„æ‹–æ”¾åŒºåŸŸ
            const droppables = canvas.querySelectorAll('.droppable');
            droppables.forEach(droppable => {
                setupNestedDroppable(droppable);
            });
            
            // æ¢å¤é€‰ä¸­çš„å…ƒç´ 
            if (snapshot.selectedElementId) {
                const element = document.getElementById(snapshot.selectedElementId);
                if (element) {
                    selectElement(element);
                } else {
                    selectedElement = null;
                    clearPropertiesPanel();
                }
            } else {
                selectedElement = null;
                clearPropertiesPanel();
            }
            
            // æ›´æ–°æ’¤é”€/é‡åšæŒ‰é’®çŠ¶æ€
            updateHistoryButtons();
        }
        
        // æ›´æ–°æ’¤é”€/é‡åšæŒ‰é’®çŠ¶æ€
        function updateHistoryButtons() {
            document.getElementById('undo-btn').disabled = historyIndex <= 0;
            document.getElementById('redo-btn').disabled = historyIndex >= historyStack.length - 1;
        }
        
        // è®¾ç½®ä¾§è¾¹æ æŠ˜å 
        function setupSidebarSections() {
            const sections = document.querySelectorAll('.sidebar-section');
            
            sections.forEach(section => {
                const header = section.querySelector('h3');
                header.addEventListener('click', function() {
                    section.classList.toggle('collapsed');
                });
            });
        }
        
        // è®¾ç½®ç»„ä»¶æœç´¢
        function setupComponentSearch() {
            const searchInput = document.getElementById('component-search');
            
            searchInput.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const components = document.querySelectorAll('.component');
                
                components.forEach(component => {
                    const text = component.textContent.toLowerCase();
                    if (text.includes(searchTerm)) {
                        component.style.display = '';
                    } else {
                        component.style.display = 'none';
                    }
                });
            });
        }
        
        // è®¾ç½®æ¨¡æ¿ç‚¹å‡»
        function setupTemplateClick() {
            const templates = document.querySelectorAll('.template-preview');
            
            templates.forEach(template => {
                template.addEventListener('click', function() {
                    const templateName = this.getAttribute('data-template');
                    if (templateLibrary[templateName]) {
                        if (confirm(`ç¡®å®šè¦åŠ è½½"${templateLibrary[templateName].name}"æ¨¡æ¿å—ï¼Ÿå½“å‰å†…å®¹å°†è¢«æ›¿æ¢ã€‚`)) {
                            document.getElementById('canvas').innerHTML = templateLibrary[templateName].html;
                            
                            // é‡æ–°è®¾ç½®æ‰€æœ‰å…ƒç´ çš„æ‹–æ”¾åŒºåŸŸ
                            const droppables = document.querySelectorAll('.droppable');
                            droppables.forEach(droppable => {
                                setupNestedDroppable(droppable);
                            });
                            
                            // æ·»åŠ å…ƒç´ å·¥å…·æ 
                            const elements = document.querySelectorAll('.element');
                            elements.forEach(element => {
                                const toolbar = document.createElement('div');
                                toolbar.className = 'element-toolbar';
                                toolbar.innerHTML = `
                                    <button class="edit-btn" title="ç¼–è¾‘">âœï¸</button>
                                    <button class="delete-btn" title="åˆ é™¤">ğŸ—‘ï¸</button>
                                    <button class="copy-btn" title="å¤åˆ¶">â˜</button>
                                    <button class="move-up-btn" title="ä¸Šç§»">â†‘</button>
                                    <button class="move-down-btn" title="ä¸‹ç§»">â†“</button>
                                `;
                                element.appendChild(toolbar);
                            });
                            
                            selectedElement = null;
                            clearPropertiesPanel();
                            saveHistory();
                        }
                    }
                });
            });
        }
        
        // è®¾ç½®å¿«æ·é”®
        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', function(e) {
                // æ£€æŸ¥æ˜¯å¦åœ¨è¾“å…¥æ¡†ä¸­ï¼Œå¦‚æœæ˜¯åˆ™å¿½ç•¥å¿«æ·é”®
                if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA' || e.target.isContentEditable) {
                    return;
                }
                
                // Ctrl+Z - æ’¤é”€
                if (e.ctrlKey && e.key === 'z') {
                    e.preventDefault();
                    undo();
                }
                
                // Ctrl+Y - é‡åš
                if (e.ctrlKey && e.key === 'y') {
                    e.preventDefault();
                    redo();
                }
                
                // Delete - åˆ é™¤é€‰ä¸­å…ƒç´ 
                if (e.key === 'Delete' && selectedElement) {
                    e.preventDefault();
                    selectedElement.remove();
                    selectedElement = null;
                    clearPropertiesPanel();
                    saveHistory();
                }
                
                // æ–¹å‘é”® - ç§»åŠ¨é€‰ä¸­å…ƒç´ 
                if (selectedElement && (e.key === 'ArrowUp' || e.key === 'ArrowDown' || e.key === 'ArrowLeft' || e.key === 'ArrowRight')) {
                    e.preventDefault();
                    const currentTop = parseInt(selectedElement.style.top) || 0;
                    const currentLeft = parseInt(selectedElement.style.left) || 0;
                    const step = e.shiftKey ? 10 : 1;
                    
                    switch(e.key) {
                        case 'ArrowUp':
                            selectedElement.style.top = (currentTop - step) + 'px';
                            break;
                        case 'ArrowDown':
                            selectedElement.style.top = (currentTop + step) + 'px';
                            break;
                        case 'ArrowLeft':
                            selectedElement.style.left = (currentLeft - step) + 'px';
                            break;
                        case 'ArrowRight':
                            selectedElement.style.left = (currentLeft + step) + 'px';
                            break;
                    }
                    
                    updatePropertiesPanel();
                    saveHistory();
                }
            });
        }
        
        // è·å–å½“å‰è®¾ç½®
        function getCurrentSettings() {
            return {
                device: currentDevice,
                canvasWidth: document.getElementById('preview-frame').style.width,
                canvasBgColor: document.getElementById('canvas').style.backgroundColor,
                gridShow: document.getElementById('setting-grid-show').value === 'true',
                gridSize: document.getElementById('setting-grid-size').value,
                gridColor: document.getElementById('setting-grid-color').value,
                autosave: document.getElementById('setting-autosave').value === 'true',
                autosaveInterval: document.getElementById('setting-autosave-interval').value
            };
        }
        
        // åº”ç”¨è®¾ç½®
        function applySettings(settings) {
            if (!settings) return;
            
            // è®¾å¤‡è®¾ç½®
            if (settings.device) {
                currentDevice = settings.device;
                const deviceBtn = document.querySelector(`.toolbar-btn[data-device="${settings.device}"]`);
                if (deviceBtn) {
                    document.querySelectorAll('.toolbar-btn[data-device]').forEach(btn => btn.classList.remove('active'));
                    deviceBtn.classList.add('active');
                    
                    const previewFrame = document.getElementById('preview-frame');
                    switch(currentDevice) {
                        case 'desktop':
                            previewFrame.style.width = '100%';
                            previewFrame.style.maxWidth = 'none';
                            break;
                        case 'mobile':
                            previewFrame.style.width = '375px';
                            previewFrame.style.maxWidth = '100%';
                            break;
                        case 'tablet':
                            previewFrame.style.width = '768px';
                            previewFrame.style.maxWidth = '100%';
                            break;
                        case 'weapp':
                            previewFrame.style.width = '414px';
                            previewFrame.style.maxWidth = '100%';
                            break;
                    }
                }
            }
            
            // ç”»å¸ƒå®½åº¦
            if (settings.canvasWidth) {
                document.getElementById('preview-frame').style.width = settings.canvasWidth;
                document.getElementById('setting-canvas-width').value = settings.canvasWidth;
            }
            
            // ç”»å¸ƒèƒŒæ™¯é¢œè‰²
            if (settings.canvasBgColor) {
                document.getElementById('canvas').style.backgroundColor = settings.canvasBgColor;
                document.getElementById('setting-canvas-bgcolor').value = rgbToHex(settings.canvasBgColor);
                document.getElementById('setting-canvas-bgcolor-text').value = rgbToHex(settings.canvasBgColor);
            }
            
            // ç½‘æ ¼æ˜¾ç¤º
            if (settings.gridShow !== undefined) {
                document.getElementById('setting-grid-show').value = settings.gridShow ? 'true' : 'false';
                if (settings.gridShow) {
                    const gridColor = settings.gridColor || '#e0e0e0';
                    const color = hexToRgba(gridColor, 0.1);
                    const gridSize = settings.gridSize || '10';
                    document.getElementById('canvas').style.backgroundImage = `linear-gradient(${color} 1px, transparent 1px), linear-gradient(90deg, ${color} 1px, transparent 1px)`;
                    document.getElementById('canvas').style.backgroundSize = `${gridSize}px ${gridSize}px`;
                } else {
                    document.getElementById('canvas').style.backgroundImage = 'none';
                }
            }
            
            // ç½‘æ ¼å¤§å°
            if (settings.gridSize) {
                document.getElementById('setting-grid-size').value = settings.gridSize;
            }
            
            // ç½‘æ ¼é¢œè‰²
            if (settings.gridColor) {
                document.getElementById('setting-grid-color').value = settings.gridColor;
                document.getElementById('setting-grid-color-text').value = settings.gridColor;
            }
            
            // è‡ªåŠ¨ä¿å­˜
            if (settings.autosave !== undefined) {
                document.getElementById('setting-autosave').value = settings.autosave ? 'true' : 'false';
            }
            
            // è‡ªåŠ¨ä¿å­˜é—´éš”
            if (settings.autosaveInterval) {
                document.getElementById('setting-autosave-interval').value = settings.autosaveInterval;
            }
        }
        
        // åŠ è½½è®¾ç½®
        function loadSettings() {
            const savedSettings = localStorage.getItem('h5EditorSettings');
            if (savedSettings) {
                try {
                    const settings = JSON.parse(savedSettings);
                    applySettings(settings);
                } catch (error) {
                    console.error('åŠ è½½è®¾ç½®å¤±è´¥:', error);
                }
            }
        }
        
        // ä¿å­˜è®¾ç½®
        function saveSettings() {
            const settings = getCurrentSettings();
            localStorage.setItem('h5EditorSettings', JSON.stringify(settings));
        }
    </script>
</body>
</html>