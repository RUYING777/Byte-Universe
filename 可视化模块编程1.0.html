<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H5‰Ωé‰ª£Á†ÅÁºñËæëÂô® - Â¢ûÂº∫Áâà</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Arial', sans-serif;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }
        .sidebar {
            width: 250px;
            background-color: #2c3e50;
            color: white;
            padding: 10px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }
        .sidebar-section {
            margin-bottom: 15px;
        }
        .sidebar-section h3 {
            padding: 5px 0;
            border-bottom: 1px solid #34495e;
            margin-bottom: 5px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .sidebar-section h3::after {
            content: '‚ñº';
            font-size: 0.8em;
            transition: transform 0.2s;
        }
        .sidebar-section.collapsed h3::after {
            transform: rotate(-90deg);
        }
        .sidebar-section.collapsed .component-list {
            display: none;
        }
        .component-list {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 5px;
        }
        .component {
            padding: 8px;
            background-color: #34495e;
            border-radius: 4px;
            cursor: grab;
            user-select: none;
            font-size: 0.9em;
            text-align: center;
        }
        .component:hover {
            background-color: #3d566e;
        }
        .workspace {
            flex: 1;
            display: flex;
            flex-direction: column;
            background-color: #ecf0f1;
        }
        .toolbar {
            padding: 10px;
            background-color: #3498db;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .toolbar-group {
            display: flex;
            gap: 10px;
        }
        .toolbar-btn {
            padding: 5px 10px;
            background-color: #2980b9;
            border: none;
            color: white;
            border-radius: 4px;
            cursor: pointer;
        }
        .toolbar-btn:hover {
            background-color: #1a6ea3;
        }
        .toolbar-btn.active {
            background-color: #16a085;
        }
        .toolbar-btn.disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
        }
        .preview-container {
            flex: 1;
            padding: 20px;
            overflow: auto;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            background-color: #bdc3c7;
        }
        .preview-frame {
            background-color: white;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            position: relative;
            overflow: auto;
            transition: width 0.3s;
        }
        .droppable {
            min-height: 50px;
            border: 2px dashed #7f8c8d;
            margin: 5px;
            padding: 10px;
            width: 100%;
            height: 100%;
            box-sizing: border-box;
        }
        .element {
            margin: 5px;
            padding: 10px;
            background-color: #bdc3c7;
            position: relative;
            cursor: move;
        }
        .element:hover {
            outline: 2px solid #3498db;
        }
        .element.selected {
            outline: 2px solid #e74c3c;
        }
        .element-toolbar {
            position: absolute;
            top: -25px;
            right: 0;
            background-color: #3498db;
            display: none;
            border-radius: 3px 3px 0 0;
            overflow: hidden;
        }
        .element:hover .element-toolbar, .element.selected .element-toolbar {
            display: flex;
        }
        .element-toolbar button {
            background: none;
            border: none;
            color: white;
            padding: 2px 5px;
            cursor: pointer;
            font-size: 0.8em;
        }
        .element-toolbar button:hover {
            background-color: #2980b9;
        }
        .properties-panel {
            width: 300px;
            background-color: #34495e;
            color: white;
            padding: 10px;
            overflow-y: auto;
        }
        .property-item {
            margin-bottom: 10px;
        }
        .property-item label {
            display: block;
            margin-bottom: 5px;
            font-size: 0.9em;
        }
        .property-item input, .property-item select, .property-item textarea {
            width: 100%;
            padding: 5px;
            border-radius: 3px;
            border: 1px solid #2c3e50;
        }
        .tab-container {
            display: flex;
            margin-bottom: 10px;
            border-bottom: 1px solid #2c3e50;
        }
        .tab {
            padding: 5px 10px;
            background-color: #7f8c8d;
            margin-right: 5px;
            cursor: pointer;
            border-radius: 3px 3px 0 0;
            font-size: 0.9em;
        }
        .tab.active {
            background-color: #3498db;
        }
        .code-editor {
            width: 100%;
            height: 200px;
            font-family: monospace;
            background-color: #2c3e50;
            color: #ecf0f1;
            border: 1px solid #2c3e50;
        }
        .device-selector {
            display: flex;
            gap: 5px;
        }
        .template-preview {
            width: 100%;
            height: 80px;
            background-color: #ecf0f1;
            margin-bottom: 5px;
            overflow: hidden;
            position: relative;
            cursor: pointer;
        }
        .template-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .template-item {
            margin-bottom: 15px;
            background-color: #3d566e;
            padding: 10px;
            border-radius: 4px;
        }
        .template-item h4 {
            margin-bottom: 5px;
        }
        .color-picker {
            display: flex;
            align-items: center;
        }
        .color-picker input[type="color"] {
            width: 30px;
            height: 30px;
            padding: 0;
            margin-right: 5px;
        }
        .color-picker input[type="text"] {
            flex: 1;
        }
        .history-controls {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #2c3e50;
        }
        .component-icon {
            font-size: 1.5em;
            margin-bottom: 3px;
        }
        .search-box {
            margin-bottom: 10px;
        }
        .search-box input {
            width: 100%;
            padding: 5px;
            border-radius: 3px;
            border: 1px solid #2c3e50;
        }
    </style>
</head>
<body>
    <!-- Â∑¶‰æßÁªÑ‰ª∂Èù¢Êùø -->
    <div class="sidebar" id="components-panel">
        <div class="search-box">
            <input type="text" id="component-search" placeholder="ÊêúÁ¥¢ÁªÑ‰ª∂...">
        </div>
        
        <div class="sidebar-section">
            <h3>Âü∫Á°ÄÁªÑ‰ª∂</h3>
            <div class="component-list">
                <div class="component" draggable="true" data-type="container">
                    <div class="component-icon">üì¶</div>
                    <div>ÂÆπÂô®</div>
                </div>
                <div class="component" draggable="true" data-type="text">
                    <div class="component-icon">üìù</div>
                    <div>ÊñáÊú¨</div>
                </div>
                <div class="component" draggable="true" data-type="button">
                    <div class="component-icon">üîò</div>
                    <div>ÊåâÈíÆ</div>
                </div>
                <div class="component" draggable="true" data-type="image">
                    <div class="component-icon">üñºÔ∏è</div>
                    <div>ÂõæÁâá</div>
                </div>
                <div class="component" draggable="true" data-type="input">
                    <div class="component-icon">üì•</div>
                    <div>ËæìÂÖ•Ê°Ü</div>
                </div>
                <div class="component" draggable="true" data-type="textarea">
                    <div class="component-icon">üìÑ</div>
                    <div>Â§öË°åÊñáÊú¨</div>
                </div>
                <div class="component" draggable="true" data-type="video">
                    <div class="component-icon">üé¨</div>
                    <div>ËßÜÈ¢ë</div>
                </div>
                <div class="component" draggable="true" data-type="audio">
                    <div class="component-icon">üéµ</div>
                    <div>Èü≥È¢ë</div>
                </div>
                <div class="component" draggable="true" data-type="progress">
                    <div class="component-icon">üìä</div>
                    <div>ËøõÂ∫¶Êù°</div>
                </div>
                <div class="component" draggable="true" data-type="table">
                    <div class="component-icon">üìã</div>
                    <div>Ë°®Ê†º</div>
                </div>
            </div>
        </div>
        
        <div class="sidebar-section">
            <h3>Ë°®ÂçïÁªÑ‰ª∂</h3>
            <div class="component-list">
                <div class="component" draggable="true" data-type="form">
                    <div class="component-icon">üìã</div>
                    <div>Ë°®Âçï</div>
                </div>
                <div class="component" draggable="true" data-type="checkbox">
                    <div class="component-icon">‚òëÔ∏è</div>
                    <div>Â§çÈÄâÊ°Ü</div>
                </div>
                <div class="component" draggable="true" data-type="radio">
                    <div class="component-icon">üîò</div>
                    <div>ÂçïÈÄâÊåâÈíÆ</div>
                </div>
                <div class="component" draggable="true" data-type="select">
                    <div class="component-icon">üîΩ</div>
                    <div>‰∏ãÊãâÊ°Ü</div>
                </div>
                <div class="component" draggable="true" data-type="range">
                    <div class="component-icon">üéöÔ∏è</div>
                    <div>ÊªëÂùó</div>
                </div>
                <div class="component" draggable="true" data-type="date">
                    <div class="component-icon">üìÖ</div>
                    <div>Êó•ÊúüÈÄâÊã©</div>
                </div>
                <div class="component" draggable="true" data-type="file">
                    <div class="component-icon">üìé</div>
                    <div>Êñá‰ª∂‰∏ä‰º†</div>
                </div>
                <div class="component" draggable="true" data-type="submit">
                    <div class="component-icon">‚úÖ</div>
                    <div>Êèê‰∫§ÊåâÈíÆ</div>
                </div>
            </div>
        </div>
        
        <div class="sidebar-section">
            <h3>Â∏ÉÂ±ÄÁªÑ‰ª∂</h3>
            <div class="component-list">
                <div class="component" draggable="true" data-type="row">
                    <div class="component-icon">‚ÜîÔ∏è</div>
                    <div>Ë°å</div>
                </div>
                <div class="component" draggable="true" data-type="column">
                    <div class="component-icon">‚ÜïÔ∏è</div>
                    <div>Âàó</div>
                </div>
                <div class="component" draggable="true" data-type="grid">
                    <div class="component-icon">‚èπÔ∏è</div>
                    <div>ÁΩëÊ†º</div>
                </div>
                <div class="component" draggable="true" data-type="card">
                    <div class="component-icon">üÉè</div>
                    <div>Âç°Áâá</div>
                </div>
                <div class="component" draggable="true" data-type="section">
                    <div class="component-icon">üìë</div>
                    <div>Âå∫Âùó</div>
                </div>
                <div class="component" draggable="true" data-type="divider">
                    <div class="component-icon">‚ûñ</div>
                    <div>ÂàÜÈöîÁ∫ø</div>
                </div>
            </div>
        </div>
        
        <div class="sidebar-section">
            <h3>È´òÁ∫ßÁªÑ‰ª∂</h3>
            <div class="component-list">
                <div class="component" draggable="true" data-type="carousel">
                    <div class="component-icon">üñºÔ∏èüîÑ</div>
                    <div>ËΩÆÊí≠Âõæ</div>
                </div>
                <div class="component" draggable="true" data-type="accordion">
                    <div class="component-icon">üìëüìë</div>
                    <div>ÊâãÈ£éÁê¥</div>
                </div>
                <div class="component" draggable="true" data-type="tabs">
                    <div class="component-icon">üìëüìëüìë</div>
                    <div>Ê†áÁ≠æÈ°µ</div>
                </div>
                <div class="component" draggable="true" data-type="modal">
                    <div class="component-icon">ü™ü</div>
                    <div>Ê®°ÊÄÅÊ°Ü</div>
                </div>
                <div class="component" draggable="true" data-type="navbar">
                    <div class="component-icon">üì±</div>
                    <div>ÂØºËà™Ê†è</div>
                </div>
                <div class="component" draggable="true" data-type="sidebar">
                    <div class="component-icon">üìö</div>
                    <div>‰æßËæπÊ†è</div>
                </div>
                <div class="component" draggable="true" data-type="footer">
                    <div class="component-icon">üîª</div>
                    <div>È°µËÑö</div>
                </div>
                <div class="component" draggable="true" data-type="map">
                    <div class="component-icon">üó∫Ô∏è</div>
                    <div>Âú∞Âõæ</div>
                </div>
            </div>
        </div>
        
        <div class="sidebar-section">
            <h3>È¢ÑËÆæÊ®°Êùø</h3>
            <div class="component-list">
                <div class="template-item">
                    <div class="template-preview" data-template="landing">
                        <img src="https://via.placeholder.com/200x80/3498db/ffffff?text=Landing+Page" alt="Landing Page">
                    </div>
                    <h4>ËêΩÂú∞È°µ</h4>
                </div>
                <div class="template-item">
                    <div class="template-preview" data-template="contact">
                        <img src="https://via.placeholder.com/200x80/e74c3c/ffffff?text=Contact+Form" alt="Contact Form">
                    </div>
                    <h4>ËÅîÁ≥ªË°®Âçï</h4>
                </div>
                <div class="template-item">
                    <div class="template-preview" data-template="dashboard">
                        <img src="https://via.placeholder.com/200x80/2ecc71/ffffff?text=Dashboard" alt="Dashboard">
                    </div>
                    <h4>‰ª™Ë°®Áõò</h4>
                </div>
                <div class="template-item">
                    <div class="template-preview" data-template="blog">
                        <img src="https://via.placeholder.com/200x80/9b59b6/ffffff?text=Blog+Post" alt="Blog Post">
                    </div>
                    <h4>ÂçöÂÆ¢ÊñáÁ´†</h4>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ‰∏≠Èó¥Â∑•‰ΩúÂå∫ -->
    <div class="workspace">
        <div class="toolbar">
            <div class="toolbar-group">
                <div class="device-selector">
                    <button class="toolbar-btn active" data-device="desktop">PCÁ´Ø</button>
                    <button class="toolbar-btn" data-device="mobile">ÁßªÂä®Á´Ø</button>
                    <button class="toolbar-btn" data-device="tablet">Âπ≥Êùø</button>
                    <button class="toolbar-btn" data-device="weapp">Â∞èÁ®ãÂ∫è</button>
                </div>
            </div>
            
            <div class="toolbar-group">
                <button class="toolbar-btn" id="undo-btn" title="Êí§ÈîÄ (Ctrl+Z)">‚Ü©Ô∏è Êí§ÈîÄ</button>
                <button class="toolbar-btn" id="redo-btn" title="ÈáçÂÅö (Ctrl+Y)">‚Ü™Ô∏è ÈáçÂÅö</button>
                <button class="toolbar-btn" id="clear-btn" title="Ê∏ÖÁ©∫ÁîªÂ∏É">üóëÔ∏è Ê∏ÖÁ©∫</button>
            </div>
            
            <div class="toolbar-group">
                <button class="toolbar-btn" id="preview-btn">üëÅÔ∏è È¢ÑËßà</button>
                <button class="toolbar-btn" id="export-btn">üíæ ÂØºÂá∫‰ª£Á†Å</button>
                <input type="file" id="upload-file" accept=".html,.htm,.json" style="display: none;">
                <button class="toolbar-btn" id="upload-btn">üì§ ÂØºÂÖ•</button>
                <button class="toolbar-btn" id="save-btn">üíæ ‰øùÂ≠ò</button>
            </div>
        </div>
        
        <div class="preview-container">
            <div class="preview-frame" id="preview-frame" style="width: 100%; min-height: 100%;">
                <div class="droppable" id="canvas" style="min-height: 100%;">
                    <!-- ËøôÈáåÊòØÂèØÊãñÊîæÁöÑÁîªÂ∏ÉÂå∫Âüü -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- Âè≥‰æßÂ±ûÊÄßÈù¢Êùø -->
    <div class="properties-panel" id="properties-panel">
        <div class="tab-container">
            <div class="tab active" data-tab="properties">Â±ûÊÄß</div>
            <div class="tab" data-tab="styles">Ê†∑Âºè</div>
            <div class="tab" data-tab="events">‰∫ã‰ª∂</div>
            <div class="tab" data-tab="code">‰ª£Á†Å</div>
            <div class="tab" data-tab="settings">ËÆæÁΩÆ</div>
        </div>
        
        <div id="properties-content">
            <div class="property-item">
                <label>ÂÖÉÁ¥†Á±ªÂûã</label>
                <input type="text" id="prop-type" readonly>
            </div>
            <div class="property-item">
                <label>ID</label>
                <input type="text" id="prop-id" placeholder="ÂîØ‰∏ÄÊ†áËØÜÁ¨¶">
            </div>
            <div class="property-item">
                <label>Á±ªÂêç</label>
                <input type="text" id="prop-class" placeholder="Á©∫Ê†ºÂàÜÈöîÁöÑÁ±ªÂêç">
            </div>
            <div class="property-item">
                <label>ÊñáÊú¨ÂÜÖÂÆπ</label>
                <input type="text" id="prop-text">
            </div>
            <div class="property-item">
                <label>ËÉåÊôØÈ¢úËâ≤</label>
                <div class="color-picker">
                    <input type="color" id="prop-bgcolor">
                    <input type="text" id="prop-bgcolor-text" placeholder="#ffffff">
                </div>
            </div>
            <div class="property-item">
                <label>ËæπÊ°Ü</label>
                <input type="text" id="prop-border" placeholder="1px solid #000">
            </div>
            <div class="property-item">
                <label>ËæπÊ°ÜÂçäÂæÑ</label>
                <input type="text" id="prop-border-radius" placeholder="4px">
            </div>
            <div class="property-item">
                <label>ÂèØËßÅÊÄß</label>
                <select id="prop-visible">
                    <option value="visible">ÂèØËßÅ</option>
                    <option value="hidden">ÈöêËóè</option>
                    <option value="none">‰∏çÊòæÁ§∫</option>
                </select>
            </div>
            <div class="property-item">
                <label>Êï∞ÊçÆÁªëÂÆö</label>
                <input type="text" id="prop-data-bind" placeholder="Êï∞ÊçÆÂ≠óÊÆµÂêç">
            </div>
        </div>
        
        <div id="styles-content" style="display: none;">
            <div class="property-item">
                <label>ÂÆΩÂ∫¶</label>
                <input type="text" id="style-width" placeholder="‰æãÂ¶Ç: 100px Êàñ 50%">
            </div>
            <div class="property-item">
                <label>È´òÂ∫¶</label>
                <input type="text" id="style-height" placeholder="‰æãÂ¶Ç: 100px Êàñ 50%">
            </div>
            <div class="property-item">
                <label>‰ΩçÁΩÆ</label>
                <select id="style-position">
                    <option value="static">static</option>
                    <option value="relative">relative</option>
                    <option value="absolute">absolute</option>
                    <option value="fixed">fixed</option>
                    <option value="sticky">sticky</option>
                </select>
            </div>
            <div class="property-item">
                <label>‰∏äËæπË∑ù</label>
                <input type="text" id="style-top" placeholder="‰æãÂ¶Ç: 10px">
            </div>
            <div class="property-item">
                <label>Â∑¶ËæπË∑ù</label>
                <input type="text" id="style-left" placeholder="‰æãÂ¶Ç: 10px">
            </div>
            <div class="property-item">
                <label>Â§ñËæπË∑ù</label>
                <input type="text" id="style-margin" placeholder="‰æãÂ¶Ç: 10px Êàñ 10px 5px">
            </div>
            <div class="property-item">
                <label>ÂÜÖËæπË∑ù</label>
                <input type="text" id="style-padding" placeholder="‰æãÂ¶Ç: 10px Êàñ 10px 5px">
            </div>
            <div class="property-item">
                <label>Â≠ó‰ΩìÂ§ßÂ∞è</label>
                <input type="text" id="style-font-size" placeholder="‰æãÂ¶Ç: 16px">
            </div>
            <div class="property-item">
                <label>Â≠ó‰ΩìÈ¢úËâ≤</label>
                <div class="color-picker">
                    <input type="color" id="style-color">
                    <input type="text" id="style-color-text" placeholder="#000000">
                </div>
            </div>
            <div class="property-item">
                <label>Â≠ó‰ΩìÁ≤óÁªÜ</label>
                <select id="style-font-weight">
                    <option value="normal">normal</option>
                    <option value="bold">bold</option>
                    <option value="bolder">bolder</option>
                    <option value="lighter">lighter</option>
                    <option value="100">100</option>
                    <option value="200">200</option>
                    <option value="300">300</option>
                    <option value="400">400</option>
                    <option value="500">500</option>
                    <option value="600">600</option>
                    <option value="700">700</option>
                    <option value="800">800</option>
                    <option value="900">900</option>
                </select>
            </div>
            <div class="property-item">
                <label>ÊñáÊú¨ÂØπÈΩê</label>
                <select id="style-text-align">
                    <option value="left">left</option>
                    <option value="right">right</option>
                    <option value="center">center</option>
                    <option value="justify">justify</option>
                </select>
            </div>
            <div class="property-item">
                <label>ÊòæÁ§∫ÊñπÂºè</label>
                <select id="style-display">
                    <option value="block">block</option>
                    <option value="inline">inline</option>
                    <option value="inline-block">inline-block</option>
                    <option value="flex">flex</option>
                    <option value="grid">grid</option>
                    <option value="none">none</option>
                </select>
            </div>
            <div class="property-item">
                <label>Flex ÊñπÂêë</label>
                <select id="style-flex-direction">
                    <option value="row">row</option>
                    <option value="row-reverse">row-reverse</option>
                    <option value="column">column</option>
                    <option value="column-reverse">column-reverse</option>
                </select>
            </div>
            <div class="property-item">
                <label>Flex ÂØπÈΩê</label>
                <select id="style-justify-content">
                    <option value="flex-start">flex-start</option>
                    <option value="flex-end">flex-end</option>
                    <option value="center">center</option>
                    <option value="space-between">space-between</option>
                    <option value="space-around">space-around</option>
                    <option value="space-evenly">space-evenly</option>
                </select>
            </div>
        </div>
        
        <div id="events-content" style="display: none;">
            <div class="property-item">
                <label>ÁÇπÂáª‰∫ã‰ª∂</label>
                <select id="event-click">
                    <option value="">Êó†</option>
                    <option value="alert">ÊòæÁ§∫ÊèêÁ§∫</option>
                    <option value="navigate">ÂØºËà™</option>
                    <option value="toggle">ÂàáÊç¢ÊòæÁ§∫</option>
                    <option value="submit">Êèê‰∫§Ë°®Âçï</option>
                    <option value="custom">Ëá™ÂÆö‰πâ</option>
                </select>
            </div>
            <div class="property-item" id="custom-click-container" style="display: none;">
                <label>Ëá™ÂÆö‰πâ‰ª£Á†Å</label>
                <textarea id="event-click-custom" rows="3" placeholder="function(event) { ... }"></textarea>
            </div>
            
            <div class="property-item">
                <label>Èº†Ê†áÊÇ¨ÂÅú‰∫ã‰ª∂</label>
                <select id="event-hover">
                    <option value="">Êó†</option>
                    <option value="tooltip">ÊòæÁ§∫Â∑•ÂÖ∑ÊèêÁ§∫</option>
                    <option value="highlight">È´ò‰∫ÆÂÖÉÁ¥†</option>
                    <option value="custom">Ëá™ÂÆö‰πâ</option>
                </select>
            </div>
            <div class="property-item" id="custom-hover-container" style="display: none;">
                <label>Ëá™ÂÆö‰πâ‰ª£Á†Å</label>
                <textarea id="event-hover-custom" rows="3" placeholder="function(event) { ... }"></textarea>
            </div>
            
            <div class="property-item">
                <label>ËæìÂÖ•ÂèòÂåñ‰∫ã‰ª∂</label>
                <select id="event-change">
                    <option value="">Êó†</option>
                    <option value="validate">È™åËØÅËæìÂÖ•</option>
                    <option value="update">Êõ¥Êñ∞ËßÜÂõæ</option>
                    <option value="custom">Ëá™ÂÆö‰πâ</option>
                </select>
            </div>
            <div class="property-item" id="custom-change-container" style="display: none;">
                <label>Ëá™ÂÆö‰πâ‰ª£Á†Å</label>
                <textarea id="event-change-custom" rows="3" placeholder="function(event) { ... }"></textarea>
            </div>
        </div>
        
        <div id="code-content" style="display: none;">
            <div class="property-item">
                <label>ÂÖÉÁ¥†HTML</label>
                <textarea class="code-editor" id="element-html" readonly></textarea>
            </div>
            <div class="property-item">
                <label>Ëá™ÂÆö‰πâCSS</label>
                <textarea class="code-editor" id="element-css"></textarea>
            </div>
            <div class="property-item">
                <label>Ëá™ÂÆö‰πâJS</label>
                <textarea class="code-editor" id="element-js"></textarea>
            </div>
            <div class="property-item">
                <button class="toolbar-btn" id="apply-code-btn">Â∫îÁî®‰ª£Á†Å</button>
            </div>
        </div>
        
        <div id="settings-content" style="display: none;">
            <div class="property-item">
                <label>ÁîªÂ∏ÉÂÆΩÂ∫¶</label>
                <input type="text" id="setting-canvas-width" placeholder="‰æãÂ¶Ç: 1200px">
            </div>
            <div class="property-item">
                <label>ÁîªÂ∏ÉËÉåÊôØ</label>
                <div class="color-picker">
                    <input type="color" id="setting-canvas-bgcolor">
                    <input type="text" id="setting-canvas-bgcolor-text" placeholder="#ffffff">
                </div>
            </div>
            <div class="property-item">
                <label>ÁΩëÊ†ºÊòæÁ§∫</label>
                <select id="setting-grid-show">
                    <option value="true">ÊòæÁ§∫</option>
                    <option value="false">ÈöêËóè</option>
                </select>
            </div>
            <div class="property-item">
                <label>ÁΩëÊ†ºÂ§ßÂ∞è</label>
                <input type="number" id="setting-grid-size" placeholder="‰æãÂ¶Ç: 10" value="10">
            </div>
            <div class="property-item">
                <label>ÁΩëÊ†ºÈ¢úËâ≤</label>
                <div class="color-picker">
                    <input type="color" id="setting-grid-color" value="#e0e0e0">
                    <input type="text" id="setting-grid-color-text" placeholder="#e0e0e0" value="#e0e0e0">
                </div>
            </div>
            <div class="property-item">
                <label>Ëá™Âä®‰øùÂ≠ò</label>
                <select id="setting-autosave">
                    <option value="true">ÂêØÁî®</option>
                    <option value="false">Á¶ÅÁî®</option>
                </select>
            </div>
            <div class="property-item">
                <label>‰øùÂ≠òÈó¥Èöî(Áßí)</label>
                <input type="number" id="setting-autosave-interval" value="30" min="5">
            </div>
            <div class="history-controls">
                <button class="toolbar-btn" id="import-settings-btn">ÂØºÂÖ•ËÆæÁΩÆ</button>
                <button class="toolbar-btn" id="export-settings-btn">ÂØºÂá∫ËÆæÁΩÆ</button>
            </div>
        </div>
        
        <div class="history-controls">
            <button class="toolbar-btn" id="history-btn">ÂéÜÂè≤ËÆ∞ÂΩï</button>
            <button class="toolbar-btn" id="collab-btn">Âçè‰ΩúÊ®°Âºè</button>
        </div>
    </div>

    <script>
        // ÂΩìÂâçÈÄâ‰∏≠ÁöÑÂÖÉÁ¥†
        let selectedElement = null;
        // ËÆæÂ§áÁ±ªÂûã
        let currentDevice = 'desktop';
        // ÂéÜÂè≤ËÆ∞ÂΩï
        let historyStack = [];
        let historyIndex = -1;
        // Âçè‰ΩúÁä∂ÊÄÅ
        let collaborationMode = false;
        // Âçè‰ΩúÁî®Êà∑
        let collaborators = {};
        // ÁªÑ‰ª∂Â∫ì
        const componentLibrary = {};
        // Ê®°ÊùøÂ∫ì
        const templateLibrary = {
            landing: {
                name: "ËêΩÂú∞È°µ",
                html: `<div class="container" style="width: 100%; max-width: 1200px; margin: 0 auto; padding: 20px;">
    <header style="display: flex; justify-content: space-between; align-items: center; padding: 20px 0; border-bottom: 1px solid #eee;">
        <div style="font-size: 24px; font-weight: bold;">ÂÖ¨Âè∏Logo</div>
        <nav style="display: flex; gap: 20px;">
            <a href="#" style="text-decoration: none; color: #333;">È¶ñÈ°µ</a>
            <a href="#" style="text-decoration: none; color: #333;">‰∫ßÂìÅ</a>
            <a href="#" style="text-decoration: none; color: #333;">ÂÖ≥‰∫é</a>
            <a href="#" style="text-decoration: none; color: #333;">ËÅîÁ≥ª</a>
        </nav>
    </header>
    
    <section style="padding: 80px 0; text-align: center;">
        <h1 style="font-size: 48px; margin-bottom: 20px;">Ê¨¢ËøéÊù•Âà∞Êàë‰ª¨ÁöÑÁΩëÁ´ô</h1>
        <p style="font-size: 18px; margin-bottom: 30px; max-width: 700px; margin-left: auto; margin-right: auto;">
            ËøôÊòØ‰∏Ä‰∏™Áé∞‰ª£ÂåñÁöÑËêΩÂú∞È°µÊ®°ÊùøÔºåÊÇ®ÂèØ‰ª•ËΩªÊùæÂú∞Ëá™ÂÆö‰πâÂÆÉÊù•Êª°Ë∂≥ÊÇ®ÁöÑÈúÄÊ±Ç„ÄÇ
        </p>
        <button style="padding: 12px 24px; background-color: #3498db; color: white; border: none; border-radius: 4px; font-size: 16px; cursor: pointer;">
            ‰∫ÜËß£Êõ¥Â§ö
        </button>
    </section>
    
    <section style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 30px; padding: 50px 0;">
        <div style="padding: 20px; border: 1px solid #eee; border-radius: 4px;">
            <h3 style="margin-bottom: 15px;">ÁâπÊÄß‰∏Ä</h3>
            <p>ËøôÈáåÊòØÁâπÊÄß‰∏ÄÁöÑÊèèËø∞ÂÜÖÂÆπÔºåËØ¥ÊòéËøô‰∏™ÁâπÊÄßÁöÑ‰ºòÂäøÂíåÁâπÁÇπ„ÄÇ</p>
        </div>
        <div style="padding: 20px; border: 1px solid #eee; border-radius: 4px;">
            <h3 style="margin-bottom: 15px;">ÁâπÊÄß‰∫å</h3>
            <p>ËøôÈáåÊòØÁâπÊÄß‰∫åÁöÑÊèèËø∞ÂÜÖÂÆπÔºåËØ¥ÊòéËøô‰∏™ÁâπÊÄßÁöÑ‰ºòÂäøÂíåÁâπÁÇπ„ÄÇ</p>
        </div>
        <div style="padding: 20px; border: 1px solid #eee; border-radius: 4px;">
            <h3 style="margin-bottom: 15px;">ÁâπÊÄß‰∏â</h3>
            <p>ËøôÈáåÊòØÁâπÊÄß‰∏âÁöÑÊèèËø∞ÂÜÖÂÆπÔºåËØ¥ÊòéËøô‰∏™ÁâπÊÄßÁöÑ‰ºòÂäøÂíåÁâπÁÇπ„ÄÇ</p>
        </div>
    </section>
    
    <footer style="padding: 30px 0; text-align: center; border-top: 1px solid #eee; margin-top: 50px;">
        <p>¬© 2023 ÂÖ¨Âè∏ÂêçÁß∞. ‰øùÁïôÊâÄÊúâÊùÉÂà©.</p>
    </footer>
</div>`
            },
            contact: {
                name: "ËÅîÁ≥ªË°®Âçï",
                html: `<div class="container" style="width: 100%; max-width: 600px; margin: 0 auto; padding: 40px 20px;">
    <h2 style="text-align: center; margin-bottom: 30px;">ËÅîÁ≥ªÊàë‰ª¨</h2>
    <form style="display: grid; gap: 20px;">
        <div>
            <label style="display: block; margin-bottom: 5px; font-weight: bold;">ÂßìÂêç</label>
            <input type="text" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
        </div>
        <div>
            <label style="display: block; margin-bottom: 5px; font-weight: bold;">ÈÇÆÁÆ±</label>
            <input type="email" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
        </div>
        <div>
            <label style="display: block; margin-bottom: 5px; font-weight: bold;">‰∏ªÈ¢ò</label>
            <select style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                <option>Âí®ËØ¢</option>
                <option>Âª∫ËÆÆ</option>
                <option>ÊäïËØâ</option>
                <option>ÂÖ∂‰ªñ</option>
            </select>
        </div>
        <div>
            <label style="display: block; margin-bottom: 5px; font-weight: bold;">Ê∂àÊÅØ</label>
            <textarea style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; min-height: 150px;"></textarea>
        </div>
        <button type="submit" style="padding: 12px 24px; background-color: #3498db; color: white; border: none; border-radius: 4px; font-size: 16px; cursor: pointer;">
            Êèê‰∫§
        </button>
    </form>
</div>`
            },
            dashboard: {
                name: "‰ª™Ë°®Áõò",
                html: `<div class="container" style="width: 100%; height: 100vh; display: grid; grid-template-columns: 250px 1fr; grid-template-rows: 60px 1fr;">
    <header style="grid-column: 1 / 3; background-color: #2c3e50; color: white; display: flex; align-items: center; padding: 0 20px;">
        <h2 style="margin: 0;">‰ª™Ë°®Áõò</h2>
    </header>
    
    <aside style="background-color: #34495e; color: white; padding: 20px;">
        <nav style="display: grid; gap: 10px;">
            <a href="#" style="color: white; text-decoration: none; padding: 10px; border-radius: 4px; background-color: #3498db;">Ê¶ÇËßà</a>
            <a href="#" style="color: white; text-decoration: none; padding: 10px; border-radius: 4px;">ÂàÜÊûê</a>
            <a href="#" style="color: white; text-decoration: none; padding: 10px; border-radius: 4px;">Êä•Âëä</a>
            <a href="#" style="color: white; text-decoration: none; padding: 10px; border-radius: 4px;">ËÆæÁΩÆ</a>
        </nav>
    </aside>
    
    <main style="padding: 20px; background-color: #ecf0f1;">
        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px;">
            <div style="background-color: white; padding: 20px; border-radius: 4px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                <h3 style="margin-top: 0;">Áî®Êà∑Êï∞</h3>
                <p style="font-size: 24px; font-weight: bold; margin: 0;">1,234</p>
            </div>
            <div style="background-color: white; padding: 20px; border-radius: 4px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                <h3 style="margin-top: 0;">Êî∂ÂÖ•</h3>
                <p style="font-size: 24px; font-weight: bold; margin: 0;">$12,345</p>
            </div>
            <div style="background-color: white; padding: 20px; border-radius: 4px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                <h3 style="margin-top: 0;">ËΩ¨ÂåñÁéá</h3>
                <p style="font-size: 24px; font-weight: bold; margin: 0;">3.2%</p>
            </div>
            <div style="background-color: white; padding: 20px; border-radius: 4px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                <h3 style="margin-top: 0;">Ê¥ªË∑ÉÂ∫¶</h3>
                <p style="font-size: 24px; font-weight: bold; margin: 0;">78%</p>
            </div>
        </div>
        
        <div style="background-color: white; padding: 20px; border-radius: 4px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 20px;">
            <h3 style="margin-top: 0;">Êï∞ÊçÆË∂ãÂäø</h3>
            <div style="height: 300px; background-color: #f9f9f9; display: flex; justify-content: center; align-items: center;">
                ÂõæË°®Âå∫Âüü
            </div>
        </div>
        
        <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 20px;">
            <div style="background-color: white; padding: 20px; border-radius: 4px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                <h3 style="margin-top: 0;">ÊúÄËøëÊ¥ªÂä®</h3>
                <div style="height: 300px; overflow-y: auto;">
                    <div style="padding: 10px 0; border-bottom: 1px solid #eee;">Áî®Êà∑A ÂÆåÊàê‰∫ÜËÆ¢Âçï #1234</div>
                    <div style="padding: 10px 0; border-bottom: 1px solid #eee;">Áî®Êà∑B Ê≥®ÂÜå‰∫ÜÊñ∞Ë¥¶Êà∑</div>
                    <div style="padding: 10px 0; border-bottom: 1px solid #eee;">Á≥ªÁªü ËøõË°å‰∫ÜÊó•Â∏∏Â§á‰ªΩ</div>
                    <div style="padding: 10px 0; border-bottom: 1px solid #eee;">Áî®Êà∑C Êèê‰∫§‰∫ÜÂèçÈ¶à</div>
                    <div style="padding: 10px 0; border-bottom: 1px solid #eee;">ÁÆ°ÁêÜÂëò Êõ¥Êñ∞‰∫ÜÁ≥ªÁªüËÆæÁΩÆ</div>
                </div>
            </div>
            <div style="background-color: white; padding: 20px; border-radius: 4px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                <h3 style="margin-top: 0;">Âø´ÈÄüÊìç‰Ωú</h3>
                <div style="display: grid; gap: 10px;">
                    <button style="padding: 10px; background-color: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer;">Ê∑ªÂä†Áî®Êà∑</button>
                    <button style="padding: 10px; background-color: #2ecc71; color: white; border: none; border-radius: 4px; cursor: pointer;">ÁîüÊàêÊä•Âëä</button>
                    <button style="padding: 10px; background-color: #e74c3c; color: white; border: none; border-radius: 4px; cursor: pointer;">ÂèëÈÄÅÈÄöÁü•</button>
                </div>
            </div>
        </div>
    </main>
</div>`
            },
            blog: {
                name: "ÂçöÂÆ¢ÊñáÁ´†",
                html: `<div class="container" style="width: 100%; max-width: 800px; margin: 0 auto; padding: 40px 20px;">
    <article>
        <header style="margin-bottom: 40px;">
            <h1 style="font-size: 36px; margin-bottom: 10px;">ÂçöÂÆ¢ÊñáÁ´†Ê†áÈ¢ò</h1>
            <div style="display: flex; align-items: center; gap: 15px; color: #777; margin-bottom: 20px;">
                <span>‰ΩúËÄÖ: Âº†‰∏â</span>
                <span>ÂèëÂ∏ÉÊó•Êúü: 2023-01-01</span>
            </div>
            <img src="https://via.placeholder.com/800x400" alt="ÊñáÁ´†Â∞ÅÈù¢Âõæ" style="width: 100%; height: auto; border-radius: 4px;">
        </header>
        
        <div style="line-height: 1.6; font-size: 18px;">
            <p style="margin-bottom: 20px;">ËøôÊòØÊñáÁ´†ÁöÑÂºïË®ÄÈÉ®ÂàÜÔºåÈÄöÂ∏∏Áî®Êù•Ê¶ÇËø∞ÊñáÁ´†ÁöÑ‰∏ªË¶ÅÂÜÖÂÆπÔºåÂê∏ÂºïËØªËÄÖÁªßÁª≠ÈòÖËØª„ÄÇ</p>
            
            <h2 style="margin-top: 40px; margin-bottom: 20px;">Á¨¨‰∏ÄÈÉ®ÂàÜÊ†áÈ¢ò</h2>
            <p style="margin-bottom: 20px;">ËøôÊòØÁ¨¨‰∏ÄÈÉ®ÂàÜÁöÑÂÜÖÂÆπ„ÄÇÂçöÂÆ¢ÊñáÁ´†ÈÄöÂ∏∏ÂåÖÂê´Â§ö‰∏™ÈÉ®ÂàÜÔºåÊØè‰∏™ÈÉ®ÂàÜËÆ®ËÆ∫‰∏Ä‰∏™ÁâπÂÆöÁöÑ‰∏ªÈ¢òÊàñËßÇÁÇπ„ÄÇ</p>
            
            <h2 style="margin-top: 40px; margin-bottom: 20px;">Á¨¨‰∫åÈÉ®ÂàÜÊ†áÈ¢ò</h2>
            <p style="margin-bottom: 20px;">ËøôÊòØÁ¨¨‰∫åÈÉ®ÂàÜÁöÑÂÜÖÂÆπ„ÄÇÂèØ‰ª•‰ΩøÁî®ÂõæÁâá„ÄÅÂàóË°®„ÄÅÂºïÁî®Á≠âÂÖÉÁ¥†Êù•‰∏∞ÂØåÊñáÁ´†ÂÜÖÂÆπ„ÄÇ</p>
            
            <blockquote style="border-left: 4px solid #3498db; padding-left: 15px; margin: 20px 0; color: #555;">
                ËøôÊòØ‰∏Ä‰∏™ÂºïÁî®Á§∫‰æãÔºåÂèØ‰ª•Áî®Êù•Á™ÅÂá∫ÊòæÁ§∫ÈáçË¶ÅÁöÑËßÇÁÇπÊàñ‰ªñ‰∫∫ÁöÑË®ÄËÆ∫„ÄÇ
            </blockquote>
            
            <h2 style="margin-top: 40px; margin-bottom: 20px;">Á¨¨‰∏âÈÉ®ÂàÜÊ†áÈ¢ò</h2>
            <p style="margin-bottom: 20px;">ËøôÊòØÁ¨¨‰∏âÈÉ®ÂàÜÁöÑÂÜÖÂÆπ„ÄÇÊñáÁ´†ÁöÑÊúÄÂêéÈÄöÂ∏∏ÂåÖÂê´ÊÄªÁªìÊàñÁªìËÆ∫„ÄÇ</p>
            
            <ul style="margin-bottom: 20px; padding-left: 20px;">
                <li>ÂàóË°®È°π‰∏Ä</li>
                <li>ÂàóË°®È°π‰∫å</li>
                <li>ÂàóË°®È°π‰∏â</li>
            </ul>
            
            <p style="margin-bottom: 20px;">ÊñáÁ´†ÁöÑÁªìÂ∞æÈÉ®ÂàÜÔºåÂèØ‰ª•ÊÄªÁªì‰∏ªË¶ÅËßÇÁÇπÊàñÊèêÂá∫ÈóÆÈ¢ò‰æõËØªËÄÖÊÄùËÄÉ„ÄÇ</p>
        </div>
        
        <footer style="margin-top: 50px; padding-top: 20px; border-top: 1px solid #eee;">
            <div style="display: flex; gap: 15px; margin-bottom: 20px;">
                <span>Ê†áÁ≠æ: </span>
                <a href="#" style="color: #3498db; text-decoration: none;">ÊäÄÊúØ</a>
                <a href="#" style="color: #3498db; text-decoration: none;">ËÆæËÆ°</a>
                <a href="#" style="color: #3498db; text-decoration: none;">ÂºÄÂèë</a>
            </div>
            
            <div style="display: flex; justify-content: space-between;">
                <button style="padding: 8px 16px; background-color: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer;">‰∏ä‰∏ÄÁØá</button>
                <button style="padding: 8px 16px; background-color: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer;">‰∏ã‰∏ÄÁØá</button>
            </div>
        </footer>
    </article>
    
    <section style="margin-top: 60px;">
        <h3 style="margin-bottom: 20px;">ËØÑËÆ∫ (3)</h3>
        
        <div style="margin-bottom: 30px; padding-bottom: 30px; border-bottom: 1px solid #eee;">
            <div style="display: flex; gap: 15px; margin-bottom: 10px;">
                <img src="https://via.placeholder.com/50" alt="Áî®Êà∑Â§¥ÂÉè" style="width: 50px; height: 50px; border-radius: 50%;">
                <div>
                    <div style="font-weight: bold;">ÊùéÂõõ</div>
                    <div style="color: #777; font-size: 14px;">2023-01-02 10:30</div>
                </div>
            </div>
            <p>ËøôÊòØ‰∏ÄÊù°ËØÑËÆ∫ÂÜÖÂÆπ„ÄÇËØªËÄÖÂèØ‰ª•Âú®ËøôÈáåÂàÜ‰∫´‰ªñ‰ª¨ÁöÑÊÉ≥Ê≥ïÂíåÂèçÈ¶à„ÄÇ</p>
        </div>
        
        <form style="margin-top: 40px;">
            <h3 style="margin-bottom: 20px;">ÂèëË°®ËØÑËÆ∫</h3>
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px;">ÂßìÂêç</label>
                <input type="text" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
            </div>
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px;">ÈÇÆÁÆ±</label>
                <input type="email" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
            </div>
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px;">ËØÑËÆ∫</label>
                <textarea style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; min-height: 120px;"></textarea>
            </div>
            <button type="submit" style="padding: 10px 20px; background-color: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer;">Êèê‰∫§ËØÑËÆ∫</button>
        </form>
    </section>
</div>`
            }
        };
        
        // ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            // ÊãñÊãΩÁõ∏ÂÖ≥‰∫ã‰ª∂
            setupDragAndDrop();
            
            // ËÆæÂ§áÂàáÊç¢
            setupDeviceSwitcher();
            
            // ÊåâÈíÆ‰∫ã‰ª∂
            setupButtons();
            
            // Â±ûÊÄßÈù¢ÊùøÊ†áÁ≠æÂàáÊç¢
            setupPropertyTabs();
            
            // ÂÖÉÁ¥†ÈÄâÊã©
            setupElementSelection();
            
            // ÂàùÂßãÂåñÂéÜÂè≤ËÆ∞ÂΩï
            saveHistory();
            
            // ‰æßËæπÊ†èÊäòÂè†
            setupSidebarSections();
            
            // ÁªÑ‰ª∂ÊêúÁ¥¢
            setupComponentSearch();
            
            // Ê®°ÊùøÁÇπÂáª
            setupTemplateClick();
            
            // Âø´Êç∑ÈîÆ
            setupKeyboardShortcuts();
            
            // ÂàùÂßãÂåñËÆæÁΩÆ
            loadSettings();
            
            // ËÆæÁΩÆÂÖÉÁ¥†ÊãñÂä®
            setupElementDragging();
        });
        
        // ËÆæÁΩÆÊãñÊãΩÂäüËÉΩ
        function setupDragAndDrop() {
            const components = document.querySelectorAll('.component[draggable="true"]');
            const canvas = document.getElementById('canvas');
            
            // ‰∏∫ÊØè‰∏™ÁªÑ‰ª∂Ê∑ªÂä†ÊãñÊãΩÂºÄÂßã‰∫ã‰ª∂
            components.forEach(component => {
                component.addEventListener('dragstart', function(e) {
                    e.dataTransfer.setData('text/plain', this.getAttribute('data-type'));
                    e.dataTransfer.effectAllowed = 'copy';
                });
            });
            
            // ÁîªÂ∏ÉÊãñÊãΩÁõ∏ÂÖ≥‰∫ã‰ª∂
            canvas.addEventListener('dragover', function(e) {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'copy';
                this.style.borderColor = '#3498db';
            });
            
            canvas.addEventListener('dragleave', function() {
                this.style.borderColor = '#7f8c8d';
            });
            
            canvas.addEventListener('drop', function(e) {
                e.preventDefault();
                this.style.borderColor = '#7f8c8d';
                
                const componentType = e.dataTransfer.getData('text/plain');
                if (!componentType) return;
                
                createNewElement(componentType, e.clientX, e.clientY);
            });
        }
        
        // ËÆæÁΩÆÂÖÉÁ¥†ÊãñÂä®ÂäüËÉΩ
        function setupElementDragging() {
            const canvas = document.getElementById('canvas');
            let draggedElement = null;
            let offsetX = 0;
            let offsetY = 0;
            
            canvas.addEventListener('mousedown', function(e) {
                let target = e.target;
                
                // Âêë‰∏äÊü•Êâæ.elementÂÖÉÁ¥†
                while (target && !target.classList.contains('element') && target !== this) {
                    target = target.parentElement;
                }
                
                if (target && target.classList.contains('element')) {
                    // ÈòªÊ≠¢ÂÜíÊ≥°ÔºåÈÅøÂÖç‰∏éÈÄâÊã©ÂÖÉÁ¥†ÂÜ≤Á™Å
                    e.stopPropagation();
                    
                    draggedElement = target;
                    const rect = target.getBoundingClientRect();
                    offsetX = e.clientX - rect.left;
                    offsetY = e.clientY - rect.top;
                    
                    // ËÆæÁΩÆÂÖÉÁ¥†Ê†∑Âºè
                    draggedElement.style.cursor = 'grabbing';
                    draggedElement.style.zIndex = '1000';
                }
            });
            
            document.addEventListener('mousemove', function(e) {
                if (draggedElement) {
                    draggedElement.style.left = (e.clientX - offsetX) + 'px';
                    draggedElement.style.top = (e.clientY - offsetY) + 'px';
                }
            });
            
            document.addEventListener('mouseup', function() {
                if (draggedElement) {
                    draggedElement.style.cursor = 'move';
                    draggedElement.style.zIndex = '';
                    draggedElement = null;
                    saveHistory();
                }
            });
        }
        
        // ÂàõÂª∫Êñ∞ÂÖÉÁ¥†
        function createNewElement(type, x, y) {
            const canvas = document.getElementById('canvas');
            const rect = canvas.getBoundingClientRect();
            const relativeX = x - rect.left;
            const relativeY = y - rect.top;
            
            const element = document.createElement('div');
            element.className = 'element';
            element.setAttribute('data-type', type);
            
            // Ê†πÊçÆÁ±ªÂûãËÆæÁΩÆ‰∏çÂêåÁöÑÂàùÂßãÂÜÖÂÆπ
            switch(type) {
                case 'container':
                    element.innerHTML = '<div class="droppable" style="min-height: 100px; background-color: #f5f5f5;">ÂÆπÂô®</div>';
                    break;
                case 'text':
                    element.textContent = 'ÂèåÂáªÁºñËæëÊñáÊú¨';
                    element.style.padding = '10px';
                    element.style.backgroundColor = 'transparent';
                    break;
                case 'button':
                    element.innerHTML = '<button style="padding: 8px 16px; background-color: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer;">ÊåâÈíÆ</button>';
                    element.style.backgroundColor = 'transparent';
                    break;
                case 'image':
                    element.innerHTML = '<img src="https://via.placeholder.com/150" alt="ÂõæÁâá" style="max-width: 100%; display: block;">';
                    element.style.backgroundColor = 'transparent';
                    break;
                case 'input':
                    element.innerHTML = '<input type="text" placeholder="ËæìÂÖ•Ê°Ü" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px; width: 100%;">';
                    element.style.backgroundColor = 'transparent';
                    break;
                case 'textarea':
                    element.innerHTML = '<textarea placeholder="Â§öË°åÊñáÊú¨" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px; width: 100%; min-height: 100px;"></textarea>';
                    element.style.backgroundColor = 'transparent';
                    break;
                case 'video':
                    element.innerHTML = '<div style="background-color: #000; width: 100%; height: 200px; display: flex; justify-content: center; align-items: center; color: white;">ËßÜÈ¢ëÊí≠ÊîæÂô®</div>';
                    break;
                case 'audio':
                    element.innerHTML = '<div style="background-color: #f5f5f5; width: 100%; padding: 15px; border-radius: 4px; text-align: center;">Èü≥È¢ëÊí≠ÊîæÂô®</div>';
                    break;
                case 'form':
                    element.innerHTML = '<form style="display: grid; gap: 15px; padding: 15px; background-color: #f5f5f5; border-radius: 4px;"><input type="text" placeholder="ÂßìÂêç"><input type="email" placeholder="ÈÇÆÁÆ±"><button type="submit" style="padding: 8px 16px; background-color: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer;">Êèê‰∫§</button></form>';
                    break;
                case 'checkbox':
                    element.innerHTML = '<label style="display: flex; align-items: center; gap: 8px;"><input type="checkbox"> Â§çÈÄâÊ°Ü</label>';
                    element.style.backgroundColor = 'transparent';
                    break;
                case 'radio':
                    element.innerHTML = '<label style="display: flex; align-items: center; gap: 8px;"><input type="radio" name="radio-group"> ÂçïÈÄâÊåâÈíÆ</label>';
                    element.style.backgroundColor = 'transparent';
                    break;
                case 'select':
                    element.innerHTML = '<select style="padding: 8px; border: 1px solid #ddd; border-radius: 4px; width: 100%;"><option>ÈÄâÈ°π1</option><option>ÈÄâÈ°π2</option><option>ÈÄâÈ°π3</option></select>';
                    element.style.backgroundColor = 'transparent';
                    break;
                case 'range':
                    element.innerHTML = '<div style="display: grid; gap: 5px;"><input type="range" style="width: 100%;"><div style="display: flex; justify-content: space-between;"><span>0</span><span>100</span></div></div>';
                    element.style.backgroundColor = 'transparent';
                    break;
                case 'date':
                    element.innerHTML = '<input type="date" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px; width: 100%;">';
                    element.style.backgroundColor = 'transparent';
                    break;
                case 'file':
                    element.innerHTML = '<div style="border: 2px dashed #ddd; padding: 20px; text-align: center; border-radius: 4px;"><div>ÁÇπÂáªÊàñÊãñÊãΩÊñá‰ª∂Âà∞Ê≠§Â§Ñ</div><input type="file" style="display: none;"></div>';
                    element.style.backgroundColor = 'transparent';
                    break;
                case 'submit':
                    element.innerHTML = '<button type="submit" style="padding: 10px 20px; background-color: #2ecc71; color: white; border: none; border-radius: 4px; cursor: pointer; width: 100%;">Êèê‰∫§</button>';
                    element.style.backgroundColor = 'transparent';
                    break;
                case 'row':
                    element.innerHTML = '<div class="droppable" style="display: flex; min-height: 50px; background-color: #f5f5f5; gap: 10px; padding: 10px;">Ë°åÂ∏ÉÂ±Ä</div>';
                    break;
                case 'column':
                    element.innerHTML = '<div class="droppable" style="display: flex; flex-direction: column; min-height: 50px; background-color: #f5f5f5; gap: 10px; padding: 10px;">ÂàóÂ∏ÉÂ±Ä</div>';
                    break;
                case 'grid':
                    element.innerHTML = '<div class="droppable" style="display: grid; grid-template-columns: repeat(2, 1fr); min-height: 50px; background-color: #f5f5f5; gap: 10px; padding: 10px;">ÁΩëÊ†ºÂ∏ÉÂ±Ä</div>';
                    break;
                case 'card':
                    element.innerHTML = '<div style="border: 1px solid #eee; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 4px rgba(0,0,0,0.1);"><img src="https://via.placeholder.com/300x200" alt="Âç°ÁâáÂõæÁâá" style="width: 100%; height: auto; display: block;"><div style="padding: 15px;"><h3 style="margin-top: 0;">Âç°ÁâáÊ†áÈ¢ò</h3><p style="margin-bottom: 0;">Âç°ÁâáÂÜÖÂÆπÊèèËø∞</p></div></div>';
                    break;
                case 'section':
                    element.innerHTML = '<div class="droppable" style="min-height: 100px; background-color: #f5f5f5; padding: 20px;">Âå∫Âùó</div>';
                    break;
                case 'divider':
                    element.innerHTML = '<hr style="border: none; border-top: 1px solid #ddd; margin: 20px 0;">';
                    element.style.backgroundColor = 'transparent';
                    element.style.padding = '0';
                    break;
                case 'carousel':
                    element.innerHTML = '<div class="carousel" style="width: 100%; height: 200px; background: #ddd; display: flex; justify-content: center; align-items: center; position: relative; overflow: hidden;"><div style="position: absolute; width: 100%; height: 100%; display: flex; transition: transform 0.5s;"><div style="min-width: 100%; background: #3498db; display: flex; justify-content: center; align-items: center; color: white;">ÂπªÁÅØÁâá1</div><div style="min-width: 100%; background: #e74c3c; display: flex; justify-content: center; align-items: center; color: white;">ÂπªÁÅØÁâá2</div><div style="min-width: 100%; background: #2ecc71; display: flex; justify-content: center; align-items: center; color: white;">ÂπªÁÅØÁâá3</div></div><button style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%); background: rgba(0,0,0,0.5); color: white; border: none; width: 30px; height: 30px; border-radius: 50%; cursor: pointer;">‚ùÆ</button><button style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: rgba(0,0,0,0.5); color: white; border: none; width: 30px; height: 30px; border-radius: 50%; cursor: pointer;">‚ùØ</button></div>';
                    break;
                case 'accordion':
                    element.innerHTML = '<div class="accordion" style="width: 100%;"><div class="accordion-item" style="margin-bottom: 5px;"><div style="background: #eee; padding: 10px; cursor: pointer;">Ê†áÈ¢ò1</div><div style="padding: 10px; background: #f9f9f9; display: none;">ÂÜÖÂÆπ1</div></div><div class="accordion-item" style="margin-bottom: 5px;"><div style="background: #eee; padding: 10px; cursor: pointer;">Ê†áÈ¢ò2</div><div style="padding: 10px; background: #f9f9f9; display: none;">ÂÜÖÂÆπ2</div></div></div>';
                    break;
                case 'tabs':
                    element.innerHTML = '<div class="tabs" style="width: 100%;"><div style="display: flex; border-bottom: 1px solid #ddd;"><div style="padding: 10px; border: 1px solid #ddd; border-bottom: none; margin-right: 5px; cursor: pointer; background: #f5f5f5;">Ê†áÁ≠æ1</div><div style="padding: 10px; border: 1px solid #ddd; border-bottom: none; cursor: pointer; background: #f5f5f5;">Ê†áÁ≠æ2</div></div><div style="padding: 15px; border: 1px solid #ddd; border-top: none; background: white;">Ê†áÁ≠æÂÜÖÂÆπ1</div></div>';
                    break;
                case 'modal':
                    element.innerHTML = '<div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; justify-content: center; align-items: center; z-index: 1000; display: none;"><div style="background: white; padding: 20px; border-radius: 4px; max-width: 500px; width: 100%;"><h3 style="margin-top: 0;">Ê®°ÊÄÅÊ°ÜÊ†áÈ¢ò</h3><p>Ê®°ÊÄÅÊ°ÜÂÜÖÂÆπ</p><button style="padding: 8px 16px; background: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer;">ÂÖ≥Èó≠</button></div></div><button style="padding: 8px 16px; background: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer;">ÊâìÂºÄÊ®°ÊÄÅÊ°Ü</button>';
                    element.style.position = 'relative';
                    break;
                case 'navbar':
                    element.innerHTML = '<nav style="display: flex; justify-content: space-between; align-items: center; padding: 15px; background-color: #2c3e50; color: white;"><div style="font-size: 1.2em; font-weight: bold;">Logo</div><div style="display: flex; gap: 20px;"><a href="#" style="color: white; text-decoration: none;">È¶ñÈ°µ</a><a href="#" style="color: white; text-decoration: none;">‰∫ßÂìÅ</a><a href="#" style="color: white; text-decoration: none;">ÂÖ≥‰∫é</a></div></nav>';
                    element.style.width = '100%';
                    break;
                case 'sidebar':
                    element.innerHTML = '<aside style="width: 250px; height: 100vh; background-color: #34495e; color: white; padding: 20px;"><nav style="display: grid; gap: 10px;"><a href="#" style="color: white; text-decoration: none; padding: 10px; border-radius: 4px;">ËèúÂçïÈ°π1</a><a href="#" style="color: white; text-decoration: none; padding: 10px; border-radius: 4px;">ËèúÂçïÈ°π2</a><a href="#" style="color: white; text-decoration: none; padding: 10px; border-radius: 4px;">ËèúÂçïÈ°π3</a></nav></aside>';
                    break;
                case 'footer':
                    element.innerHTML = '<footer style="padding: 30px; background-color: #2c3e50; color: white; text-align: center;"><p>¬© 2023 ÂÖ¨Âè∏ÂêçÁß∞. ‰øùÁïôÊâÄÊúâÊùÉÂà©.</p></footer>';
                    element.style.width = '100%';
                    break;
                case 'map':
                    element.innerHTML = '<div style="width: 100%; height: 300px; background-color: #ddd; display: flex; justify-content: center; align-items: center;">Âú∞ÂõæÁªÑ‰ª∂</div>';
                    break;
                case 'progress':
                    element.innerHTML = '<div style="width: 100%;"><div style="width: 50%; height: 20px; background-color: #3498db; border-radius: 10px; display: flex; justify-content: center; align-items: center; color: white; font-size: 12px;">50%</div></div>';
                    element.style.backgroundColor = 'transparent';
                    break;
                case 'table':
                    element.innerHTML = '<table style="width: 100%; border-collapse: collapse;"><thead><tr><th style="border: 1px solid #ddd; padding: 8px; text-align: left; background-color: #f2f2f2;">Ê†áÈ¢ò1</th><th style="border: 1px solid #ddd; padding: 8px; text-align: left; background-color: #f2f2f2;">Ê†áÈ¢ò2</th></tr></thead><tbody><tr><td style="border: 1px solid #ddd; padding: 8px;">ÂÜÖÂÆπ1</td><td style="border: 1px solid #ddd; padding: 8px;">ÂÜÖÂÆπ2</td></tr><tr><td style="border: 1px solid #ddd; padding: 8px;">ÂÜÖÂÆπ3</td><td style="border: 1px solid #ddd; padding: 8px;">ÂÜÖÂÆπ4</td></tr></tbody></table>';
                    element.style.backgroundColor = 'transparent';
                    break;
                default:
                    element.textContent = 'Êñ∞ÂÖÉÁ¥†';
            }
            
            // Ê∑ªÂä†ÂÖÉÁ¥†Â∑•ÂÖ∑Ê†è
            const toolbar = document.createElement('div');
            toolbar.className = 'element-toolbar';
            toolbar.innerHTML = `
                <button class="edit-btn" title="ÁºñËæë">‚úèÔ∏è</button>
                <button class="delete-btn" title="Âà†Èô§">üóëÔ∏è</button>
                <button class="copy-btn" title="Â§çÂà∂">‚éò</button>
                <button class="move-up-btn" title="‰∏äÁßª">‚Üë</button>
                <button class="move-down-btn" title="‰∏ãÁßª">‚Üì</button>
            `;
            element.appendChild(toolbar);
            
            // ËÆæÁΩÆÂÖÉÁ¥†‰ΩçÁΩÆ
            element.style.position = 'absolute';
            element.style.left = relativeX + 'px';
            element.style.top = relativeY + 'px';
            
            // Ê∑ªÂä†Âà∞ÁîªÂ∏É
            canvas.appendChild(element);
            
            // ÈÄâ‰∏≠Êñ∞ÂàõÂª∫ÁöÑÂÖÉÁ¥†
            selectElement(element);
            
            // ‰∏∫ÂµåÂ•óÁöÑÂèØÊãñÊîæÂå∫ÂüüËÆæÁΩÆ‰∫ã‰ª∂
            const nestedDroppables = element.querySelectorAll('.droppable');
            nestedDroppables.forEach(droppable => {
                setupNestedDroppable(droppable);
            });
            
            // ‰øùÂ≠òÂéÜÂè≤Áä∂ÊÄÅ
            saveHistory();
            
            // ÂèåÂáªÁºñËæëÊñáÊú¨
            if (type === 'text') {
                element.addEventListener('dblclick', function() {
                    const newText = prompt('ÁºñËæëÊñáÊú¨:', this.textContent);
                    if (newText !== null) {
                        this.textContent = newText;
                        updatePropertiesPanel();
                        saveHistory();
                    }
                });
            }
        }
        
        // ËÆæÁΩÆÂµåÂ•óÁöÑÂèØÊãñÊîæÂå∫Âüü
        function setupNestedDroppable(droppable) {
            droppable.addEventListener('dragover', function(e) {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'copy';
                this.style.borderColor = '#3498db';
            });
            
            droppable.addEventListener('dragleave', function() {
                this.style.borderColor = '#7f8c8d';
            });
            
            droppable.addEventListener('drop', function(e) {
                e.preventDefault();
                this.style.borderColor = '#7f8c8d';
                
                const componentType = e.dataTransfer.getData('text/plain');
                if (!componentType) return;
                
                createNewElement(componentType, e.clientX, e.clientY);
            });
        }
        
        // ËÆæÁΩÆËÆæÂ§áÂàáÊç¢
        function setupDeviceSwitcher() {
            const deviceBtns = document.querySelectorAll('.toolbar-btn[data-device]');
            const previewFrame = document.getElementById('preview-frame');
            
            deviceBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    deviceBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    currentDevice = this.getAttribute('data-device');
                    
                    switch(currentDevice) {
                        case 'desktop':
                            previewFrame.style.width = '100%';
                            previewFrame.style.maxWidth = 'none';
                            break;
                        case 'mobile':
                            previewFrame.style.width = '375px';
                            previewFrame.style.maxWidth = '100%';
                            break;
                        case 'tablet':
                            previewFrame.style.width = '768px';
                            previewFrame.style.maxWidth = '100%';
                            break;
                        case 'weapp':
                            previewFrame.style.width = '414px';
                            previewFrame.style.maxWidth = '100%';
                            break;
                    }
                    
                    saveSettings();
                });
            });
        }
        
        // ËÆæÁΩÆÊåâÈíÆ‰∫ã‰ª∂
        function setupButtons() {
            // È¢ÑËßàÊåâÈíÆ
            document.getElementById('preview-btn').addEventListener('click', function() {
                const html = generateHTML();
                const previewWindow = window.open('', '_blank');
                previewWindow.document.write(html);
                previewWindow.document.close();
            });
            
            // ÂØºÂá∫‰ª£Á†ÅÊåâÈíÆ
            document.getElementById('export-btn').addEventListener('click', function() {
                const html = generateHTML();
                const blob = new Blob([html], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'exported-page.html';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            });
            
            // ‰∏ä‰º†HTMLÊåâÈíÆ
            document.getElementById('upload-btn').addEventListener('click', function() {
                document.getElementById('upload-file').click();
            });
            
            // Êñá‰ª∂‰∏ä‰º†Â§ÑÁêÜ
            document.getElementById('upload-file').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(event) {
                    if (file.name.endsWith('.json')) {
                        try {
                            const data = JSON.parse(event.target.result);
                            loadFromJSON(data);
                        } catch (error) {
                            alert('Ëß£ÊûêJSONÊñá‰ª∂Â§±Ë¥•: ' + error.message);
                        }
                    } else {
                        parseHTML(event.target.result);
                    }
                };
                reader.readAsText(file);
                
                // ÈáçÁΩÆÊñá‰ª∂ËæìÂÖ•ÔºåÂÖÅËÆ∏ÈáçÂ§ç‰∏ä‰º†Âêå‰∏ÄÊñá‰ª∂
                e.target.value = '';
            });
            
            // ‰øùÂ≠òÊåâÈíÆ
            document.getElementById('save-btn').addEventListener('click', function() {
                const data = {
                    elements: getCanvasData(),
                    settings: getCurrentSettings(),
                    version: '1.0',
                    savedAt: new Date().toISOString()
                };
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'design-' + new Date().toISOString().slice(0, 10) + '.json';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            });
            
            // Êí§ÈîÄÊåâÈíÆ
            document.getElementById('undo-btn').addEventListener('click', undo);
            
            // ÈáçÂÅöÊåâÈíÆ
            document.getElementById('redo-btn').addEventListener('click', redo);
            
            // Ê∏ÖÁ©∫ÊåâÈíÆ
            document.getElementById('clear-btn').addEventListener('click', function() {
                if (confirm('Á°ÆÂÆöË¶ÅÊ∏ÖÁ©∫ÁîªÂ∏ÉÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊí§ÈîÄÔºÅ')) {
                    document.getElementById('canvas').innerHTML = '';
                    selectedElement = null;
                    clearPropertiesPanel();
                    saveHistory();
                }
            });
            
            // Â∫îÁî®‰ª£Á†ÅÊåâÈíÆ
            document.getElementById('apply-code-btn').addEventListener('click', function() {
                if (!selectedElement) return;
                
                try {
                    const css = document.getElementById('element-css').value;
                    const js = document.getElementById('element-js').value;
                    
                    // Â∫îÁî®CSS
                    if (css.trim()) {
                        const styleId = 'element-style-' + (selectedElement.id || Math.random().toString(36).substr(2, 8));
                        let styleElement = document.getElementById(styleId);
                        if (!styleElement) {
                            styleElement = document.createElement('style');
                            styleElement.id = styleId;
                            document.head.appendChild(styleElement);
                        }
                        styleElement.textContent = `#${selectedElement.id} { ${css} }`;
                    }
                    
                    // Â∫îÁî®JS
                    if (js.trim()) {
                        const scriptId = 'element-script-' + (selectedElement.id || Math.random().toString(36).substr(2, 8));
                        let scriptElement = document.getElementById(scriptId);
                        if (scriptElement) {
                            scriptElement.remove();
                        }
                        scriptElement = document.createElement('script');
                        scriptElement.id = scriptId;
                        scriptElement.textContent = `(function() { ${js} })();`;
                        document.body.appendChild(scriptElement);
                    }
                    
                    alert('‰ª£Á†ÅÂ∫îÁî®ÊàêÂäüÔºÅ');
                    saveHistory();
                } catch (error) {
                    alert('Â∫îÁî®‰ª£Á†ÅÊó∂Âá∫Èîô: ' + error.message);
                }
            });
            
            // ÂéÜÂè≤ËÆ∞ÂΩïÊåâÈíÆ
            document.getElementById('history-btn').addEventListener('click', function() {
                alert('ÂéÜÂè≤ËÆ∞ÂΩïÂäüËÉΩ: ÂΩìÂâçÁâàÊú¨ ' + historyIndex + '/' + (historyStack.length - 1));
            });
            
            // Âçè‰ΩúÊ®°ÂºèÊåâÈíÆ
            document.getElementById('collab-btn').addEventListener('click', function() {
                collaborationMode = !collaborationMode;
                this.classList.toggle('active');
                if (collaborationMode) {
                    alert('Âçè‰ΩúÊ®°ÂºèÂ∑≤ÂêØÁî®');
                    // ÂÆûÈôÖÂÆûÁé∞‰∏≠ÔºåËøôÈáå‰ºöËøûÊé•Âà∞WebSocketÊúçÂä°Âô®
                } else {
                    alert('Âçè‰ΩúÊ®°ÂºèÂ∑≤Á¶ÅÁî®');
                    // ÂÆûÈôÖÂÆûÁé∞‰∏≠ÔºåËøôÈáå‰ºöÊñ≠ÂºÄWebSocketËøûÊé•
                }
            });
            
            // ÂØºÂÖ•ËÆæÁΩÆÊåâÈíÆ
            document.getElementById('import-settings-btn').addEventListener('click', function() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                input.onchange = e => {
                    const file = e.target.files[0];
                    if (!file) return;
                    
                    const reader = new FileReader();
                    reader.onload = event => {
                        try {
                            const settings = JSON.parse(event.target.result);
                            applySettings(settings);
                            alert('ËÆæÁΩÆÂØºÂÖ•ÊàêÂäüÔºÅ');
                        } catch (error) {
                            alert('ÂØºÂÖ•ËÆæÁΩÆÂ§±Ë¥•: ' + error.message);
                        }
                    };
                    reader.readAsText(file);
                };
                input.click();
            });
            
            // ÂØºÂá∫ËÆæÁΩÆÊåâÈíÆ
            document.getElementById('export-settings-btn').addEventListener('click', function() {
                const settings = getCurrentSettings();
                const blob = new Blob([JSON.stringify(settings, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'editor-settings.json';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            });
        }
        
        // Ëß£Êûê‰∏ä‰º†ÁöÑHTML
        function parseHTML(html) {
            // Ê∏ÖÁ©∫ÂΩìÂâçÁîªÂ∏É
            document.getElementById('canvas').innerHTML = '';
            
            // ÂàõÂª∫‰∏Ä‰∏™‰∏¥Êó∂DOMÊù•Ëß£ÊûêHTML
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            
            // Êõ¥Â§çÊùÇÁöÑËß£ÊûêÈÄªËæëÔºåÂ∞ÜHTMLÂÖÉÁ¥†ËΩ¨Êç¢‰∏∫ÁºñËæëÂô®‰∏≠ÁöÑÁªÑ‰ª∂
            const body = doc.body;
            convertHTMLToElements(body, document.getElementById('canvas'));
            
            alert('HTMLÂ∑≤Ëß£ÊûêÂπ∂Âä†ËΩΩÂà∞ÁºñËæëÂô®‰∏≠');
            saveHistory();
        }
        
        // ÈÄíÂΩíËΩ¨Êç¢HTMLÂÖÉÁ¥†‰∏∫ÁºñËæëÂô®ÂÖÉÁ¥†
        function convertHTMLToElements(sourceElement, targetElement) {
            Array.from(sourceElement.children).forEach(child => {
                let elementType = 'container';
                let elementContent = child.outerHTML;
                
                // Ê†πÊçÆÂÖÉÁ¥†Á±ªÂûãÁ°ÆÂÆöÁºñËæëÂô®‰∏≠ÁöÑÁªÑ‰ª∂Á±ªÂûã
                if (child.tagName === 'DIV' && child.className.includes('container')) {
                    elementType = 'container';
                } else if (child.tagName === 'P' || child.tagName === 'SPAN' || child.tagName === 'H1' || child.tagName === 'H2' || child.tagName === 'H3' || child.tagName === 'H4' || child.tagName === 'H5' || child.tagName === 'H6') {
                    elementType = 'text';
                    elementContent = child.textContent;
                } else if (child.tagName === 'BUTTON') {
                    elementType = 'button';
                } else if (child.tagName === 'IMG') {
                    elementType = 'image';
                } else if (child.tagName === 'INPUT') {
                    if (child.type === 'text' || child.type === 'email' || child.type === 'password') {
                        elementType = 'input';
                    } else if (child.type === 'checkbox') {
                        elementType = 'checkbox';
                    } else if (child.type === 'radio') {
                        elementType = 'radio';
                    } else if (child.type === 'range') {
                        elementType = 'range';
                    } else if (child.type === 'date') {
                        elementType = 'date';
                    } else if (child.type === 'file') {
                        elementType = 'file';
                    } else if (child.type === 'submit') {
                        elementType = 'submit';
                    }
                } else if (child.tagName === 'TEXTAREA') {
                    elementType = 'textarea';
                } else if (child.tagName === 'SELECT') {
                    elementType = 'select';
                } else if (child.tagName === 'FORM') {
                    elementType = 'form';
                } else if (child.tagName === 'VIDEO') {
                    elementType = 'video';
                } else if (child.tagName === 'AUDIO') {
                    elementType = 'audio';
                } else if (child.tagName === 'NAV') {
                    elementType = 'navbar';
                } else if (child.tagName === 'FOOTER') {
                    elementType = 'footer';
                } else if (child.tagName === 'ASIDE') {
                    elementType = 'sidebar';
                } else if (child.tagName === 'UL' || child.tagName === 'OL') {
                    elementType = 'container';
                } else if (child.tagName === 'TABLE') {
                    elementType = 'table';
                } else if (child.tagName === 'PROGRESS') {
                    elementType = 'progress';
                }
                
                // ÂàõÂª∫ÁºñËæëÂô®ÂÖÉÁ¥†
                const element = document.createElement('div');
                element.className = 'element';
                element.setAttribute('data-type', elementType);
                
                if (elementType === 'text') {
                    element.textContent = elementContent;
                } else {
                    element.innerHTML = elementContent;
                }
                
                // Â§çÂà∂Ê†∑Âºè
                const style = window.getComputedStyle(child);
                for (let i = 0; i < style.length; i++) {
                    const property = style[i];
                    element.style[property] = style[property];
                }
                
                // Â§çÂà∂Â±ûÊÄß
                Array.from(child.attributes).forEach(attr => {
                    if (attr.name !== 'style') {
                        element.setAttribute(attr.name, attr.value);
                    }
                });
                
                // Ê∑ªÂä†Âà∞ÁîªÂ∏É
                targetElement.appendChild(element);
                
                // Â§ÑÁêÜÂ≠êÂÖÉÁ¥†
                if (child.children.length > 0 && elementType !== 'text') {
                    const container = element.querySelector('.droppable') || element;
                    convertHTMLToElements(child, container);
                }
                
                // Ê∑ªÂä†ÂÖÉÁ¥†Â∑•ÂÖ∑Ê†è
                const toolbar = document.createElement('div');
                toolbar.className = 'element-toolbar';
                toolbar.innerHTML = `
                    <button class="edit-btn" title="ÁºñËæë">‚úèÔ∏è</button>
                    <button class="delete-btn" title="Âà†Èô§">üóëÔ∏è</button>
                    <button class="copy-btn" title="Â§çÂà∂">‚éò</button>
                    <button class="move-up-btn" title="‰∏äÁßª">‚Üë</button>
                    <button class="move-down-btn" title="‰∏ãÁßª">‚Üì</button>
                `;
                element.appendChild(toolbar);
            });
        }
        
        // ‰ªéJSONÂä†ËΩΩËÆæËÆ°
        function loadFromJSON(data) {
            if (data.elements) {
                document.getElementById('canvas').innerHTML = '';
                loadElementsFromData(data.elements, document.getElementById('canvas'));
            }
            
            if (data.settings) {
                applySettings(data.settings);
            }
            
            alert('ËÆæËÆ°Â∑≤Âä†ËΩΩÔºÅ');
            saveHistory();
        }
        
        // ‰ªéÊï∞ÊçÆÂä†ËΩΩÂÖÉÁ¥†
        function loadElementsFromData(elementsData, parentElement) {
            elementsData.forEach(elementData => {
                const element = document.createElement('div');
                element.className = 'element';
                element.setAttribute('data-type', elementData.type || 'container');
                
                // ËÆæÁΩÆ‰ΩçÁΩÆÂíåÂÜÖÂÆπ
                if (elementData.type === 'text') {
                    element.textContent = elementData.content || '';
                } else {
                    element.innerHTML = elementData.html || '<div class="droppable">ÂÆπÂô®</div>';
                }
                
                // ËÆæÁΩÆÊ†∑Âºè
                if (elementData.style) {
                    Object.keys(elementData.style).forEach(property => {
                        element.style[property] = elementData.style[property];
                    });
                }
                
                // ËÆæÁΩÆÂ±ûÊÄß
                if (elementData.attributes) {
                    Object.keys(elementData.attributes).forEach(attr => {
                        element.setAttribute(attr, elementData.attributes[attr]);
                    });
                }
                
                // Ê∑ªÂä†Âà∞Áà∂ÂÖÉÁ¥†
                parentElement.appendChild(element);
                
                // Ê∑ªÂä†ÂÖÉÁ¥†Â∑•ÂÖ∑Ê†è
                const toolbar = document.createElement('div');
                toolbar.className = 'element-toolbar';
                toolbar.innerHTML = `
                    <button class="edit-btn" title="ÁºñËæë">‚úèÔ∏è</button>
                    <button class="delete-btn" title="Âà†Èô§">üóëÔ∏è</button>
                    <button class="copy-btn" title="Â§çÂà∂">‚éò</button>
                    <button class="move-up-btn" title="‰∏äÁßª">‚Üë</button>
                    <button class="move-down-btn" title="‰∏ãÁßª">‚Üì</button>
                `;
                element.appendChild(toolbar);
                
                // Â§ÑÁêÜÂ≠êÂÖÉÁ¥†
                if (elementData.children && elementData.children.length > 0) {
                    const container = element.querySelector('.droppable') || element;
                    loadElementsFromData(elementData.children, container);
                }
            });
        }
        
        // Ëé∑ÂèñÁîªÂ∏ÉÊï∞ÊçÆ
        function getCanvasData() {
            const canvas = document.getElementById('canvas');
            return Array.from(canvas.children).map(element => {
                return getElementData(element);
            });
        }
        
        // Ëé∑ÂèñÂÖÉÁ¥†Êï∞ÊçÆ
        function getElementData(element) {
            const data = {
                type: element.getAttribute('data-type') || 'container',
                style: {},
                attributes: {},
                children: []
            };
            
            // Ëé∑ÂèñÊ†∑Âºè
            const style = window.getComputedStyle(element);
            for (let i = 0; i < style.length; i++) {
                const property = style[i];
                if (property.startsWith('webkit') || property === 'length' || property === 'parentRule') continue;
                const value = style[property];
                if (value && !value.includes('matrix') && !value.includes('rgb(0, 0, 0)')) {
                    data.style[property] = value;
                }
            }
            
            // Ëé∑ÂèñÂ±ûÊÄß
            Array.from(element.attributes).forEach(attr => {
                if (attr.name !== 'style') {
                    data.attributes[attr.name] = attr.value;
                }
            });
            
            // Ëé∑ÂèñÂÜÖÂÆπ
            if (data.type === 'text') {
                data.content = element.textContent;
            } else {
                data.html = element.innerHTML;
            }
            
            // Ëé∑ÂèñÂ≠êÂÖÉÁ¥†
            const droppable = element.querySelector('.droppable');
            if (droppable) {
                data.children = Array.from(droppable.children).map(child => getElementData(child));
            }
            
            return data;
        }
        
        // ÁîüÊàêHTML‰ª£Á†Å
        function generateHTML() {
            const canvas = document.getElementById('canvas');
            let html = `<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÁîüÊàêÁöÑÈ°µÈù¢</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            line-height: 1.6;
        }
        
        /* Âü∫Á°ÄÊ†∑Âºè */
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* ÂìçÂ∫îÂºèËÆæËÆ° */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
        }
        
        /* ËøôÈáåÂèØ‰ª•Ê∑ªÂä†ÁîüÊàêÁöÑCSS */
    </style>
</head>
<body>
`;
            
            // ÈÅçÂéÜÁîªÂ∏É‰∏≠ÁöÑÂÖÉÁ¥†Âπ∂ÁîüÊàêHTML
            Array.from(canvas.children).forEach(element => {
                html += `    ${element.outerHTML}\n`;
            });
            
            html += `</body>
</html>`;
            
            return html;
        }
        
        // ËÆæÁΩÆÂ±ûÊÄßÈù¢ÊùøÊ†áÁ≠æÂàáÊç¢
        function setupPropertyTabs() {
            const tabs = document.querySelectorAll('.tab');
            const contents = [
                document.getElementById('properties-content'),
                document.getElementById('styles-content'),
                document.getElementById('events-content'),
                document.getElementById('code-content'),
                document.getElementById('settings-content')
            ];
            
            tabs.forEach((tab, index) => {
                tab.addEventListener('click', function() {
                    tabs.forEach(t => t.classList.remove('active'));
                    contents.forEach(c => c.style.display = 'none');
                    
                    this.classList.add('active');
                    contents[index].style.display = 'block';
                    
                    // Â¶ÇÊûúÂàáÊç¢Âà∞‰ª£Á†ÅÊ†áÁ≠æÔºåÊõ¥Êñ∞‰ª£Á†ÅÊòæÁ§∫
                    if (index === 3 && selectedElement) {
                        updateCodeView();
                    }
                });
            });
        }
        
        // ËÆæÁΩÆÂÖÉÁ¥†ÈÄâÊã©
        function setupElementSelection() {
            document.addEventListener('click', function(e) {
                let target = e.target;
                
                // Âêë‰∏äÊü•Êâæ.elementÂÖÉÁ¥†
                while (target && !target.classList.contains('element') && target !== document.body) {
                    target = target.parentElement;
                }
                
                // Â¶ÇÊûúÁÇπÂáªÁöÑÊòØÂÖÉÁ¥†ÊàñÂÖÉÁ¥†ÁöÑÂ≠êÂÖÉÁ¥†
                if (target && target.classList.contains('element')) {
                    // Â§ÑÁêÜÂÖÉÁ¥†Â∑•ÂÖ∑Ê†èÊåâÈíÆÁÇπÂáª
                    if (e.target.classList.contains('delete-btn')) {
                        if (confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ê≠§ÂÖÉÁ¥†ÂêóÔºü')) {
                            target.remove();
                            selectedElement = null;
                            clearPropertiesPanel();
                            saveHistory();
                        }
                        return;
                    }
                    
                    if (e.target.classList.contains('copy-btn')) {
                        const clone = target.cloneNode(true);
                        clone.style.left = (parseInt(target.style.left) + 20) + 'px';
                        clone.style.top = (parseInt(target.style.top) + 20) + 'px';
                        target.parentElement.appendChild(clone);
                        selectElement(clone);
                        saveHistory();
                        return;
                    }
                    
                    if (e.target.classList.contains('move-up-btn')) {
                        if (target.previousElementSibling) {
                            target.parentNode.insertBefore(target, target.previousElementSibling);
                            saveHistory();
                        }
                        return;
                    }
                    
                    if (e.target.classList.contains('move-down-btn')) {
                        if (target.nextElementSibling) {
                            target.parentNode.insertBefore(target.nextElementSibling, target);
                            saveHistory();
                        }
                        return;
                    }
                    
                    if (e.target.classList.contains('edit-btn')) {
                        // ÁºñËæëÈÄªËæëÔºåÊ†πÊçÆÂÖÉÁ¥†Á±ªÂûã‰∏çÂêåËÄå‰∏çÂêå
                        const type = target.getAttribute('data-type');
                        if (type === 'text') {
                            const newText = prompt('ÁºñËæëÊñáÊú¨:', target.textContent);
                            if (newText !== null) {
                                target.textContent = newText;
                                updatePropertiesPanel();
                                saveHistory();
                            }
                        } else if (type === 'image') {
                            const img = target.querySelector('img');
                            if (img) {
                                const newSrc = prompt('ÂõæÁâáURL:', img.src);
                                if (newSrc !== null) {
                                    img.src = newSrc;
                                    updatePropertiesPanel();
                                    saveHistory();
                                }
                            }
                        } else if (type === 'button') {
                            const button = target.querySelector('button');
                            if (button) {
                                const newText = prompt('ÊåâÈíÆÊñáÊú¨:', button.textContent);
                                if (newText !== null) {
                                    button.textContent = newText;
                                    updatePropertiesPanel();
                                    saveHistory();
                                }
                            }
                        } else if (type === 'progress') {
                            const progress = target.querySelector('div > div');
                            if (progress) {
                                const newValue = prompt('ËøõÂ∫¶ÂÄº (0-100):', progress.style.width.replace('%', ''));
                                if (newValue !== null && !isNaN(newValue) && newValue >= 0 && newValue <= 100) {
                                    progress.style.width = newValue + '%';
                                    progress.textContent = newValue + '%';
                                    updatePropertiesPanel();
                                    saveHistory();
                                }
                            }
                        } else if (type === 'table') {
                            const table = target.querySelector('table');
                            if (table) {
                                const newRows = prompt('Ë°åÊï∞:', table.rows.length);
                                const newCols = prompt('ÂàóÊï∞:', table.rows[0] ? table.rows[0].cells.length : 2);
                                
                                if (newRows !== null && newCols !== null && !isNaN(newRows) && !isNaN(newCols)) {
                                    // Ê∏ÖÁ©∫Ë°®Ê†º
                                    table.innerHTML = '';
                                    
                                    // ÂàõÂª∫Ë°®Â§¥
                                    const thead = document.createElement('thead');
                                    const headerRow = document.createElement('tr');
                                    for (let i = 0; i < newCols; i++) {
                                        const th = document.createElement('th');
                                        th.textContent = 'Ê†áÈ¢ò' + (i + 1);
                                        th.style.border = '1px solid #ddd';
                                        th.style.padding = '8px';
                                        th.style.textAlign = 'left';
                                        th.style.backgroundColor = '#f2f2f2';
                                        headerRow.appendChild(th);
                                    }
                                    thead.appendChild(headerRow);
                                    table.appendChild(thead);
                                    
                                    // ÂàõÂª∫Ë°®‰Ωì
                                    const tbody = document.createElement('tbody');
                                    for (let i = 0; i < newRows; i++) {
                                        const row = document.createElement('tr');
                                        for (let j = 0; j < newCols; j++) {
                                            const td = document.createElement('td');
                                            td.textContent = 'ÂÜÖÂÆπ' + (i + 1) + '-' + (j + 1);
                                            td.style.border = '1px solid #ddd';
                                            td.style.padding = '8px';
                                            row.appendChild(td);
                                        }
                                        tbody.appendChild(row);
                                    }
                                    table.appendChild(tbody);
                                    
                                    updatePropertiesPanel();
                                    saveHistory();
                                }
                            }
                        }
                        return;
                    }
                    
                    // ÈÄâÊã©ÂÖÉÁ¥†
                    selectElement(target);
                } else {
                    // ÁÇπÂáªÁ©∫ÁôΩÂ§ÑÂèñÊ∂àÈÄâÊã©
                    if (selectedElement) {
                        selectedElement.classList.remove('selected');
                        selectedElement = null;
                        clearPropertiesPanel();
                    }
                }
            });
        }
        
        // ÈÄâÊã©ÂÖÉÁ¥†
        function selectElement(element) {
            // ÂèñÊ∂à‰πãÂâçÈÄâ‰∏≠ÁöÑÂÖÉÁ¥†
            if (selectedElement) {
                selectedElement.classList.remove('selected');
            }
            
            // ÈÄâ‰∏≠Êñ∞ÂÖÉÁ¥†
            selectedElement = element;
            element.classList.add('selected');
            
            // Êõ¥Êñ∞Â±ûÊÄßÈù¢Êùø
            updatePropertiesPanel();
        }
        
        // Êõ¥Êñ∞Â±ûÊÄßÈù¢Êùø
        function updatePropertiesPanel() {
            if (!selectedElement) return;
            
            const type = selectedElement.getAttribute('data-type');
            
            // Êõ¥Êñ∞Âü∫Êú¨Â±ûÊÄß
            document.getElementById('prop-type').value = type;
            document.getElementById('prop-id').value = selectedElement.id || '';
            document.getElementById('prop-class').value = selectedElement.className.replace('element', '').replace('selected', '').trim();
            
            // Ê†πÊçÆÂÖÉÁ¥†Á±ªÂûãÊõ¥Êñ∞ÁâπÂÆöÂ±ûÊÄß
            if (type === 'text') {
                document.getElementById('prop-text').value = selectedElement.textContent;
                document.getElementById('prop-text').disabled = false;
            } else {
                document.getElementById('prop-text').value = '';
                document.getElementById('prop-text').disabled = true;
            }
            
            // Êõ¥Êñ∞Ê†∑Âºè
            const style = window.getComputedStyle(selectedElement);
            document.getElementById('style-width').value = style.width;
            document.getElementById('style-height').value = style.height;
            document.getElementById('style-position').value = style.position;
            document.getElementById('style-top').value = style.top;
            document.getElementById('style-left').value = style.left;
            document.getElementById('style-margin').value = style.margin;
            document.getElementById('style-padding').value = style.padding;
            document.getElementById('style-font-size').value = style.fontSize;
            document.getElementById('style-color').value = rgbToHex(style.color);
            document.getElementById('style-color-text').value = rgbToHex(style.color);
            document.getElementById('style-font-weight').value = style.fontWeight;
            document.getElementById('style-text-align').value = style.textAlign;
            document.getElementById('style-display').value = style.display;
            document.getElementById('style-flex-direction').value = style.flexDirection;
            document.getElementById('style-justify-content').value = style.justifyContent;
            
            // Êõ¥Êñ∞ÂÖ∂‰ªñÂ±ûÊÄß
            document.getElementById('prop-bgcolor').value = rgbToHex(style.backgroundColor);
            document.getElementById('prop-bgcolor-text').value = rgbToHex(style.backgroundColor);
            document.getElementById('prop-border').value = style.border;
            document.getElementById('prop-border-radius').value = style.borderRadius;
            document.getElementById('prop-visible').value = style.visibility === 'hidden' ? 'hidden' : style.display === 'none' ? 'none' : 'visible';
            
            // Êõ¥Êñ∞‰ª£Á†ÅËßÜÂõæ
            updateCodeView();
            
            // ËÆæÁΩÆÂ±ûÊÄßÂèòÂåñÁõëÂê¨
            setupPropertyChangeListeners();
        }
        
        // RGBÈ¢úËâ≤ËΩ¨HEX
        function rgbToHex(rgb) {
            if (!rgb || rgb === 'transparent' || rgb === 'rgba(0, 0, 0, 0)') return '#ffffff';
            
            // Â§ÑÁêÜrgb(r, g, b)Ê†ºÂºè
            if (rgb.startsWith('rgb(')) {
                const parts = rgb.substring(4, rgb.length - 1).split(',');
                const r = parseInt(parts[0].trim());
                const g = parseInt(parts[1].trim());
                const b = parseInt(parts[2].trim());
                return `#${((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1)}`;
            }
            
            // Â§ÑÁêÜrgba(r, g, b, a)Ê†ºÂºè
            if (rgb.startsWith('rgba(')) {
                const parts = rgb.substring(5, rgb.length - 1).split(',');
                const r = parseInt(parts[0].trim());
                const g = parseInt(parts[1].trim());
                const b = parseInt(parts[2].trim());
                return `#${((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1)}`;
            }
            
            return rgb;
        }
        
        // Êõ¥Êñ∞‰ª£Á†ÅËßÜÂõæ
        function updateCodeView() {
            if (!selectedElement) return;
            
            document.getElementById('element-html').value = selectedElement.outerHTML;
            
            // Ëé∑ÂèñÂÖÉÁ¥†ÁâπÂÆöCSS
            const style = window.getComputedStyle(selectedElement);
            let css = '';
            for (let i = 0; i < style.length; i++) {
                const property = style[i];
                if (!property.startsWith('webkit') && property !== 'length' && property !== 'parentRule') {
                    const value = style[property];
                    if (value && !value.includes('matrix') && !value.includes('rgb(0, 0, 0)')) {
                        css += `${property}: ${value};\n`;
                    }
                }
            }
            document.getElementById('element-css').value = css;
            
            // Ëé∑ÂèñÂÖÉÁ¥†ÁâπÂÆöJS
            document.getElementById('element-js').value = '// Ëá™ÂÆö‰πâJavaScript‰ª£Á†Å\n// ‰æãÂ¶Ç: console.log("Hello");';
        }
        
        // ËÆæÁΩÆÂ±ûÊÄßÂèòÂåñÁõëÂê¨
        function setupPropertyChangeListeners() {
            if (!selectedElement) return;
            
            // ID
            document.getElementById('prop-id').addEventListener('change', function() {
                selectedElement.id = this.value;
                updateCodeView();
                saveHistory();
            });
            
            // Á±ªÂêç
            document.getElementById('prop-class').addEventListener('change', function() {
                selectedElement.className = 'element ' + this.value;
                if (selectedElement.classList.contains('selected')) {
                    selectedElement.className += ' selected';
                }
                updateCodeView();
                saveHistory();
            });
            
            // ÊñáÊú¨ÂÜÖÂÆπ
            document.getElementById('prop-text').addEventListener('change', function() {
                if (selectedElement.getAttribute('data-type') === 'text') {
                    selectedElement.textContent = this.value;
                    updateCodeView();
                    saveHistory();
                }
            });
            
            // ËÉåÊôØÈ¢úËâ≤
            document.getElementById('prop-bgcolor').addEventListener('change', function() {
                selectedElement.style.backgroundColor = this.value;
                document.getElementById('prop-bgcolor-text').value = this.value;
                updateCodeView();
                saveHistory();
            });
            
            document.getElementById('prop-bgcolor-text').addEventListener('change', function() {
                selectedElement.style.backgroundColor = this.value;
                document.getElementById('prop-bgcolor').value = this.value;
                updateCodeView();
                saveHistory();
            });
            
            // ËæπÊ°Ü
            document.getElementById('prop-border').addEventListener('change', function() {
                selectedElement.style.border = this.value;
                updateCodeView();
                saveHistory();
            });
            
            // ËæπÊ°ÜÂçäÂæÑ
            document.getElementById('prop-border-radius').addEventListener('change', function() {
                selectedElement.style.borderRadius = this.value;
                updateCodeView();
                saveHistory();
            });
            
            // ÂèØËßÅÊÄß
            document.getElementById('prop-visible').addEventListener('change', function() {
                if (this.value === 'hidden') {
                    selectedElement.style.visibility = 'hidden';
                    selectedElement.style.display = '';
                } else if (this.value === 'none') {
                    selectedElement.style.display = 'none';
                    selectedElement.style.visibility = '';
                } else {
                    selectedElement.style.visibility = '';
                    selectedElement.style.display = '';
                }
                updateCodeView();
                saveHistory();
            });
            
            // ÂÆΩÂ∫¶
            document.getElementById('style-width').addEventListener('change', function() {
                selectedElement.style.width = this.value;
                updateCodeView();
                saveHistory();
            });
            
            // È´òÂ∫¶
            document.getElementById('style-height').addEventListener('change', function() {
                selectedElement.style.height = this.value;
                updateCodeView();
                saveHistory();
            });
            
            // ‰ΩçÁΩÆ
            document.getElementById('style-position').addEventListener('change', function() {
                selectedElement.style.position = this.value;
                updateCodeView();
                saveHistory();
            });
            
            // ‰∏äËæπË∑ù
            document.getElementById('style-top').addEventListener('change', function() {
                selectedElement.style.top = this.value;
                updateCodeView();
                saveHistory();
            });
            
            // Â∑¶ËæπË∑ù
            document.getElementById('style-left').addEventListener('change', function() {
                selectedElement.style.left = this.value;
                updateCodeView();
                saveHistory();
            });
            
            // Â§ñËæπË∑ù
            document.getElementById('style-margin').addEventListener('change', function() {
                selectedElement.style.margin = this.value;
                updateCodeView();
                saveHistory();
            });
            
            // ÂÜÖËæπË∑ù
            document.getElementById('style-padding').addEventListener('change', function() {
                selectedElement.style.padding = this.value;
                updateCodeView();
                saveHistory();
            });
            
            // Â≠ó‰ΩìÂ§ßÂ∞è
            document.getElementById('style-font-size').addEventListener('change', function() {
                selectedElement.style.fontSize = this.value;
                updateCodeView();
                saveHistory();
            });
            
            // Â≠ó‰ΩìÈ¢úËâ≤
            document.getElementById('style-color').addEventListener('change', function() {
                selectedElement.style.color = this.value;
                document.getElementById('style-color-text').value = this.value;
                updateCodeView();
                saveHistory();
            });
            
            document.getElementById('style-color-text').addEventListener('change', function() {
                selectedElement.style.color = this.value;
                document.getElementById('style-color').value = this.value;
                updateCodeView();
                saveHistory();
            });
            
            // Â≠ó‰ΩìÁ≤óÁªÜ
            document.getElementById('style-font-weight').addEventListener('change', function() {
                selectedElement.style.fontWeight = this.value;
                updateCodeView();
                saveHistory();
            });
            
            // ÊñáÊú¨ÂØπÈΩê
            document.getElementById('style-text-align').addEventListener('change', function() {
                selectedElement.style.textAlign = this.value;
                updateCodeView();
                saveHistory();
            });
            
            // ÊòæÁ§∫ÊñπÂºè
            document.getElementById('style-display').addEventListener('change', function() {
                selectedElement.style.display = this.value;
                updateCodeView();
                saveHistory();
            });
            
            // Flex ÊñπÂêë
            document.getElementById('style-flex-direction').addEventListener('change', function() {
                selectedElement.style.flexDirection = this.value;
                updateCodeView();
                saveHistory();
            });
            
            // Flex ÂØπÈΩê
            document.getElementById('style-justify-content').addEventListener('change', function() {
                selectedElement.style.justifyContent = this.value;
                updateCodeView();
                saveHistory();
            });
            
            // ÁÇπÂáª‰∫ã‰ª∂
            document.getElementById('event-click').addEventListener('change', function() {
                if (this.value === 'custom') {
                    document.getElementById('custom-click-container').style.display = 'block';
                } else {
                    document.getElementById('custom-click-container').style.display = 'none';
                    // ËÆæÁΩÆÈ¢ÑËÆæ‰∫ã‰ª∂
                    if (this.value === 'alert') {
                        selectedElement.onclick = function() { alert('ÁÇπÂáª‰∫ã‰ª∂Ëß¶ÂèëÔºÅ'); };
                    } else if (this.value === 'navigate') {
                        selectedElement.onclick = function() { window.location.href = '#'; };
                    } else if (this.value === 'toggle') {
                        selectedElement.onclick = function() { 
                            this.style.display = this.style.display === 'none' ? '' : 'none'; 
                        };
                    } else if (this.value === 'submit') {
                        selectedElement.onclick = function(e) { 
                            e.preventDefault();
                            alert('Ë°®ÂçïÊèê‰∫§ÔºÅ'); 
                        };
                    } else {
                        selectedElement.onclick = null;
                    }
                }
                updateCodeView();
                saveHistory();
            });
            
            // Ëá™ÂÆö‰πâÁÇπÂáª‰∫ã‰ª∂
            document.getElementById('event-click-custom').addEventListener('change', function() {
                try {
                    selectedElement.onclick = new Function('event', this.value);
                    updateCodeView();
                    saveHistory();
                } catch (error) {
                    alert('Ëá™ÂÆö‰πâ‰ª£Á†ÅÈîôËØØ: ' + error.message);
                }
            });
            
            // Èº†Ê†áÊÇ¨ÂÅú‰∫ã‰ª∂
            document.getElementById('event-hover').addEventListener('change', function() {
                if (this.value === 'custom') {
                    document.getElementById('custom-hover-container').style.display = 'block';
                } else {
                    document.getElementById('custom-hover-container').style.display = 'none';
                    // ËÆæÁΩÆÈ¢ÑËÆæ‰∫ã‰ª∂
                    if (this.value === 'tooltip') {
                        selectedElement.onmouseover = function() { 
                            const tooltip = document.createElement('div');
                            tooltip.textContent = 'ÊèêÁ§∫‰ø°ÊÅØ';
                            tooltip.style.position = 'absolute';
                            tooltip.style.backgroundColor = 'black';
                            tooltip.style.color = 'white';
                            tooltip.style.padding = '5px';
                            tooltip.style.borderRadius = '3px';
                            tooltip.style.zIndex = '1000';
                            tooltip.style.top = (this.offsetTop - 30) + 'px';
                            tooltip.style.left = this.offsetLeft + 'px';
                            tooltip.id = 'tooltip-' + Date.now();
                            document.body.appendChild(tooltip);
                        };
                        selectedElement.onmouseout = function() {
                            const tooltips = document.querySelectorAll('[id^="tooltip-"]');
                            tooltips.forEach(t => t.remove());
                        };
                    } else if (this.value === 'highlight') {
                        selectedElement.onmouseover = function() { 
                            this.style.boxShadow = '0 0 10px rgba(0,0,0,0.3)';
                        };
                        selectedElement.onmouseout = function() {
                            this.style.boxShadow = '';
                        };
                    } else {
                        selectedElement.onmouseover = null;
                        selectedElement.onmouseout = null;
                    }
                }
                updateCodeView();
                saveHistory();
            });
            
            // Ëá™ÂÆö‰πâÊÇ¨ÂÅú‰∫ã‰ª∂
            document.getElementById('event-hover-custom').addEventListener('change', function() {
                try {
                    selectedElement.onmouseover = new Function('event', this.value);
                    updateCodeView();
                    saveHistory();
                } catch (error) {
                    alert('Ëá™ÂÆö‰πâ‰ª£Á†ÅÈîôËØØ: ' + error.message);
                }
            });
            
            // ËæìÂÖ•ÂèòÂåñ‰∫ã‰ª∂
            document.getElementById('event-change').addEventListener('change', function() {
                if (this.value === 'custom') {
                    document.getElementById('custom-change-container').style.display = 'block';
                } else {
                    document.getElementById('custom-change-container').style.display = 'none';
                    // ËÆæÁΩÆÈ¢ÑËÆæ‰∫ã‰ª∂
                    if (this.value === 'validate') {
                        selectedElement.onchange = function() { 
                            if (!this.value) {
                                this.style.borderColor = 'red';
                            } else {
                                this.style.borderColor = '';
                            }
                        };
                    } else if (this.value === 'update') {
                        selectedElement.onchange = function() { 
                            const output = document.getElementById(this.id + '-output');
                            if (output) output.textContent = this.value;
                        };
                    } else {
                        selectedElement.onchange = null;
                    }
                }
                updateCodeView();
                saveHistory();
            });
            
            // Ëá™ÂÆö‰πâÂèòÂåñ‰∫ã‰ª∂
            document.getElementById('event-change-custom').addEventListener('change', function() {
                try {
                    selectedElement.onchange = new Function('event', this.value);
                    updateCodeView();
                    saveHistory();
                } catch (error) {
                    alert('Ëá™ÂÆö‰πâ‰ª£Á†ÅÈîôËØØ: ' + error.message);
                }
            });
            
            // ÁîªÂ∏ÉÂÆΩÂ∫¶ËÆæÁΩÆ
            document.getElementById('setting-canvas-width').addEventListener('change', function() {
                document.getElementById('preview-frame').style.width = this.value;
                saveSettings();
            });
            
            // ÁîªÂ∏ÉËÉåÊôØÈ¢úËâ≤
            document.getElementById('setting-canvas-bgcolor').addEventListener('change', function() {
                document.getElementById('canvas').style.backgroundColor = this.value;
                document.getElementById('setting-canvas-bgcolor-text').value = this.value;
                saveSettings();
            });
            
            document.getElementById('setting-canvas-bgcolor-text').addEventListener('change', function() {
                document.getElementById('canvas').style.backgroundColor = this.value;
                document.getElementById('setting-canvas-bgcolor').value = this.value;
                saveSettings();
            });
            
            // ÁΩëÊ†ºÊòæÁ§∫
            document.getElementById('setting-grid-show').addEventListener('change', function() {
                if (this.value === 'true') {
                    const gridColor = document.getElementById('setting-grid-color').value;
                    const color = hexToRgba(gridColor, 0.1);
                    const gridSize = document.getElementById('setting-grid-size').value;
                    document.getElementById('canvas').style.backgroundImage = `linear-gradient(${color} 1px, transparent 1px), linear-gradient(90deg, ${color} 1px, transparent 1px)`;
                    document.getElementById('canvas').style.backgroundSize = `${gridSize}px ${gridSize}px`;
                } else {
                    document.getElementById('canvas').style.backgroundImage = 'none';
                }
                saveSettings();
            });
            
            // ÁΩëÊ†ºÂ§ßÂ∞è
            document.getElementById('setting-grid-size').addEventListener('change', function() {
                if (document.getElementById('setting-grid-show').value === 'true') {
                    const gridColor = document.getElementById('setting-grid-color').value;
                    const color = hexToRgba(gridColor, 0.1);
                    document.getElementById('canvas').style.backgroundSize = `${this.value}px ${this.value}px`;
                }
                saveSettings();
            });
            
            // ÁΩëÊ†ºÈ¢úËâ≤
            document.getElementById('setting-grid-color').addEventListener('change', function() {
                if (document.getElementById('setting-grid-show').value === 'true') {
                    const color = hexToRgba(this.value, 0.1);
                    document.getElementById('canvas').style.backgroundImage = `linear-gradient(${color} 1px, transparent 1px), linear-gradient(90deg, ${color} 1px, transparent 1px)`;
                }
                document.getElementById('setting-grid-color-text').value = this.value;
                saveSettings();
            });
            
            document.getElementById('setting-grid-color-text').addEventListener('change', function() {
                if (document.getElementById('setting-grid-show').value === 'true') {
                    const color = hexToRgba(this.value, 0.1);
                    document.getElementById('canvas').style.backgroundImage = `linear-gradient(${color} 1px, transparent 1px), linear-gradient(90deg, ${color} 1px, transparent 1px)`;
                }
                document.getElementById('setting-grid-color').value = this.value;
                saveSettings();
            });
            
            // Ëá™Âä®‰øùÂ≠ò
            document.getElementById('setting-autosave').addEventListener('change', function() {
                saveSettings();
            });
            
            // Ëá™Âä®‰øùÂ≠òÈó¥Èöî
            document.getElementById('setting-autosave-interval').addEventListener('change', function() {
                saveSettings();
            });
        }
        
        // HEXÈ¢úËâ≤ËΩ¨RGBA
        function hexToRgba(hex, alpha) {
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            return `rgba(${r}, ${g}, ${b}, ${alpha})`;
        }
        
        // Ê∏ÖÁ©∫Â±ûÊÄßÈù¢Êùø
        function clearPropertiesPanel() {
            document.getElementById('properties-content').querySelectorAll('input, select, textarea').forEach(input => {
                input.value = '';
            });
            document.getElementById('styles-content').querySelectorAll('input').forEach(input => {
                input.value = '';
            });
            document.getElementById('events-content').querySelectorAll('select, textarea').forEach(input => {
                input.value = '';
            });
            document.getElementById('custom-click-container').style.display = 'none';
            document.getElementById('custom-hover-container').style.display = 'none';
            document.getElementById('custom-change-container').style.display = 'none';
            document.getElementById('element-html').value = '';
            document.getElementById('element-css').value = '';
            document.getElementById('element-js').value = '';
        }
        
        // ‰øùÂ≠òÂéÜÂè≤Áä∂ÊÄÅ
        function saveHistory() {
            // Â¶ÇÊûúÂΩìÂâç‰∏çÊòØÊúÄÊñ∞ÁöÑÂéÜÂè≤ËÆ∞ÂΩïÔºåÂàô‰∏¢ÂºÉÂêéÈù¢ÁöÑËÆ∞ÂΩï
            if (historyIndex < historyStack.length - 1) {
                historyStack = historyStack.slice(0, historyIndex + 1);
            }
            
            // ‰øùÂ≠òÂΩìÂâçÁä∂ÊÄÅ
            const canvas = document.getElementById('canvas');
            const snapshot = {
                html: canvas.innerHTML,
                selectedElementId: selectedElement ? selectedElement.id : null,
                timestamp: new Date().toISOString()
            };
            
            historyStack.push(snapshot);
            historyIndex = historyStack.length - 1;
            
            // ÈôêÂà∂ÂéÜÂè≤ËÆ∞ÂΩïÊï∞Èáè
            if (historyStack.length > 50) {
                historyStack.shift();
                historyIndex--;
            }
            
            // Êõ¥Êñ∞Êí§ÈîÄ/ÈáçÂÅöÊåâÈíÆÁä∂ÊÄÅ
            updateHistoryButtons();
        }
        
        // Êí§ÈîÄÊìç‰Ωú
        function undo() {
            if (historyIndex <= 0) return;
            
            historyIndex--;
            restoreFromHistory();
        }
        
        // ÈáçÂÅöÊìç‰Ωú
        function redo() {
            if (historyIndex >= historyStack.length - 1) return;
            
            historyIndex++;
            restoreFromHistory();
        }
        
        // ‰ªéÂéÜÂè≤ËÆ∞ÂΩïÊÅ¢Â§ç
        function restoreFromHistory() {
            const snapshot = historyStack[historyIndex];
            const canvas = document.getElementById('canvas');
            
            canvas.innerHTML = snapshot.html;
            
            // ÈáçÊñ∞ËÆæÁΩÆÊâÄÊúâÂÖÉÁ¥†ÁöÑÊãñÊîæÂå∫Âüü
            const droppables = canvas.querySelectorAll('.droppable');
            droppables.forEach(droppable => {
                setupNestedDroppable(droppable);
            });
            
            // ÊÅ¢Â§çÈÄâ‰∏≠ÁöÑÂÖÉÁ¥†
            if (snapshot.selectedElementId) {
                const element = document.getElementById(snapshot.selectedElementId);
                if (element) {
                    selectElement(element);
                } else {
                    selectedElement = null;
                    clearPropertiesPanel();
                }
            } else {
                selectedElement = null;
                clearPropertiesPanel();
            }
            
            // Êõ¥Êñ∞Êí§ÈîÄ/ÈáçÂÅöÊåâÈíÆÁä∂ÊÄÅ
            updateHistoryButtons();
        }
        
        // Êõ¥Êñ∞Êí§ÈîÄ/ÈáçÂÅöÊåâÈíÆÁä∂ÊÄÅ
        function updateHistoryButtons() {
            document.getElementById('undo-btn').disabled = historyIndex <= 0;
            document.getElementById('redo-btn').disabled = historyIndex >= historyStack.length - 1;
        }
        
        // ËÆæÁΩÆ‰æßËæπÊ†èÊäòÂè†
        function setupSidebarSections() {
            const sections = document.querySelectorAll('.sidebar-section');
            
            sections.forEach(section => {
                const header = section.querySelector('h3');
                header.addEventListener('click', function() {
                    section.classList.toggle('collapsed');
                });
            });
        }
        
        // ËÆæÁΩÆÁªÑ‰ª∂ÊêúÁ¥¢
        function setupComponentSearch() {
            const searchInput = document.getElementById('component-search');
            
            searchInput.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const components = document.querySelectorAll('.component');
                
                components.forEach(component => {
                    const text = component.textContent.toLowerCase();
                    if (text.includes(searchTerm)) {
                        component.style.display = '';
                    } else {
                        component.style.display = 'none';
                    }
                });
            });
        }
        
        // ËÆæÁΩÆÊ®°ÊùøÁÇπÂáª
        function setupTemplateClick() {
            const templates = document.querySelectorAll('.template-preview');
            
            templates.forEach(template => {
                template.addEventListener('click', function() {
                    const templateName = this.getAttribute('data-template');
                    if (templateLibrary[templateName]) {
                        if (confirm(`Á°ÆÂÆöË¶ÅÂä†ËΩΩ"${templateLibrary[templateName].name}"Ê®°ÊùøÂêóÔºüÂΩìÂâçÂÜÖÂÆπÂ∞ÜË¢´ÊõøÊç¢„ÄÇ`)) {
                            document.getElementById('canvas').innerHTML = templateLibrary[templateName].html;
                            
                            // ÈáçÊñ∞ËÆæÁΩÆÊâÄÊúâÂÖÉÁ¥†ÁöÑÊãñÊîæÂå∫Âüü
                            const droppables = document.querySelectorAll('.droppable');
                            droppables.forEach(droppable => {
                                setupNestedDroppable(droppable);
                            });
                            
                            // Ê∑ªÂä†ÂÖÉÁ¥†Â∑•ÂÖ∑Ê†è
                            const elements = document.querySelectorAll('.element');
                            elements.forEach(element => {
                                const toolbar = document.createElement('div');
                                toolbar.className = 'element-toolbar';
                                toolbar.innerHTML = `
                                    <button class="edit-btn" title="ÁºñËæë">‚úèÔ∏è</button>
                                    <button class="delete-btn" title="Âà†Èô§">üóëÔ∏è</button>
                                    <button class="copy-btn" title="Â§çÂà∂">‚éò</button>
                                    <button class="move-up-btn" title="‰∏äÁßª">‚Üë</button>
                                    <button class="move-down-btn" title="‰∏ãÁßª">‚Üì</button>
                                `;
                                element.appendChild(toolbar);
                            });
                            
                            selectedElement = null;
                            clearPropertiesPanel();
                            saveHistory();
                        }
                    }
                });
            });
        }
        
        // ËÆæÁΩÆÂø´Êç∑ÈîÆ
        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', function(e) {
                // Ê£ÄÊü•ÊòØÂê¶Âú®ËæìÂÖ•Ê°Ü‰∏≠ÔºåÂ¶ÇÊûúÊòØÂàôÂøΩÁï•Âø´Êç∑ÈîÆ
                if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA' || e.target.isContentEditable) {
                    return;
                }
                
                // Ctrl+Z - Êí§ÈîÄ
                if (e.ctrlKey && e.key === 'z') {
                    e.preventDefault();
                    undo();
                }
                
                // Ctrl+Y - ÈáçÂÅö
                if (e.ctrlKey && e.key === 'y') {
                    e.preventDefault();
                    redo();
                }
                
                // Delete - Âà†Èô§ÈÄâ‰∏≠ÂÖÉÁ¥†
                if (e.key === 'Delete' && selectedElement) {
                    e.preventDefault();
                    selectedElement.remove();
                    selectedElement = null;
                    clearPropertiesPanel();
                    saveHistory();
                }
                
                // ÊñπÂêëÈîÆ - ÁßªÂä®ÈÄâ‰∏≠ÂÖÉÁ¥†
                if (selectedElement && (e.key === 'ArrowUp' || e.key === 'ArrowDown' || e.key === 'ArrowLeft' || e.key === 'ArrowRight')) {
                    e.preventDefault();
                    const currentTop = parseInt(selectedElement.style.top) || 0;
                    const currentLeft = parseInt(selectedElement.style.left) || 0;
                    const step = e.shiftKey ? 10 : 1;
                    
                    switch(e.key) {
                        case 'ArrowUp':
                            selectedElement.style.top = (currentTop - step) + 'px';
                            break;
                        case 'ArrowDown':
                            selectedElement.style.top = (currentTop + step) + 'px';
                            break;
                        case 'ArrowLeft':
                            selectedElement.style.left = (currentLeft - step) + 'px';
                            break;
                        case 'ArrowRight':
                            selectedElement.style.left = (currentLeft + step) + 'px';
                            break;
                    }
                    
                    updatePropertiesPanel();
                    saveHistory();
                }
            });
        }
        
        // Ëé∑ÂèñÂΩìÂâçËÆæÁΩÆ
        function getCurrentSettings() {
            return {
                device: currentDevice,
                canvasWidth: document.getElementById('preview-frame').style.width,
                canvasBgColor: document.getElementById('canvas').style.backgroundColor,
                gridShow: document.getElementById('setting-grid-show').value === 'true',
                gridSize: document.getElementById('setting-grid-size').value,
                gridColor: document.getElementById('setting-grid-color').value,
                autosave: document.getElementById('setting-autosave').value === 'true',
                autosaveInterval: document.getElementById('setting-autosave-interval').value
            };
        }
        
        // Â∫îÁî®ËÆæÁΩÆ
        function applySettings(settings) {
            if (!settings) return;
            
            // ËÆæÂ§áËÆæÁΩÆ
            if (settings.device) {
                currentDevice = settings.device;
                const deviceBtn = document.querySelector(`.toolbar-btn[data-device="${settings.device}"]`);
                if (deviceBtn) {
                    document.querySelectorAll('.toolbar-btn[data-device]').forEach(btn => btn.classList.remove('active'));
                    deviceBtn.classList.add('active');
                    
                    const previewFrame = document.getElementById('preview-frame');
                    switch(currentDevice) {
                        case 'desktop':
                            previewFrame.style.width = '100%';
                            previewFrame.style.maxWidth = 'none';
                            break;
                        case 'mobile':
                            previewFrame.style.width = '375px';
                            previewFrame.style.maxWidth = '100%';
                            break;
                        case 'tablet':
                            previewFrame.style.width = '768px';
                            previewFrame.style.maxWidth = '100%';
                            break;
                        case 'weapp':
                            previewFrame.style.width = '414px';
                            previewFrame.style.maxWidth = '100%';
                            break;
                    }
                }
            }
            
            // ÁîªÂ∏ÉÂÆΩÂ∫¶
            if (settings.canvasWidth) {
                document.getElementById('preview-frame').style.width = settings.canvasWidth;
                document.getElementById('setting-canvas-width').value = settings.canvasWidth;
            }
            
            // ÁîªÂ∏ÉËÉåÊôØÈ¢úËâ≤
            if (settings.canvasBgColor) {
                document.getElementById('canvas').style.backgroundColor = settings.canvasBgColor;
                document.getElementById('setting-canvas-bgcolor').value = rgbToHex(settings.canvasBgColor);
                document.getElementById('setting-canvas-bgcolor-text').value = rgbToHex(settings.canvasBgColor);
            }
            
            // ÁΩëÊ†ºÊòæÁ§∫
            if (settings.gridShow !== undefined) {
                document.getElementById('setting-grid-show').value = settings.gridShow ? 'true' : 'false';
                if (settings.gridShow) {
                    const gridColor = settings.gridColor || '#e0e0e0';
                    const color = hexToRgba(gridColor, 0.1);
                    const gridSize = settings.gridSize || '10';
                    document.getElementById('canvas').style.backgroundImage = `linear-gradient(${color} 1px, transparent 1px), linear-gradient(90deg, ${color} 1px, transparent 1px)`;
                    document.getElementById('canvas').style.backgroundSize = `${gridSize}px ${gridSize}px`;
                } else {
                    document.getElementById('canvas').style.backgroundImage = 'none';
                }
            }
            
            // ÁΩëÊ†ºÂ§ßÂ∞è
            if (settings.gridSize) {
                document.getElementById('setting-grid-size').value = settings.gridSize;
            }
            
            // ÁΩëÊ†ºÈ¢úËâ≤
            if (settings.gridColor) {
                document.getElementById('setting-grid-color').value = settings.gridColor;
                document.getElementById('setting-grid-color-text').value = settings.gridColor;
            }
            
            // Ëá™Âä®‰øùÂ≠ò
            if (settings.autosave !== undefined) {
                document.getElementById('setting-autosave').value = settings.autosave ? 'true' : 'false';
            }
            
            // Ëá™Âä®‰øùÂ≠òÈó¥Èöî
            if (settings.autosaveInterval) {
                document.getElementById('setting-autosave-interval').value = settings.autosaveInterval;
            }
        }
        
        // Âä†ËΩΩËÆæÁΩÆ
        function loadSettings() {
            const savedSettings = localStorage.getItem('h5EditorSettings');
            if (savedSettings) {
                try {
                    const settings = JSON.parse(savedSettings);
                    applySettings(settings);
                } catch (error) {
                    console.error('Âä†ËΩΩËÆæÁΩÆÂ§±Ë¥•:', error);
                }
            }
        }
        
        // ‰øùÂ≠òËÆæÁΩÆ
        function saveSettings() {
            const settings = getCurrentSettings();
            localStorage.setItem('h5EditorSettings', JSON.stringify(settings));
        }
    </script>
</body>
</html>